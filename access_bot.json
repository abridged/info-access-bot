[{"id":"727c54f5.3975dc","type":"tab","label":"Gandolf Bot","disabled":false,"info":""},{"id":"51a355d0.06a06c","type":"tab","label":"Supergroup: Member","disabled":false,"info":""},{"id":"845fee24.1a24a","type":"tab","label":"Supergroup: Admin","disabled":false,"info":""},{"id":"7f6ad50d.a4b3fc","type":"tab","label":"Sender Node","disabled":false,"info":""},{"id":"fa0de9cf.c93278","type":"tab","label":"Uniswap","disabled":false,"info":""},{"id":"f394d95a.d75788","type":"tab","label":"Group Subscription","disabled":false,"info":""},{"id":"da2025ff.761318","type":"tab","label":"SDK v2","disabled":false,"info":""},{"id":"210c8349.faea1c","type":"tab","label":"Wyre Flow","disabled":false,"info":""},{"id":"ad871773.081998","type":"tab","label":"Test","disabled":false,"info":""},{"id":"96df2934.085a08","type":"tab","label":"SDK Test Nodes","disabled":false,"info":""},{"id":"767fa731.3692c8","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"bc40755d.eab8d8","type":"subflow","name":"Initilise User","info":"","category":"","in":[{"x":100,"y":320,"wires":[{"id":"6c5317fe.3ef4a8"}]}],"out":[{"x":1200,"y":280,"wires":[{"id":"fc8cca1d.752908","port":0},{"id":"9f5eeaab.730608","port":1}]},{"x":1200,"y":320,"wires":[{"id":"5e290d0e.4c22b4","port":1},{"id":"6d6a8358.cc9e3c","port":1}]}],"env":[],"color":"#DDAA99"},{"id":"33ebc494.dc22bc","type":"subflow","name":"getChatMember","info":"","category":"","in":[{"x":500,"y":260,"wires":[{"id":"1a4ac8ff.e58037"},{"id":"b99af44b.38f5c8"}]}],"out":[{"x":800,"y":260,"wires":[{"id":"1a4ac8ff.e58037","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"53555e84.c49f2","type":"subflow","name":"Telegram Sender With Tracking","info":"","category":"","in":[{"x":200,"y":280,"wires":[{"id":"ee6ec891.94ad58"}]}],"out":[{"x":780,"y":280,"wires":[{"id":"85b9632d.52788","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"d68707d.4b33bf8","type":"subflow","name":"kickChatMember","info":"","category":"","in":[{"x":340,"y":320,"wires":[{"id":"f9be4c51.91068"},{"id":"9ee8b922.7c0558"}]}],"out":[{"x":700,"y":320,"wires":[{"id":"f9be4c51.91068","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"a9c470a9.c7195","type":"subflow","name":"Balance ERC20","info":"","category":"","in":[{"x":360,"y":300,"wires":[{"id":"fc5d2e89.b97fb"}]}],"out":[{"x":780,"y":300,"wires":[{"id":"fc5d2e89.b97fb","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"c5f445fd.379ed8","type":"subflow","name":"SDK v2 Helper","info":"","category":"","in":[{"x":320,"y":140,"wires":[{"id":"e1e52dd5.e56b8"}]}],"out":[{"x":660,"y":140,"wires":[{"id":"e1e52dd5.e56b8","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"cf595613.fa3b68","type":"subflow","name":"Get Eth Balance","info":"","category":"","in":[{"x":400,"y":220,"wires":[{"id":"e6eab20a.de1cb"}]}],"out":[{"x":700,"y":220,"wires":[{"id":"e6eab20a.de1cb","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"d017622.56f92a","type":"subflow","name":"ETH and Token Balance","info":"","category":"","in":[{"x":40,"y":140,"wires":[{"id":"8c4a6e2f.c3a8d"},{"id":"9fe5b941.4bd478"}]}],"out":[{"x":1320,"y":140,"wires":[{"id":"970686e2.247638","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"bc5c5eb0.964c7","type":"subflow","name":"Encode Data","info":"","category":"","in":[{"x":420,"y":240,"wires":[{"id":"6a0e6717.c61758"}]}],"out":[{"x":720,"y":240,"wires":[{"id":"6a0e6717.c61758","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"9d822e4e.1a2a4","type":"subflow","name":"deleteMessage","info":"","category":"","in":[{"x":340,"y":300,"wires":[{"id":"b449ab29.864418"}]}],"out":[{"x":720,"y":300,"wires":[{"id":"b449ab29.864418","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"8988a490.b97c78","type":"node-config-airtable","z":"","name":"Airtable Config"},{"id":"4c02f411.5d93bc","type":"chatbot-telegram-node","z":"","botname":"Aragon Access Bot (Gandolf)","usernames":"","providerToken":"","polling":"1000","store":"","log":"","debug":false,"webHook":"","connectMode":"polling"},{"id":"a14f34a8.6de568","type":"inject","z":"ad871773.081998","name":"","topic":"","payload":"{}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":250,"y":360,"wires":[["d3d76a78.089838"]]},{"id":"1a4ac8ff.e58037","type":"function","z":"33ebc494.dc22bc","name":"","func":"const Telegram = global.get('telegram');\nconst token = msg.payload.token;\n\nconst telegram = new Telegram(token, {\n  agent: null,        // https.Agent instance, allows custom proxy, certificate, keep alive, etc.\n  webhookReply: true  // Reply via webhook\n})\n\nasync function getChatMember() {\n    try{\n    const chatMember = await telegram.getChatMember(msg.payload.chatId, msg.payload.userId);\n        msg.payload.chatMember = chatMember;\n        node.send(msg);\n        node.done();\n    }catch(error){\n        msg.payload.error = error;\n        node.done();\n    }\n    \n}\n\ngetChatMember();\n\n\nreturn","outputs":1,"noerr":0,"x":670,"y":260,"wires":[[]]},{"id":"cd67a0b4.41897","type":"debug","z":"ad871773.081998","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":970,"y":360,"wires":[]},{"id":"d3d76a78.089838","type":"change","z":"ad871773.081998","name":"","rules":[{"t":"set","p":"payload.token","pt":"msg","to":"1120382864:AAHRXCs7-l9uxZKhHYaSLjvV0BAkbZ2rvYs","tot":"str"},{"t":"set","p":"payload.chatId","pt":"msg","to":"-1001437457269","tot":"str"},{"t":"set","p":"payload.userId","pt":"msg","to":"897802142","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":360,"wires":[["fa208929.243508"]]},{"id":"a473a83f.199cb8","type":"debug","z":"ad871773.081998","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":620,"y":440,"wires":[]},{"id":"94feb0a3.54073","type":"function","z":"bc40755d.eab8d8","name":"Get User","func":"// msg.payload.filter = `({user_id} = '${msg.payload.userId.toString()}')`;\n// return msg;\nif(msg.payload.tableName === undefined){\n    msg.payload.tableName = 'user';\n}\nmsg.payload.filter = `AND({user_id} = '${msg.payload.userId.toString()}', {chat_id} = '${msg.payload.chatId.toString()}')`;\nreturn msg;","outputs":1,"noerr":0,"x":400,"y":360,"wires":[["5e290d0e.4c22b4"]]},{"id":"5e290d0e.4c22b4","type":"node-airtable","z":"bc40755d.eab8d8","name":"Get User","auth":"8988a490.b97c78","table":"payload.tableName","tableType":"msg","action":"list","filter":"payload.filter","filterType":"msg","record":"payload","recordType":"msg","records":"","recordsType":"msg","output":"payload.result","x":580,"y":320,"wires":[["9f5eeaab.730608"],[]]},{"id":"9f5eeaab.730608","type":"function","z":"bc40755d.eab8d8","name":"Get Or Add New USer","func":"result = msg.payload.result;\ndelete msg.payload.filter;\ndelete msg.payload.result;\nif(JSON.stringify(result) === '{}'){\n    msg.payload.user = {\n        \"user_id\": msg.payload.userId.toString(),\n        \"chat_id\": msg.payload.chatId.toString(),\n        \"user_name\": msg.payload.username,\n         ...msg.payload.extraParms\n    }\n    return [msg ,null]\n}else{\n    msg.payload.user = result[0];\n    msg.payload.user.newUser = false;\n    return [null,msg];\n}\nreturn;","outputs":2,"noerr":0,"x":780,"y":280,"wires":[["6d6a8358.cc9e3c"],[]]},{"id":"6d6a8358.cc9e3c","type":"node-airtable","z":"bc40755d.eab8d8","name":"Add user to airtable","auth":"8988a490.b97c78","table":"payload.tableName","tableType":"msg","action":"post","filter":"","filterType":"msg","record":"payload.user","recordType":"msg","records":"","recordsType":"msg","output":"payload.user","x":1010,"y":260,"wires":[["fc8cca1d.752908"],[]]},{"id":"fc8cca1d.752908","type":"change","z":"bc40755d.eab8d8","name":"","rules":[{"t":"set","p":"payload.user.newUser","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1050,"y":200,"wires":[[]]},{"id":"9f42e41d.aa8838","type":"comment","z":"727c54f5.3975dc","name":"Update airtable keys in this table config. (DO NOT DELETE, JUST UPDATE)","info":"","x":420,"y":60,"wires":[]},{"id":"63188c02.4a0ef4","type":"node-airtable","z":"727c54f5.3975dc","name":"Airtable Confing","auth":"8988a490.b97c78","table":"user","tableType":"str","action":"list","filter":"","filterType":"msg","record":"payload.id","recordType":"msg","records":"","recordsType":"msg","output":"","x":240,"y":120,"wires":[[],[]]},{"id":"275abbb6.da0074","type":"chatbot-telegram-receive","z":"727c54f5.3975dc","bot":"4c02f411.5d93bc","botProduction":"","x":470,"y":120,"wires":[[]]},{"id":"f1a8db6b.e3f508","type":"chatbot-telegram-receive","z":"727c54f5.3975dc","bot":"4c02f411.5d93bc","botProduction":"","x":150,"y":820,"wires":[["eb3d5b1.75087a8","e831e284.33d39"]]},{"id":"eb3d5b1.75087a8","type":"debug","z":"727c54f5.3975dc","name":"Telegram Input Node","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":260,"y":760,"wires":[]},{"id":"c8b30e6f.884b6","type":"change","z":"727c54f5.3975dc","name":"","rules":[{"t":"set","p":"payload.username","pt":"msg","to":"originalMessage.from.username","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":740,"y":820,"wires":[["3cf2cc9d.273e24"]]},{"id":"6b602645.e10a68","type":"link in","z":"845fee24.1a24a","name":"In: Supergroup","links":["9509ae7a.c5c73","77f15d2e.799384"],"x":235,"y":400,"wires":[["349e420.28bf4be","1a7a6373.4cc93d"]]},{"id":"349e420.28bf4be","type":"chatbot-command","z":"845fee24.1a24a","name":"","command":"/gandolfawaken","x":420,"y":400,"wires":[["e45ab346.9b43f"]]},{"id":"595822b.86ec1dc","type":"comment","z":"845fee24.1a24a","name":"Check if admin or creator of group","info":"","x":660,"y":340,"wires":[]},{"id":"fa208929.243508","type":"subflow:33ebc494.dc22bc","z":"ad871773.081998","name":"getChatMember","env":[],"x":700,"y":360,"wires":[["cd67a0b4.41897"]]},{"id":"e45ab346.9b43f","type":"change","z":"845fee24.1a24a","name":"","rules":[{"t":"set","p":"payload.token","pt":"msg","to":"token_access_bot","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":660,"y":400,"wires":[["2ffa416c.0e011e"]]},{"id":"2ffa416c.0e011e","type":"subflow:33ebc494.dc22bc","z":"845fee24.1a24a","name":"getChatMember","env":[],"x":900,"y":400,"wires":[["c99ef655.388698","e980ae7a.0dca6"]]},{"id":"bb84725f.8d84d","type":"inject","z":"727c54f5.3975dc","name":"Set Bot Token","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":260,"y":180,"wires":[["334394af.db76bc"]]},{"id":"334394af.db76bc","type":"change","z":"727c54f5.3975dc","name":"","rules":[{"t":"set","p":"token_access_bot","pt":"global","to":"1093289797:AAFkQJZJ1YMJnQii73tT9A9PlfvocjjtMAI","tot":"str"},{"t":"set","p":"bot_handle","pt":"global","to":"@GandolfAccess_bot","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":180,"wires":[[]]},{"id":"c99ef655.388698","type":"switch","z":"845fee24.1a24a","name":"","property":"payload.chatMember.status","propertyType":"msg","rules":[{"t":"eq","v":"creator","vt":"str"},{"t":"eq","v":"admin","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":1110,"y":400,"wires":[["fbb0d7d2.865728"],["fbb0d7d2.865728"],["d87c5da7.37834"]]},{"id":"befd67ba.d5cc88","type":"link in","z":"7f6ad50d.a4b3fc","name":"In: Sender Node","links":["7aed3dae.199544","82d39ccd.0eb9f","6894eeb4.56963","9e23aec9.8544b","dd9fe108.b255","6e787929.7ed6f8","2d8bbaae.ef3226","d8c74207.5e5c3","432016bc.94dcb8","be1f8e11.415f2","7fa98952.0a9f38","3933dd8.d824a22","eb03d39a.ec957","f51749be.e1b438","6de8a88d.3084e8","bcd877a4.8442a8","b2d8276d.e89f18","32596b5c.aff244","a0a5c983.918c88","f660dfd5.b22b6","aaf52b6d.7f3658","a0e315c3.b7d328","7bd81e81.8176f","df7f69f5.81f748","92a7a9a7.8a05b8","2f85b7bb.ebf388","285ebcfc.07e8a4","d846ef9d.111f8","1db8b6c6.ea9459","14c1c6f4.8bc129","df729b66.fde978","3c9ebcf.ff09044","e77262c.cf39ea","ae4a34f2.cef9f8","d35887f9.e01a08","fb22cb6b.22d6a8","c2d1a898.4bd8a8","6e9e625b.c25bec","e7ca2b5d.7d5548","ccd1b3c3.97e7f","8cf8de56.0bf32","12180bad.342cd4","72f09956.918b58","2d1562ed.bd70de","ec723a5d.e4bd68","278fb3cf.24b24c"],"x":295,"y":260,"wires":[["76ba88fb.2d0928"]]},{"id":"249b01ca.f50c2e","type":"debug","z":"7f6ad50d.a4b3fc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":705,"y":260,"wires":[]},{"id":"c6a2eeb9.c2e8f","type":"change","z":"7f6ad50d.a4b3fc","name":"","rules":[{"t":"set","p":"payload.type","pt":"msg","to":"action","tot":"str"},{"t":"set","p":"payload.content","pt":"msg","to":"typing","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":380,"wires":[["7138ab96.26c0f4"]]},{"id":"cd49825f.12ee8","type":"link in","z":"7f6ad50d.a4b3fc","name":"In: Typing","links":["21a1c78a.46f468","fa862f71.d969a","1c88f636.201aba","10b9e7e7.b6c948","d53b167a.063018","41eb19f4.bc06c8"],"x":290,"y":380,"wires":[["c6a2eeb9.c2e8f"]]},{"id":"76ba88fb.2d0928","type":"chatbot-telegram-send","z":"7f6ad50d.a4b3fc","bot":"4c02f411.5d93bc","botProduction":"","track":false,"passThrough":false,"outputs":0,"x":490,"y":260,"wires":[]},{"id":"7138ab96.26c0f4","type":"chatbot-telegram-send","z":"7f6ad50d.a4b3fc","bot":"4c02f411.5d93bc","botProduction":"","track":false,"passThrough":false,"outputs":0,"x":710,"y":380,"wires":[]},{"id":"ee6ec891.94ad58","type":"chatbot-telegram-send","z":"53555e84.c49f2","bot":"4c02f411.5d93bc","botProduction":"","track":true,"passThrough":false,"outputs":1,"x":370,"y":280,"wires":[["85b9632d.52788"]]},{"id":"85b9632d.52788","type":"subflow:bc40755d.eab8d8","z":"53555e84.c49f2","name":"","env":[],"x":610,"y":280,"wires":[[],[]]},{"id":"d87c5da7.37834","type":"function","z":"845fee24.1a24a","name":"","func":"msg.payload.content = `Unauthorized, This command is only for admin users.`;\nreturn msg;","outputs":1,"noerr":0,"x":1270,"y":460,"wires":[["ccd1b3c3.97e7f"]]},{"id":"ccd1b3c3.97e7f","type":"link out","z":"845fee24.1a24a","name":"Out: Sender","links":["befd67ba.d5cc88"],"x":1395,"y":460,"wires":[]},{"id":"fe2da628.e311d8","type":"link in","z":"845fee24.1a24a","name":"In: Admin Setup","links":["30518411.c73b3c","22cbf41d.97cf3c"],"x":195,"y":840,"wires":[["14184612.3dd67a"]]},{"id":"1711f965.ba1827","type":"function","z":"845fee24.1a24a","name":"Invite link","func":"cache = global.get(msg.payload.userId.toString());\ncache.groupLink = msg.payload.content;\nglobal.set(msg.payload.userId.toString(), cache); \nreturn msg;","outputs":1,"noerr":0,"x":1000,"y":840,"wires":[["69b30433.a040cc","20634e06.3ea032"]]},{"id":"69b30433.a040cc","type":"function","z":"845fee24.1a24a","name":"Token Symbol","func":"msg.payload.content = `Please provide the token symbol you want me to search for in members.`;\n\nreturn msg;","outputs":1,"noerr":0,"x":380,"y":900,"wires":[["8286be10.e5049"]]},{"id":"5b7ac9e.d748938","type":"function","z":"845fee24.1a24a","name":"Token symbol ","func":"cache = global.get(msg.payload.userId.toString());\ncache.tokenSymbol = msg.payload.content;\nglobal.set(msg.payload.userId.toString(), cache); \nreturn msg;","outputs":1,"noerr":0,"x":1000,"y":920,"wires":[["37552de2.c7d9e2","3492974f.e2a498"]]},{"id":"cc48c09c.9df91","type":"function","z":"845fee24.1a24a","name":"Required tokens","func":"msg.payload.content = `Thanks. How many tokens do people need to enter the group?`;\nreturn msg;","outputs":1,"noerr":0,"x":380,"y":1060,"wires":[["645db7ab.a18bd8"]]},{"id":"700e37a.48d81c8","type":"function","z":"845fee24.1a24a","name":"Required tokens","func":"cache = global.get(msg.payload.userId.toString());\ncache.requiredTokens = msg.payload.content;\nglobal.set(msg.payload.userId.toString(), cache); \nreturn msg;","outputs":1,"noerr":0,"x":1000,"y":1080,"wires":[["16af4204.9de5de","d18beb71.64aeb8"]]},{"id":"8cf8de56.0bf32","type":"link out","z":"845fee24.1a24a","name":"","links":["befd67ba.d5cc88"],"x":1535,"y":1180,"wires":[]},{"id":"e980ae7a.0dca6","type":"debug","z":"845fee24.1a24a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":930,"y":360,"wires":[]},{"id":"b99af44b.38f5c8","type":"debug","z":"33ebc494.dc22bc","name":"Get Chat Member","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":710,"y":320,"wires":[]},{"id":"3cf2cc9d.273e24","type":"switch","z":"727c54f5.3975dc","name":"","property":"originalMessage.chat.type","propertyType":"msg","rules":[{"t":"eq","v":"private","vt":"str"},{"t":"eq","v":"supergroup","vt":"str"},{"t":"eq","v":"group","vt":"str"},{"t":"eq","v":"otherwise","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":950,"y":820,"wires":[["fc0a9be1.9328c8","fec188fb.4c9928"],["32e34810.b17e98","77f15d2e.799384"],["32e34810.b17e98","77f15d2e.799384"],[]]},{"id":"77f15d2e.799384","type":"link out","z":"727c54f5.3975dc","name":"Out: Supergroup","links":["6b602645.e10a68"],"x":1155,"y":820,"wires":[]},{"id":"fbb0d7d2.865728","type":"function","z":"845fee24.1a24a","name":"User Cache","func":"cache = global.get(msg.payload.userId.toString());\nif(cache === undefined){\n    cache = {};\n}\ncache.status = 'active';\nglobal.set(msg.payload.userId.toString(), cache);\nreturn msg;","outputs":1,"noerr":0,"x":1290,"y":380,"wires":[["22cbf41d.97cf3c"]]},{"id":"22cbf41d.97cf3c","type":"link out","z":"845fee24.1a24a","name":"Out: Admin Setup","links":["fe2da628.e311d8"],"x":1435,"y":380,"wires":[]},{"id":"32e34810.b17e98","type":"chatbot-command","z":"727c54f5.3975dc","name":"","command":"/start","x":1110,"y":880,"wires":[["1647d54d.2553eb"]]},{"id":"1647d54d.2553eb","type":"debug","z":"727c54f5.3975dc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1170,"y":940,"wires":[]},{"id":"3d82c742.86e778","type":"function","z":"845fee24.1a24a","name":"","func":"cache = global.get(msg.payload.userId.toString());\n\nmsg.payload.record = [\n    {\n        \"id\": msg.payload.groupRecordId,\n        \"fields\": {\n            \"group_link\" : cache.groupLink,\n            \"token_address\" : cache.tokenContractAddress,\n            \"min_token\" : cache.requiredTokens,\n            \"token_symbol\" : cache.tokenSymbol,\n            \"group_name\" : msg.originalMessage.chat.title,\n            \"user_name\" : msg.originalMessage.from.username,\n            \"status\" : cache.status\n        }\n    }\n]\nmsg.payload.config = {\n    \"tokenAddress\" : cache.tokenContractAddress\n}\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":1180,"wires":[["acf5ab3f.56ea68"]]},{"id":"1757d27a.15183e","type":"node-airtable","z":"845fee24.1a24a","name":"Upate group table","auth":"8988a490.b97c78","table":"group","tableType":"str","action":"put","filter":"","filterType":"msg","record":"payload.record","recordType":"msg","records":"payload.record","recordsType":"msg","output":"payload.result","x":1110,"y":1240,"wires":[["5e83582d.dc8368"],[]]},{"id":"1b0efe75.877c62","type":"function","z":"ad871773.081998","name":"Get User","func":"msg.payload.filter = `AND({user_id} = '${msg.payload.userId.toString()}', {chat_id} = '${msg.payload.chatId.toString()}')`;\nreturn msg;","outputs":1,"noerr":0,"x":620,"y":640,"wires":[["76f08c67.738954","f9ea966c.d876c8"]]},{"id":"76f08c67.738954","type":"node-airtable","z":"ad871773.081998","name":"Get User","auth":"8988a490.b97c78","table":"user","tableType":"str","action":"list","filter":"payload.filter","filterType":"msg","record":"payload","recordType":"msg","records":"","recordsType":"msg","output":"payload.result","x":840,"y":640,"wires":[["40a8b25c.c7c63c"],[]]},{"id":"6828500c.4401a","type":"inject","z":"ad871773.081998","name":"","topic":"","payload":"{}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":190,"y":640,"wires":[["4ccf5d38.8abc94"]]},{"id":"4ccf5d38.8abc94","type":"change","z":"ad871773.081998","name":"","rules":[{"t":"set","p":"payload.token","pt":"msg","to":"1120382864:AAHRXCs7-l9uxZKhHYaSLjvV0BAkbZ2rvYs","tot":"str"},{"t":"set","p":"payload.chatId","pt":"msg","to":"-1001437457269","tot":"str"},{"t":"set","p":"payload.userId","pt":"msg","to":"897802142","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":640,"wires":[["1b0efe75.877c62"]]},{"id":"40a8b25c.c7c63c","type":"debug","z":"ad871773.081998","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1010,"y":640,"wires":[]},{"id":"f9ea966c.d876c8","type":"debug","z":"ad871773.081998","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload.filter","targetType":"msg","x":890,"y":700,"wires":[]},{"id":"5e83582d.dc8368","type":"switch","z":"845fee24.1a24a","name":"","property":"payload.result","propertyType":"msg","rules":[{"t":"istype","v":"array","vt":"array"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1090,"y":1180,"wires":[["4b8a3cfa.d90474"],["ee11a880.540688"]]},{"id":"4b8a3cfa.d90474","type":"function","z":"845fee24.1a24a","name":"Setup completed","func":"cache = global.get(msg.payload.userId.toString());\nif(cache.status === \"active\"){\n   msg.payload.content = `Congratulations!!! I'm ready to work for your group.`; \n}else{\n    msg.payload.content = `Congratulations!!! I'm ready to work for your group. To complete account setup please send /verify in your group chat.`;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1330,"y":1160,"wires":[["8cf8de56.0bf32","58d1436a.1e1e0c"]]},{"id":"ee11a880.540688","type":"function","z":"845fee24.1a24a","name":"Error","func":"msg.payload.content = `Something went wrong, Please contact bot creator.`;\nreturn msg;","outputs":1,"noerr":0,"x":1290,"y":1200,"wires":[["8cf8de56.0bf32","58d1436a.1e1e0c"]]},{"id":"d4cfcce6.3a55c","type":"chatbot-telegram-send","z":"845fee24.1a24a","bot":"4c02f411.5d93bc","botProduction":"","track":true,"passThrough":false,"outputs":1,"x":650,"y":840,"wires":[["ff292910.2186f8"]]},{"id":"8286be10.e5049","type":"chatbot-telegram-send","z":"845fee24.1a24a","bot":"4c02f411.5d93bc","botProduction":"","track":true,"passThrough":false,"outputs":1,"x":610,"y":900,"wires":[["3dfcb047.4eae5"]]},{"id":"645db7ab.a18bd8","type":"chatbot-telegram-send","z":"845fee24.1a24a","bot":"4c02f411.5d93bc","botProduction":"","track":true,"passThrough":false,"outputs":1,"x":610,"y":1060,"wires":[["ecb26bea.daf148"]]},{"id":"b372d98d.080f58","type":"function","z":"bc40755d.eab8d8","name":"Get User","func":"// msg.payload.filter = `({user_id} = '${msg.payload.userId.toString()}')`;\n// return msg;\nif(msg.payload.tableName === undefined){\n    msg.payload.tableName = 'user';\n}\nmsg.payload.filter = `AND({user_id} = '${msg.payload.userId.toString()}', {chat_id} = '${msg.payload.groupId.toString()}')`;\nreturn msg;","outputs":1,"noerr":0,"x":400,"y":280,"wires":[["5e290d0e.4c22b4"]]},{"id":"6c5317fe.3ef4a8","type":"switch","z":"bc40755d.eab8d8","name":"","property":"payload.filterBy","propertyType":"msg","rules":[{"t":"eq","v":"groupId","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":230,"y":320,"wires":[["b372d98d.080f58"],["94feb0a3.54073"]]},{"id":"f9be4c51.91068","type":"function","z":"d68707d.4b33bf8","name":"","func":"const Telegram = global.get('telegram');\nconst token = msg.payload.token;\n\nconst telegram = new Telegram(token, {\n  agent: null,        // https.Agent instance, allows custom proxy, certificate, keep alive, etc.\n  webhookReply: true  // Reply via webhook\n})\n\nasync function getChatMember() {\n    try{\n    const result = await telegram.kickChatMember(msg.payload.chatId, msg.payload.userId);\n        msg.payload.result = result;\n        node.send(msg);\n        node.done();\n    }catch(error){\n        msg.payload.error = error;\n        node.send(msg);\n        node.done();\n    }\n    \n}\n\ngetChatMember();\n\n\nreturn","outputs":1,"noerr":0,"x":510,"y":320,"wires":[[]]},{"id":"9ee8b922.7c0558","type":"debug","z":"d68707d.4b33bf8","name":"Kick Chat Member","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":510,"y":380,"wires":[]},{"id":"5ed0407e.f3489","type":"inject","z":"ad871773.081998","name":"","topic":"","payload":"{}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":230,"y":240,"wires":[["b9839a4e.1a07a8"]]},{"id":"c1ba5016.ea36f","type":"debug","z":"ad871773.081998","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":950,"y":240,"wires":[]},{"id":"b9839a4e.1a07a8","type":"change","z":"ad871773.081998","name":"","rules":[{"t":"set","p":"payload.token","pt":"msg","to":"1120382864:AAHRXCs7-l9uxZKhHYaSLjvV0BAkbZ2rvYs","tot":"str"},{"t":"set","p":"payload.chatId","pt":"msg","to":"-1001437457269","tot":"str"},{"t":"set","p":"payload.userId","pt":"msg","to":"897802142","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":440,"y":240,"wires":[["6287751a.0d6c8c"]]},{"id":"6287751a.0d6c8c","type":"subflow:d68707d.4b33bf8","z":"ad871773.081998","name":"","env":[],"x":680,"y":240,"wires":[["c1ba5016.ea36f"]]},{"id":"3a5c4071.0f209","type":"inject","z":"727c54f5.3975dc","name":"ERC20 Abi","topic":"","payload":"[{\"constant\":true,\"inputs\":[],\"name\":\"name\",\"outputs\":[{\"name\":\"\",\"type\":\"string\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_spender\",\"type\":\"address\"},{\"name\":\"_value\",\"type\":\"uint256\"}],\"name\":\"approve\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"totalSupply\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_from\",\"type\":\"address\"},{\"name\":\"_to\",\"type\":\"address\"},{\"name\":\"_value\",\"type\":\"uint256\"}],\"name\":\"transferFrom\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"decimals\",\"outputs\":[{\"name\":\"\",\"type\":\"uint8\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_owner\",\"type\":\"address\"}],\"name\":\"balanceOf\",\"outputs\":[{\"name\":\"balance\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"symbol\",\"outputs\":[{\"name\":\"\",\"type\":\"string\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_to\",\"type\":\"address\"},{\"name\":\"_value\",\"type\":\"uint256\"}],\"name\":\"transfer\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"_owner\",\"type\":\"address\"},{\"name\":\"_spender\",\"type\":\"address\"}],\"name\":\"allowance\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"fallback\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"owner\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"spender\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"value\",\"type\":\"uint256\"}],\"name\":\"Approval\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"from\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"to\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"value\",\"type\":\"uint256\"}],\"name\":\"Transfer\",\"type\":\"event\"}]","payloadType":"json","repeat":"","crontab":"","once":true,"onceDelay":"0.2","x":250,"y":460,"wires":[["a1c1945f.874738"]]},{"id":"a1c1945f.874738","type":"json","z":"727c54f5.3975dc","name":"","property":"payload","action":"obj","pretty":false,"x":510,"y":460,"wires":[["34ae332.abab0cc"]]},{"id":"34ae332.abab0cc","type":"change","z":"727c54f5.3975dc","name":"Abi ERC20","rules":[{"t":"set","p":"abi_erc20","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":710,"y":460,"wires":[[]]},{"id":"47bf935c.d9244c","type":"switch","z":"f394d95a.d75788","name":"","property":"records.length","propertyType":"msg","rules":[{"t":"gt","v":"0","vt":"str"},{"t":"nempty"}],"checkall":"true","repair":false,"outputs":2,"x":870,"y":360,"wires":[["1555f726.1a0ee9"],[]]},{"id":"ef854201.0ce86","type":"node-airtable","z":"f394d95a.d75788","name":"Airtable Confing","auth":"8988a490.b97c78","table":"user","tableType":"str","action":"list","filter":"({status} = 'active')","filterType":"str","record":"payload.id","recordType":"msg","records":"","recordsType":"msg","output":"records","x":700,"y":360,"wires":[["47bf935c.d9244c","b3014013.88ad2"],[]]},{"id":"69d424f3.41bdec","type":"function","z":"f394d95a.d75788","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"x":1230,"y":420,"wires":[["1555f726.1a0ee9","34c346a9.e0ecea"]]},{"id":"d348eeaa.604de","type":"delay","z":"f394d95a.d75788","name":"","pauseType":"delay","timeout":"500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1070,"y":420,"wires":[["69d424f3.41bdec"]]},{"id":"b3014013.88ad2","type":"debug","z":"f394d95a.d75788","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":870,"y":300,"wires":[]},{"id":"34c346a9.e0ecea","type":"link out","z":"f394d95a.d75788","name":"","links":["5fbf4acb.3b03b4"],"x":1395,"y":420,"wires":[]},{"id":"1555f726.1a0ee9","type":"array-loop","z":"f394d95a.d75788","name":"","key":"123","keyType":"msg","reset":false,"resetValue":"value-null","array":"records","arrayType":"msg","x":1090,"y":360,"wires":[["7cf6dea6.2bdd1"],["d348eeaa.604de"]]},{"id":"fc5d2e89.b97fb","type":"function","z":"a9c470a9.c7195","name":"Get ERC 20 Token Balance","func":"ethers = global.get('ethers');\nlet provider = ethers.getDefaultProvider(msg.payload.network);\nlet contract = new ethers.Contract(msg.payload.address_contract, msg.payload.abi, provider);\n\nasync function getBalance () {\n    try{\n        const balance = await contract.balanceOf(msg.payload.address);\n        msg.payload.tokenBalance = ethers.utils.formatEther(balance);\n    }catch(error){\n        msg.payload.error = error;\n    }\n    node.send(msg);\n    node.done();\n}\n\ngetBalance();\nreturn;","outputs":1,"noerr":0,"x":560,"y":300,"wires":[[]]},{"id":"f3c694a.83b2168","type":"inject","z":"ad871773.081998","name":"","topic":"","payload":"{}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":210,"y":900,"wires":[["fbb3a4be.56f198"]]},{"id":"fbb3a4be.56f198","type":"change","z":"ad871773.081998","name":"","rules":[{"t":"set","p":"payload.network","pt":"msg","to":"kovan","tot":"str"},{"t":"set","p":"payload.address_contract","pt":"msg","to":"0x4f96fe3b7a6cf9725f59d353f723c1bdb64ca6aa","tot":"str"},{"t":"set","p":"payload.address","pt":"msg","to":"0x7772b73FC7ceec54f150A50c2e8a8237b0cB2280","tot":"str"},{"t":"set","p":"payload.abi","pt":"msg","to":"abi_erc20","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":900,"wires":[["402389df.5c5b78"]]},{"id":"54de4541.4f074c","type":"debug","z":"ad871773.081998","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":850,"y":900,"wires":[]},{"id":"402389df.5c5b78","type":"subflow:a9c470a9.c7195","z":"ad871773.081998","name":"","env":[],"x":640,"y":900,"wires":[["54de4541.4f074c"]]},{"id":"5fbf4acb.3b03b4","type":"link in","z":"f394d95a.d75788","name":"","links":["34c346a9.e0ecea"],"x":295,"y":740,"wires":[["5596c317.1bc8bc"]]},{"id":"bd596a4.922bc98","type":"comment","z":"f394d95a.d75788","name":"Check if token address is cached","info":"","x":410,"y":700,"wires":[]},{"id":"be3216bf.f72728","type":"function","z":"f394d95a.d75788","name":"Token address cache","func":"tokenAddress = flow.get('token_address');\nif(tokenAddress === undefined){\n    tokenAddress = {};\n}\nflow.set('token_address', tokenAddress);\nreturn msg;","outputs":1,"noerr":0,"x":480,"y":340,"wires":[["ef854201.0ce86"]]},{"id":"5596c317.1bc8bc","type":"function","z":"f394d95a.d75788","name":"","func":"temp = msg.payload;\nmsg.payload = {};\nmsg.payload.user = temp;\n\ntokenAddress = flow.get('token_address');\nif(tokenAddress[msg.payload.user.fields.chat_id] === undefined){\n    msg.payload.id = msg.payload.user.fields.group_id[0];\n    return [null, msg]\n}\nmsg.payload.group = tokenAddress[msg.payload.user.fields.chat_id];\nreturn [msg, null];","outputs":2,"noerr":0,"x":430,"y":740,"wires":[["a0fdf976.1f8eb8"],["650c7170.40ec2"]]},{"id":"650c7170.40ec2","type":"node-airtable","z":"f394d95a.d75788","name":"Airtable Confing","auth":"8988a490.b97c78","table":"group","tableType":"str","action":"get","filter":"","filterType":"msg","record":"payload.id","recordType":"msg","records":"","recordsType":"msg","output":"payload.group","x":640,"y":760,"wires":[["cf7ab2d0.8c1f3"],[]]},{"id":"cf7ab2d0.8c1f3","type":"function","z":"f394d95a.d75788","name":"","func":"tokenAddress = flow.get('token_address');\ntokenAddress[msg.payload.user.fields.chat_id] = msg.payload.group;\nflow.set('token_address', tokenAddress);\nreturn msg;","outputs":1,"noerr":0,"x":850,"y":760,"wires":[["f1007572.1cb638"]]},{"id":"5ef0f084.bf5f4","type":"link in","z":"f394d95a.d75788","name":"In:  Token","links":["a0fdf976.1f8eb8","f1007572.1cb638","87a395b7.96a4d8","3324de1b.436822","85e69273.b0a76"],"x":235,"y":860,"wires":[["e9a2680d.f0fa68","cd9ae073.eeebb"]]},{"id":"a0fdf976.1f8eb8","type":"link out","z":"f394d95a.d75788","name":"","links":["5ef0f084.bf5f4"],"x":575,"y":720,"wires":[]},{"id":"f1007572.1cb638","type":"link out","z":"f394d95a.d75788","name":"","links":["5ef0f084.bf5f4"],"x":975,"y":760,"wires":[]},{"id":"89402c6d.5b412","type":"comment","z":"f394d95a.d75788","name":"Check for valid token amount","info":"","x":260,"y":1280,"wires":[]},{"id":"1490b0c5.5a69cf","type":"change","z":"f394d95a.d75788","name":"Metamask","rules":[{"t":"set","p":"payload.address","pt":"msg","to":"payload.user.account.fields.wallet_address","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":510,"y":1000,"wires":[["b5d9ee70.882b6"]]},{"id":"c904c5e.816d738","type":"subflow:a9c470a9.c7195","z":"f394d95a.d75788","name":"","env":[],"x":920,"y":1060,"wires":[["7f56f6a3.cdba18","75c0262e.b1d618"]]},{"id":"7268e685.89f398","type":"inject","z":"727c54f5.3975dc","name":"Set: Mainnet / Kovan","topic":"","payload":"{\"_comment\":\"change kovan/mainnet\",\"network\":\"mainnet\"}","payloadType":"json","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":280,"y":300,"wires":[["1099ed69.47b893"]]},{"id":"267cf2d2.e28a3e","type":"change","z":"727c54f5.3975dc","name":"Kovan Const","rules":[{"t":"set","p":"network","pt":"global","to":"kovan","tot":"str"},{"t":"set","p":"wyre_link","pt":"global","to":"https://pay.testwyre.com/purchase","tot":"str"},{"t":"set","p":"wyre_account_id","pt":"global","to":"AC_3N8VHCTUZYC","tot":"str"},{"t":"set","p":"queryProviderEndPoint","pt":"global","to":"https://kovan.infura.io/v3/7acf175321ac4b3cba908ec2111dc297","tot":"str"},{"t":"set","p":"address_contract_uniswap_exchange","pt":"global","to":"0xD3E51Ef092B2845f10401a0159B2B96e8B6c3D30","tot":"str"},{"t":"set","p":"ether_scan_url","pt":"global","to":"https://kovan.etherscan.io","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":730,"y":340,"wires":[["4508c256.83de2c"]]},{"id":"2b624b56.3c7e04","type":"debug","z":"f394d95a.d75788","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":830,"y":980,"wires":[]},{"id":"7f56f6a3.cdba18","type":"switch","z":"f394d95a.d75788","name":"","property":"payload.tokenBalance","propertyType":"msg","rules":[{"t":"gte","v":"payload.group.fields.min_token","vt":"msg"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":990,"y":1000,"wires":[[],["c409c16c.1b662"]]},{"id":"3425adcc.4d5872","type":"debug","z":"f394d95a.d75788","name":"Kick user","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1440,"y":1120,"wires":[]},{"id":"c3f75c67.d8a3e","type":"function","z":"f394d95a.d75788","name":"Token address cache","func":"tokenAddress = flow.get('token_address');\ntokenAddress = {};\nflow.set('token_address', tokenAddress);\nreturn msg;","outputs":1,"noerr":0,"x":1460,"y":340,"wires":[[]]},{"id":"7cf6dea6.2bdd1","type":"delay","z":"f394d95a.d75788","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1260,"y":340,"wires":[["c3f75c67.d8a3e"]]},{"id":"c4f52351.72e69","type":"comment","z":"f394d95a.d75788","name":"Runs every 5 mins","info":"","x":290,"y":280,"wires":[]},{"id":"cb5d1811.f2b208","type":"inject","z":"f394d95a.d75788","name":"","topic":"","payload":"{}","payloadType":"json","repeat":"300","crontab":"","once":true,"onceDelay":"3","x":270,"y":320,"wires":[["be3216bf.f72728"]]},{"id":"72360d31.b19164","type":"subflow:d68707d.4b33bf8","z":"f394d95a.d75788","name":"","env":[],"x":1430,"y":1060,"wires":[["7ce0fbb1.99e3f4","bf4be6b8.80bac8"]]},{"id":"c409c16c.1b662","type":"change","z":"f394d95a.d75788","name":"","rules":[{"t":"set","p":"payload.token","pt":"msg","to":"token_access_bot","tot":"global"},{"t":"set","p":"payload.chatId","pt":"msg","to":"payload.group.fields.chat_id","tot":"msg"},{"t":"set","p":"payload.userId","pt":"msg","to":"payload.user.fields.user_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1180,"y":1020,"wires":[["72360d31.b19164"]]},{"id":"fec188fb.4c9928","type":"link out","z":"727c54f5.3975dc","name":"Out: Join Group","links":["798ea408.39a89c"],"x":1135,"y":720,"wires":[]},{"id":"798ea408.39a89c","type":"link in","z":"51a355d0.06a06c","name":"In: Join Group","links":["fec188fb.4c9928"],"x":95,"y":740,"wires":[["4ca4133e.ce51ec"]]},{"id":"e53ca635.23b948","type":"comment","z":"51a355d0.06a06c","name":"Get list of groups","info":"","x":460,"y":860,"wires":[]},{"id":"90b9626c.2e93d","type":"node-airtable","z":"51a355d0.06a06c","name":"Get groups","auth":"8988a490.b97c78","table":"group","tableType":"str","action":"list","filter":"({status} = 'active')","filterType":"str","record":"payload","recordType":"msg","records":"","recordsType":"msg","output":"payload.groups","x":610,"y":960,"wires":[["fc024350.95654"],[]]},{"id":"fc024350.95654","type":"function","z":"51a355d0.06a06c","name":"Goup Buttons","func":"\nbuttons = [];\nlet index = 1;\nmsg.payload.groups.forEach(function(group){\n  button = {\n\t\t\"type\": \"postback\",\n    \t\"label\": group.fields.group_name,\n    \t\"value\": `{\"id\":\"${group.id}\"}`,\n    \t\"alert\": false,\n    \t\"style\": \"\"\n\t}\n\tbuttons.push(button);\n\tif(index % 2 === 0){\n\t    buttons.push({\n\t        \"type\": \"newline\"\n\t    });\n\t}\n\tindex++;\n});\n\n// buttons.push(button = {\n// \t\"type\": \"postback\",\n// \t\"label\": \"Done\",\n// \t\"value\": `{\"en\":\"done\", \"d\":\"ar\", \"ac\":\"ad\"}`,\n// \t\"alert\": false,\n// \t\"style\": \"\"\n// });\n\nmsg.payload.type = \"inline-buttons\";\nmsg.payload.content = \"Which group would you like admittance to?\";\nmsg.payload.buttons = buttons;\n\nreturn msg;","outputs":1,"noerr":0,"x":800,"y":960,"wires":[["f4b5c919.337218"]]},{"id":"f4b5c919.337218","type":"chatbot-telegram-send","z":"51a355d0.06a06c","bot":"4c02f411.5d93bc","botProduction":"","track":true,"passThrough":false,"outputs":1,"x":1030,"y":960,"wires":[["e6651a4a.b03878","e305904f.16b89"]]},{"id":"e6651a4a.b03878","type":"switch","z":"51a355d0.06a06c","name":"","property":"payload.content","propertyType":"msg","rules":[{"t":"eq","v":"/cancel","vt":"str"},{"t":"istype","v":"json","vt":"json"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":1250,"y":960,"wires":[["72dfa227.baf4ec"],["3925ffa9.fa434"],[]]},{"id":"3925ffa9.fa434","type":"json","z":"51a355d0.06a06c","name":"","property":"payload.content","action":"obj","pretty":false,"x":1430,"y":960,"wires":[["1d549d8b.9279d2"]]},{"id":"1d549d8b.9279d2","type":"node-airtable","z":"51a355d0.06a06c","name":"Get group detail","auth":"8988a490.b97c78","table":"group","tableType":"str","action":"get","filter":"","filterType":"msg","record":"payload.content.id","recordType":"msg","records":"","recordsType":"msg","output":"payload.group","x":1640,"y":960,"wires":[["84cf2eb8.82454"],[]]},{"id":"401cb54e.94b4ac","type":"chatbot-telegram-send","z":"51a355d0.06a06c","bot":"4c02f411.5d93bc","botProduction":"","track":true,"passThrough":false,"outputs":1,"x":2130,"y":960,"wires":[["a07e7cb1.c6bac","f72351bc.5df84"]]},{"id":"84cf2eb8.82454","type":"function","z":"51a355d0.06a06c","name":"Goup Buttons","func":"\nbuttons = [];\n\nbuttons.push(button = {\n\t\"type\": \"postback\",\n\t\"label\": \"Join\",\n\t\"value\": `{\"id\":\"${msg.payload.group.id}\"}`,\n\t\"alert\": false,\n\t\"style\": \"\"\n});\n\nbuttons.push(button = {\n\t\"type\": \"postback\",\n\t\"label\": \"Back\",\n\t\"value\": `/back`,\n\t\"alert\": false,\n\t\"style\": \"\"\n});\n\nmsg.payload.type = \"inline-buttons\";\nmsg.payload.content = `\nName: ${msg.payload.group.fields.group_name}\nMin token: ${msg.payload.group.fields.min_token}\nToken symbool: ${msg.payload.group.fields.token_symbol}\nToken address: ${msg.payload.group.fields.token_address}\n`;\nmsg.payload.buttons = buttons;\n\nreturn msg;","outputs":1,"noerr":0,"x":1880,"y":960,"wires":[["401cb54e.94b4ac"]]},{"id":"a07e7cb1.c6bac","type":"switch","z":"51a355d0.06a06c","name":"","property":"payload.content","propertyType":"msg","rules":[{"t":"eq","v":"/back","vt":"str"},{"t":"eq","v":"/cancel","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":2330,"y":1020,"wires":[["90b9626c.2e93d"],["6a35ba0c.3a16c4"],["4b919493.48acec"]]},{"id":"4b919493.48acec","type":"json","z":"51a355d0.06a06c","name":"","property":"payload.content","action":"obj","pretty":false,"x":2490,"y":1040,"wires":[["9dab6b57.941328"]]},{"id":"eb439b32.7c9718","type":"link out","z":"51a355d0.06a06c","name":"","links":["7b9c5955.8dada8"],"x":2775,"y":1040,"wires":[]},{"id":"9dab6b57.941328","type":"function","z":"51a355d0.06a06c","name":"User Cache","func":"cache = flow.get(msg.payload.userId.toString());\ncache.groupChatRecordId = msg.payload.content.id\nflow.set(msg.payload.userId.toString(), cache);\n\nreturn msg;","outputs":1,"noerr":0,"x":2650,"y":1040,"wires":[["eb439b32.7c9718"]]},{"id":"fbe4cd1b.e2d5c","type":"function","z":"51a355d0.06a06c","name":"User Cache","func":"cache = flow.get(msg.payload.userId.toString());\nif(cache === undefined){\n   cache = {};\n   flow.set(msg.payload.userId.toString(), cache);\n}\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":900,"wires":[["671a7fe0.0e187"]]},{"id":"7b9c5955.8dada8","type":"link in","z":"51a355d0.06a06c","name":"","links":["eb439b32.7c9718"],"x":235,"y":1140,"wires":[["cfdfc318.047ab"]]},{"id":"cfdfc318.047ab","type":"function","z":"51a355d0.06a06c","name":"Token Verification Link","func":"\ncache = flow.get(msg.payload.userId.toString());\nmsg.payload.groupId = cache.groupChatRecordId;\nmsg.payload.filterBy = \"groupId\";\n\nmsg.payload.extraParms = {\n    \"dm_id\" : msg.payload.chatId.toString(),\n    \"chat_id\" : cache.groupChatRecordId,\n    \"status\" : \"pending\",\n    \"group_id\" :  [ cache.groupChatRecordId ],\n    \"user_name\": msg.originalMessage.chat.username\n}\nreturn msg;","outputs":1,"noerr":0,"x":420,"y":1140,"wires":[["8bbd95fa.4d4888"]]},{"id":"8bbd95fa.4d4888","type":"subflow:bc40755d.eab8d8","z":"51a355d0.06a06c","name":"","env":[],"x":650,"y":1140,"wires":[["73a59cd2.f96294"],[]]},{"id":"34ce85d4.4208ea","type":"debug","z":"bc40755d.eab8d8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":520,"y":220,"wires":[]},{"id":"ebafc8a7.48b388","type":"debug","z":"bc40755d.eab8d8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":850,"y":440,"wires":[]},{"id":"4c011cf1.72e5b4","type":"debug","z":"bc40755d.eab8d8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":240,"y":420,"wires":[]},{"id":"6a35ba0c.3a16c4","type":"function","z":"51a355d0.06a06c","name":"","func":"msg.payload.content = `\nThe command has been cancelled. Anything else I can do for you?\nSend /help for a list of commands.\n`\nreturn msg;","outputs":1,"noerr":0,"x":2490,"y":1000,"wires":[["f3ddcd85.23d6f"]]},{"id":"f3ddcd85.23d6f","type":"chatbot-telegram-send","z":"51a355d0.06a06c","bot":"4c02f411.5d93bc","botProduction":"","track":false,"passThrough":false,"outputs":0,"x":2670,"y":1000,"wires":[]},{"id":"ff292910.2186f8","type":"switch","z":"845fee24.1a24a","name":"","property":"payload.content","propertyType":"msg","rules":[{"t":"cont","v":"/cancel","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":810,"y":840,"wires":[["f8968bb.2cab578"],["1711f965.ba1827"]]},{"id":"3dfcb047.4eae5","type":"switch","z":"845fee24.1a24a","name":"","property":"payload.content","propertyType":"msg","rules":[{"t":"cont","v":"/cancel","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":810,"y":900,"wires":[["48c6fe28.a392"],["5b7ac9e.d748938"]]},{"id":"ecb26bea.daf148","type":"switch","z":"845fee24.1a24a","name":"","property":"payload.content","propertyType":"msg","rules":[{"t":"cont","v":"/cancel","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":790,"y":1060,"wires":[["9db06d62.bff9b"],["700e37a.48d81c8"]]},{"id":"e831e284.33d39","type":"switch","z":"727c54f5.3975dc","name":"","property":"payload.type","propertyType":"msg","rules":[{"t":"eq","v":"message","vt":"str"},{"t":"eq","v":"event","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":450,"y":820,"wires":[["c8b30e6f.884b6"],["c0e7ef96.ff412"],["7d7f75ed.a95dfc","acd96802.b74328"]]},{"id":"c0e7ef96.ff412","type":"switch","z":"727c54f5.3975dc","name":"","property":"payload.eventType","propertyType":"msg","rules":[{"t":"eq","v":"new-user","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":670,"y":860,"wires":[["b862095c.f177b8"],["d6a81ceb.4f355","7d7f75ed.a95dfc","acd96802.b74328"]]},{"id":"d6a81ceb.4f355","type":"debug","z":"727c54f5.3975dc","name":"New Event: Unknown","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":880,"y":900,"wires":[]},{"id":"b862095c.f177b8","type":"link out","z":"727c54f5.3975dc","name":"","links":["6b3936b9.e8ba08","da278753.aae1f8"],"x":795,"y":860,"wires":[]},{"id":"e1e52dd5.e56b8","type":"function","z":"c5f445fd.379ed8","name":"SDK v2 Helper","func":"\n// create sdk\nfetch = global.get('fetch');\nWebSocket = global.get('ws');\nabridged = global.get(\"abridged\");\n\nNotificationTypes = abridged.NotificationTypes;\nconst {privateKey, address, action, debug, recipient, value, data, authKey } = msg.payload.sdkPayload;\n\nlet sdk;\nlet account;\nif(msg.payload.network === 'mainnet'){\n    sdk = abridged.createSdk({\n        authKeyModule: {\n          privateKey\n        },\n        queryProviderEndpoint: msg.payload.sdkPayload.queryProviderEndPoint,\n        fetch,\n        WebSocket\n    })\n}else{\n    sdk = abridged.createKovanSdk({\n        authKeyModule: {\n          privateKey\n        },\n        queryProviderEndpoint: msg.payload.sdkPayload.queryProviderEndPoint,\n        fetch,\n        WebSocket\n    })\n}\n\nmsg.payload.sdkPayload.gaurdianKey = sdk.state$.authKey$.address$._value;\n// connect sdk\nasync function createOrConnectAccount (){\n    try{\n        account = await sdk.createAccount(address);\n        msg.payload.sdkPayload.account = account;\n    }catch(error){\n        \n    }\n    if(debug)\n     node.send(msg);\n}\n\nasync function batchExecute() {\n    const options = {\n      recipient: recipient,\n      value: value,\n      data: data,\n    };\n\n    try{\n       let batch = await sdk.batchExecuteAccountTransaction(options);\n       msg.payload.sdkPayload.batchExecute = batch;\n       if(debug)\n        node.send(msg);\n    }catch(error){\n        msg.payload.sdkPayload.batchExecuteError = error;\n        throw error;\n    }\n}\n\nasync function setAuthKey () {\n  output = await sdk.batchSetAccountAuthKey({\n      authKey: authKey,\n      type: \"Owner\"\n  })\n  msg.payload.sdkPayload.authKeyOutput = output;\n  if(debug)\n    node.send(msg);\n}\n\nasync function estimateBatch() {\n    const refundToken = {}; // optional\n    try{\n        let batch = await sdk.estimateBatch(refundToken);\n        msg.payload.sdkPayload.estimateBatch = batch;\n        if(debug)\n            node.send(msg);\n    }catch(error){\n        msg.payload.sdkPayload.estimateBatchError = error;\n        throw error;\n    }\n}\n\nasync function submitBatch() {\n    const gasPrice = null; // optional\n    let key;\n    try{\n        key = await sdk.submitBatch(gasPrice)\n        msg.payload.sdkPayload.submitBatchKey = key;\n        if(debug)\n            node.send(msg);\n    }catch(error){\n       msg.payload.sdkPayload.submitBatchError = error;\n       throw error;\n    }\n    \n    const subscribtion = sdk\n    .state$\n    .notification$\n    .subscribe(notification => {\n        if (notification === null) {\n            return;\n        }\n        // if (notification.type === NotificationTypes.RelayedTransactionUpdated && notification.payload.state === 'Sending') {\n        if (notification.type === NotificationTypes.RelayedTransactionUpdated && notification.payload.state === 'Sent') {\n            msg.payload.sdkPayload.notification = notification.payload;\n            msg.payload.sdkPayload.done = true;\n            node.send(msg);\n            node.done();\n            // resolve(notification.payload.hash);\n            subscribtion.unsubscribe();\n            return;\n        }\n    });\n}\n\nasync function resetSdk() {\n    await sdk.resetAccount();\n}\n\nasync function process() {\n    await createOrConnectAccount();\n    if(action === \"SDK_ACTION_SET_AUTH_KEY\"){\n        try{\n            await setAuthKey(); \n            await estimateBatch();\n            await submitBatch();\n        }catch(error){\n            msg.payload.sdkPayload.done = true;\n            node.send(msg,false);\n            node.done();\n            await sdk.resetBatch();\n        }\n    } else if(action === \"SDK_ACTION_EXECUTE_TRX\"){\n        try{\n            await batchExecute();\n            await estimateBatch();\n            await submitBatch();\n        }catch(error){\n            msg.payload.sdkPayload.done = true;\n            node.send(msg,false);\n            node.done();\n            await sdk.resetBatch();\n        }\n    }else {\n        await resetSdk();\n        msg.payload.sdkPayload.done = true;\n        node.send(msg,false);\n        node.done();\n    } \n}\n\nprocess();","outputs":1,"noerr":0,"x":480,"y":140,"wires":[[]]},{"id":"a1654f33.3790b","type":"inject","z":"da2025ff.761318","name":"","topic":"","payload":"{}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":210,"y":240,"wires":[["b6cd9bec.e4e528"]]},{"id":"b6cd9bec.e4e528","type":"function","z":"da2025ff.761318","name":"Init Keys","func":"ethers = global.get('ethers');\n\nlet wallet = ethers.Wallet.createRandom();\nmsg.payload.privateKey = wallet.privateKey;\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":300,"wires":[["c1c41614.c39fc8","fae447da.9e4da8"]]},{"id":"fae447da.9e4da8","type":"debug","z":"da2025ff.761318","name":"init","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":430,"y":240,"wires":[]},{"id":"780df468.d00eec","type":"subflow:c5f445fd.379ed8","z":"da2025ff.761318","name":"","env":[],"x":560,"y":400,"wires":[["e99b6cd6.fba0a"]]},{"id":"e99b6cd6.fba0a","type":"debug","z":"da2025ff.761318","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":730,"y":320,"wires":[]},{"id":"b232be47.96a95","type":"function","z":"da2025ff.761318","name":"Update User","func":"\nmsg.payload.payload = [\n    {\n        \"id\": msg.payload.user.id,\n        \"fields\": {\n            \"guardian_key\": msg.payload.sdkPayload.gaurdianKey,\n            \"account_address\": msg.payload.sdkPayload.account.address,\n            \"pk\": msg.payload.sdkPayload.privateKey,\n            \"external_deposit_address\": msg.payload.sdkPayload.account.externalDepositAddress,\n        }\n    }\n]\nreturn msg;","outputs":1,"noerr":0,"x":730,"y":460,"wires":[["33ffc2d1.787bae","2b6f83c6.bdea9c"]]},{"id":"33ffc2d1.787bae","type":"node-airtable","z":"da2025ff.761318","name":"Update User","auth":"8988a490.b97c78","table":"user","tableType":"str","action":"put","filter":"","filterType":"msg","record":"payload.user","recordType":"msg","records":"payload.payload","recordsType":"msg","output":"payload.record","x":870,"y":520,"wires":[["445b652b.5bb1bc"],[]]},{"id":"fa6488f7.590488","type":"debug","z":"da2025ff.761318","name":"New User Init Complete","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1110,"y":540,"wires":[]},{"id":"2b6f83c6.bdea9c","type":"debug","z":"da2025ff.761318","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":930,"y":460,"wires":[]},{"id":"445b652b.5bb1bc","type":"change","z":"da2025ff.761318","name":"","rules":[{"t":"set","p":"payload.user","pt":"msg","to":"payload.record[0]","tot":"msg"},{"t":"delete","p":"payload.record","pt":"msg"},{"t":"delete","p":"payload.payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1020,"y":580,"wires":[["3756a992.df0ab6","fa6488f7.590488"]]},{"id":"c86b906.0a21e7","type":"link in","z":"da2025ff.761318","name":"In: SDK v2 init","links":["a931a3dc.0f30e","8cf2473.2d4c0b8","9eb6495.8889fb8"],"x":195,"y":300,"wires":[["b6cd9bec.e4e528"]]},{"id":"3756a992.df0ab6","type":"link out","z":"da2025ff.761318","name":"Out: SDK V2 init","links":[],"x":1175,"y":580,"wires":[]},{"id":"c1c41614.c39fc8","type":"change","z":"da2025ff.761318","name":"","rules":[{"t":"set","p":"payload.sdkPayload.queryProviderEndPoint","pt":"msg","to":"queryProviderEndPoint","tot":"global"},{"t":"set","p":"payload.sdkPayload.privateKey","pt":"msg","to":"payload.privateKey","tot":"msg"},{"t":"set","p":"msg.payload.sdkPayload.debug","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":340,"wires":[["780df468.d00eec"]]},{"id":"c8a440ef.2c032","type":"comment","z":"da2025ff.761318","name":"Step II: Webhook to set client auth key","info":"","x":230,"y":700,"wires":[]},{"id":"48295cd2.50d4a4","type":"function","z":"da2025ff.761318","name":"Get User","func":"\nreturn msg;","outputs":1,"noerr":0,"x":400,"y":760,"wires":[["5adc81b5.48df3"]]},{"id":"5adc81b5.48df3","type":"node-airtable","z":"da2025ff.761318","name":"Get User","auth":"8988a490.b97c78","table":"user","tableType":"str","action":"get","filter":"payload.filter","filterType":"msg","record":"payload.id","recordType":"msg","records":"","recordsType":"msg","output":"payload.user","x":580,"y":760,"wires":[["4c55a4bd.f48bbc","724b55c4.1ef95c"],["cba9ba86.ed3d88"]]},{"id":"4c55a4bd.f48bbc","type":"function","z":"da2025ff.761318","name":"Update User","func":"\n\nmsg.payload.payload = [\n    {\n        \"id\": msg.payload.user.id,\n        \"fields\": {\n            \"client_auth_key\": msg.payload.client_auth_key,\n            \"wallet_type\" : \"abridged\"\n        }\n    }\n]\nreturn msg;","outputs":1,"noerr":0,"x":770,"y":720,"wires":[["be8a03b.b7342"]]},{"id":"be8a03b.b7342","type":"node-airtable","z":"da2025ff.761318","name":"Update User","auth":"8988a490.b97c78","table":"user","tableType":"str","action":"put","filter":"","filterType":"msg","record":"payload.user","recordType":"msg","records":"payload.payload","recordsType":"msg","output":"payload.record","x":970,"y":720,"wires":[["fce95b76.ac0ef8","ba9b1168.d5a3a"],[]]},{"id":"fce95b76.ac0ef8","type":"debug","z":"da2025ff.761318","name":"Auth key added on airtable","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1020,"y":780,"wires":[]},{"id":"6f6ae531.67609c","type":"http in","z":"da2025ff.761318","name":"","url":"/setauthkey","method":"post","upload":false,"swaggerDoc":"","x":170,"y":760,"wires":[["d96001f5.a432a","48295cd2.50d4a4"]]},{"id":"724b55c4.1ef95c","type":"template","z":"da2025ff.761318","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"Success","output":"str","x":780,"y":760,"wires":[["51958c9a.16d034"]]},{"id":"51958c9a.16d034","type":"http response","z":"da2025ff.761318","name":"","statusCode":"","headers":{},"x":790,"y":820,"wires":[]},{"id":"d96001f5.a432a","type":"debug","z":"da2025ff.761318","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":170,"y":820,"wires":[]},{"id":"cba9ba86.ed3d88","type":"template","z":"da2025ff.761318","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"User not found.","output":"str","x":580,"y":820,"wires":[["51958c9a.16d034"]]},{"id":"8f3395a.08dac68","type":"link in","z":"da2025ff.761318","name":"InSetAuthKey","links":["6fd236fa.c73778","84a49f10.6d7dd","e185013.f49c6","dd8e9180.e0061"],"x":115,"y":1100,"wires":[["db247636.2e94c8"]]},{"id":"205fca39.dcd3e6","type":"debug","z":"da2025ff.761318","name":"user","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":530,"y":1200,"wires":[]},{"id":"f8e01336.dda0d","type":"comment","z":"da2025ff.761318","name":"Step III: Set client auth key","info":"","x":210,"y":1040,"wires":[]},{"id":"16eab75c.a5b809","type":"function","z":"da2025ff.761318","name":"","func":"msg.payload.chatId = msg.payload.user.fields.dm_id;\nmsg.payload.type = 'message';\nmsg.payload.content = `\n    Congrats!!! abridged wallet is ready to use.\n`;\nreturn msg;","outputs":1,"noerr":0,"x":1030,"y":1100,"wires":[["385fb371.357a5c","659c2691.6286e8"]]},{"id":"cf2b75cf.fb78b8","type":"debug","z":"da2025ff.761318","name":"SDK Helper","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":670,"y":1140,"wires":[]},{"id":"3e4d9279.6ef06e","type":"subflow:c5f445fd.379ed8","z":"da2025ff.761318","name":"","env":[],"x":640,"y":1100,"wires":[["cf2b75cf.fb78b8","8c8c4fb2.9adc9"]]},{"id":"432f88d5.4a41f8","type":"comment","z":"da2025ff.761318","name":"SDK v2 Input node","info":"","x":190,"y":160,"wires":[]},{"id":"6a16e46b.50ef7c","type":"function","z":"51a355d0.06a06c","name":"Wallet options","func":"\nbuttons = [];\n\nverificationUrl = `${global.get('web_wallet_url')}&id=${msg.payload.user.id}`\n// abridgedWalletUrl = `${global.get('react_server_url')}/init?id=${msg.payload.user.id}&url=${global.get('node_red_server_url')}`\n\nbuttons.push(button = {\n\t\"type\": \"postback\",\n\t\"label\": \"Abridged Wallet\",\n\t\"value\": `{\"ac\":\"abridged_wallet\"}`,\n\t\"alert\": false,\n\t\"style\": \"\"\n});\nbuttons.push({\n    \"type\": \"newline\"\n});\n\nbuttons.push(button = {\n\t\"type\": \"url\",\n\t\"label\": \"Metamask (Desktop Only)\",\n\t\"url\": verificationUrl,\n\t\"alert\": false,\n\t\"style\": \"\"\n});\n\n// buttons.push(button = {\n// \t\"type\": \"postback\",\n// \t\"label\": \"Quit\",\n// \t\"value\": `/quit`,\n// \t\"alert\": false,\n// \t\"style\": \"\"\n// });\n\nmsg.payload.type = \"inline-buttons\";\ntokenConfirmationMessage = '';\nif(msg.payload.group.uniswap_token_exchange_address === undefined){\n    tokenConfirmationMessage = `Please make sure you have access to token ${msg.payload.group.fields.token_symbol}, address of requred token is ${msg.payload.group.fields.token_address}\nGroup admin can be reached here http://t.me/${msg.payload.group.fields.user_name}`\n}\nmsg.payload.content = `${tokenConfirmationMessage}\\n Please verify your account ownership.`;\nmsg.payload.buttons = buttons;\n\nreturn msg;","outputs":1,"noerr":0,"x":1120,"y":1140,"wires":[["1175d4f.a770e2b"]]},{"id":"1175d4f.a770e2b","type":"chatbot-telegram-send","z":"51a355d0.06a06c","bot":"4c02f411.5d93bc","botProduction":"","track":false,"passThrough":false,"outputs":0,"x":1350,"y":1140,"wires":[]},{"id":"e6eab20a.de1cb","type":"function","z":"cf595613.fa3b68","name":"Get Eth Bal","func":"fetch = global.get('fetch');\nethers = global.get('ethers');\npostData = {\n    \"jsonrpc\": \"2.0\",\n    \"method\": \"eth_getBalance\",\n    \"params\": [\n        msg.payload.address,\n        \"latest\"\n    ],\n    \"id\": 1\n}\n\nasync function getBalance(url = '', data = {}) {\n  // Default options are marked with *\n  const response = await fetch(url, {\n    method: 'POST', // *GET, POST, PUT, DELETE, etc.\n    body: JSON.stringify(data) // body data type must match \"Content-Type\" header\n  });\n  return await response.json(); // parses JSON response into native JavaScript objects\n}\n\ngetBalance(msg.payload.queryProviderEndPoint, postData)\n  .then((data) => {\n    msg.payload.balance = ethers.utils.formatEther(data.result);\n    node.send(msg);\n  });\n  ","outputs":1,"noerr":0,"x":550,"y":220,"wires":[[]]},{"id":"125d9724.9333f9","type":"function","z":"210c8349.faea1c","name":"Purchase Eth","func":"if(msg.payload.balance === undefined)\n    msg.payload.balance = 0;\nwyreLink = global.get('wyre_link');\nwyreLink =  `${wyreLink}?destCurrency=ETH&dest=${msg.payload.user.account.fields.account_address}&accountId=${global.get('wyre_account_id')}`\n\nbuttons = [];\n\nverificationUrl = `${global.get('web_wallet_url')}&id=${msg.payload.user.id}`\nabridgedWalletUrl = `${global.get('react_server_url')}/init?id=${msg.payload.user.id}&url=${global.get('node_red_server_url')}`\n\nbuttons.push(button = {\n\t\"type\": \"url\",\n\t\"label\": \"Wyre\",\n\t\"url\": wyreLink,\n\t\"alert\": false,\n\t\"style\": \"\"\n});\n// buttons.push(button = {\n// \t\"type\": \"newline\"\n// });\n\n// buttons.push(button = {\n// \t\"type\": \"url\",\n// \t\"label\": \"Metamask (Desktop Only)\",\n// \t\"url\": wyreLink,\n// \t\"alert\": false,\n// \t\"style\": \"\"\n// });\n\nmsg.payload.type = \"inline-buttons\";\n// msg.payload.content = `Hi ${msg.payload.user.fields.user_name},\n// Your ETH balance is ${msg.payload.balance} and token balance is ${msg.payload.tokenBalance}\n// To use wallet you need minimum 0.3 ETH and to join group min required token is ${msg.payload.group.fields.min_token}\n\n// Please deposit enough eth to enable wallet and i'll guide you to convert ETH to token. Ex: (We can set amout too)\n// Your account address is ${msg.payload.user.fields.account_address}\n// `;\n\nmsg.payload.content = `\nPlease deposit enough eth to get required tokens. Afterwards i'll guide you to SWAP ETH to token\n\nETH balance:              ${msg.payload.balance}\nToken balance:            ${msg.payload.tokenBalance}\nMin tokens to join group: ${msg.payload.group.fields.min_token}\nAccount Address: ${msg.payload.user.account.fields.account_address}\n`;\n\nmsg.payload.buttons = buttons;\n\n\nreturn msg;","outputs":1,"noerr":0,"x":610,"y":220,"wires":[["953919e6.aa2528","916d6a5d.6110c8","5658dff9.f8535"]]},{"id":"953919e6.aa2528","type":"chatbot-telegram-send","z":"210c8349.faea1c","bot":"4c02f411.5d93bc","botProduction":"","track":false,"passThrough":false,"outputs":0,"x":850,"y":220,"wires":[]},{"id":"4e8fcdb5.37e064","type":"link in","z":"210c8349.faea1c","name":"In: Wyre Flow","links":["c5a08f5c.7e75d","327ad4c1.46f64c","7a4f8493.68122c","a5c323af.9155f"],"x":235,"y":180,"wires":[["b3da39d3.8c7098","ee885fb1.ae3ee"]]},{"id":"b3da39d3.8c7098","type":"chatbot-conversation","z":"210c8349.faea1c","name":"","botDevelopment":"4c02f411.5d93bc","botProduction":"","chatId":"1111","userId":"","transport":"telegram","store":"","x":410,"y":220,"wires":[["125d9724.9333f9"]]},{"id":"ee885fb1.ae3ee","type":"debug","z":"210c8349.faea1c","name":"Start Wyre Flow","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":420,"y":180,"wires":[]},{"id":"3053120b.9088ce","type":"link in","z":"da2025ff.761318","name":"In: Eth And Token Flow","links":[],"x":100,"y":1280,"wires":[["9d50e915.933708"]]},{"id":"e1a25ef7.ab92e","type":"comment","z":"da2025ff.761318","name":"We may want to add wyre flow here?","info":"","x":270,"y":1180,"wires":[]},{"id":"8c4a6e2f.c3a8d","type":"change","z":"d017622.56f92a","name":"","rules":[{"t":"set","p":"payload.network","pt":"msg","to":"netwrok","tot":"global"},{"t":"set","p":"payload.queryProviderEndPoint","pt":"msg","to":"queryProviderEndPoint","tot":"global"},{"t":"set","p":"payload.chatId","pt":"msg","to":"payload.user.fields.dm_id","tot":"msg"},{"t":"set","p":"payload.groupId","pt":"msg","to":"msg.payload.user.fields.group_id[0]","tot":"msg"},{"t":"set","p":"payload.address","pt":"msg","to":"payload.user.account.fields.account_address","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":200,"y":140,"wires":[["b391d39a.f5512"]]},{"id":"ea49f238.ae7d5","type":"subflow:cf595613.fa3b68","z":"d017622.56f92a","name":"","env":[],"x":700,"y":140,"wires":[["e9c31b45.388b28"]]},{"id":"42d3404a.5f0b8","type":"switch","z":"da2025ff.761318","name":"","property":"payload.balance","propertyType":"msg","rules":[{"t":"lt","v":"min_eth","vt":"global"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":530,"y":1280,"wires":[["cce2a440.1b35c8"],["454a49dc.5c1598","e185013.f49c6"]]},{"id":"454a49dc.5c1598","type":"debug","z":"da2025ff.761318","name":"User already have sufficient balance","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":830,"y":1360,"wires":[]},{"id":"e185013.f49c6","type":"link out","z":"da2025ff.761318","name":"","links":["8f3395a.08dac68"],"x":715,"y":1300,"wires":[]},{"id":"e9c31b45.388b28","type":"change","z":"d017622.56f92a","name":"","rules":[{"t":"set","p":"payload.network","pt":"msg","to":"network","tot":"global"},{"t":"set","p":"payload.address_contract","pt":"msg","to":"payload.group.fields.token_address","tot":"msg"},{"t":"set","p":"payload.abi","pt":"msg","to":"abi_erc20","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":920,"y":140,"wires":[["970686e2.247638","bbbb5b3a.7a2208"]]},{"id":"970686e2.247638","type":"subflow:a9c470a9.c7195","z":"d017622.56f92a","name":"","env":[],"x":1120,"y":140,"wires":[["21bd821f.4bb8ce"]]},{"id":"b391d39a.f5512","type":"node-airtable","z":"d017622.56f92a","name":"Get Group Details","auth":"8988a490.b97c78","table":"group","tableType":"str","action":"get","filter":"","filterType":"msg","record":"payload.groupId","recordType":"msg","records":"payload.payload","recordsType":"msg","output":"payload.group","x":470,"y":140,"wires":[["ea49f238.ae7d5","95307563.b93478"],[]]},{"id":"95307563.b93478","type":"debug","z":"d017622.56f92a","name":"User and group details","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":520,"y":80,"wires":[]},{"id":"bbbb5b3a.7a2208","type":"debug","z":"d017622.56f92a","name":"User and group details","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1120,"y":200,"wires":[]},{"id":"21bd821f.4bb8ce","type":"debug","z":"d017622.56f92a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1150,"y":80,"wires":[]},{"id":"8ef5ba2a.576648","type":"function","z":"da2025ff.761318","name":"Message","func":"msg.payload.message = `Hi ${msg.payload.user.fields.user_name},\nYour ETH balance is ${msg.payload.balance} and token balance is ${msg.payload.tokenBalance}\nTo use wallet you need minimum 0.3 ETH and to join group min required token is ${msg.payload.group.fields.min_token}\n\nPlease deposit enough eth to enable wallet and i'll guide you to convert ETH to token. Ex: (We can set amout too)\nYour account address is ${msg.payload.user.fields.account_address}\n`;\nreturn msg;","outputs":1,"noerr":0,"x":820,"y":1280,"wires":[[]]},{"id":"b08534fe.238b18","type":"link out","z":"da2025ff.761318","name":"","links":[],"x":1275,"y":720,"wires":[]},{"id":"996d0efe.d6ace","type":"http in","z":"210c8349.faea1c","name":"","url":"/webhook/wyre","method":"get","upload":false,"swaggerDoc":"","x":170,"y":680,"wires":[["218a1b8d.e38484"]]},{"id":"af78c335.d931f","type":"comment","z":"210c8349.faea1c","name":"Wyre Callback","info":"","x":170,"y":640,"wires":[]},{"id":"8e9a026c.bb2c8","type":"http response","z":"210c8349.faea1c","name":"","statusCode":"","headers":{},"x":450,"y":620,"wires":[]},{"id":"218a1b8d.e38484","type":"function","z":"210c8349.faea1c","name":"","func":"msg.payload = 'ok';\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":640,"wires":[["8e9a026c.bb2c8"]]},{"id":"11965304.790afd","type":"comment","z":"210c8349.faea1c","name":"Pooling for balance?","info":"","x":190,"y":260,"wires":[]},{"id":"c0eacd3b.c1e41","type":"inject","z":"210c8349.faea1c","name":"Success Trigger From Wyre","topic":"","payload":"{}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":220,"y":320,"wires":[[]]},{"id":"6b3ba034.d99e8","type":"simple-queue","z":"210c8349.faea1c","name":"Balance Queue","firstMessageBypass":true,"bypassInterval":"0","x":760,"y":400,"wires":[["9152e080.f6463"]]},{"id":"fa0dae06.bfe4d","type":"inject","z":"210c8349.faea1c","name":"","topic":"","payload":"","payloadType":"date","repeat":"3","crontab":"","once":true,"onceDelay":"5","x":170,"y":420,"wires":[["9b6cb9c7.d1acc8"]]},{"id":"9b6cb9c7.d1acc8","type":"change","z":"210c8349.faea1c","name":"","rules":[{"t":"set","p":"trigger","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":360,"y":420,"wires":[["6b3ba034.d99e8"]]},{"id":"e85b6750.30bc98","type":"subflow:cf595613.fa3b68","z":"210c8349.faea1c","name":"","env":[],"x":1200,"y":400,"wires":[["136b1607.c3642a"]]},{"id":"9152e080.f6463","type":"change","z":"210c8349.faea1c","name":"","rules":[{"t":"set","p":"payload.network","pt":"msg","to":"netwrok","tot":"global"},{"t":"set","p":"payload.queryProviderEndPoint","pt":"msg","to":"queryProviderEndPoint","tot":"global"},{"t":"set","p":"payload.chatId","pt":"msg","to":"payload.user.fields.dm_id","tot":"msg"},{"t":"set","p":"payload.groupId","pt":"msg","to":"msg.payload.user.fields.group_id[0]","tot":"msg"},{"t":"set","p":"payload.address","pt":"msg","to":"payload.user.account.fields.account_address","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":980,"y":400,"wires":[["e85b6750.30bc98"]]},{"id":"136b1607.c3642a","type":"switch","z":"210c8349.faea1c","name":"","property":"payload.balance","propertyType":"msg","rules":[{"t":"lte","v":"min_eth","vt":"global"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1410,"y":400,"wires":[["30e9b7ff.734b08","4f83a65c.bbe848"],["1be60031.facfb","3fe020e4.e592b"]]},{"id":"30e9b7ff.734b08","type":"debug","z":"210c8349.faea1c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1590,"y":380,"wires":[]},{"id":"1be60031.facfb","type":"debug","z":"210c8349.faea1c","name":"Balance Updated","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1430,"y":460,"wires":[]},{"id":"916d6a5d.6110c8","type":"change","z":"210c8349.faea1c","name":"","rules":[{"t":"set","p":"payload.tableName","pt":"msg","to":"user","tot":"str"},{"t":"set","p":"payload.id","pt":"msg","to":"payload.user.id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":300,"wires":[["49b93af7.d27e34"]]},{"id":"5122a8a3.391078","type":"delay","z":"210c8349.faea1c","name":"","pauseType":"delay","timeout":"3","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1070,"y":320,"wires":[["6b3ba034.d99e8"]]},{"id":"49b93af7.d27e34","type":"node-airtable","z":"210c8349.faea1c","name":"Get User","auth":"8988a490.b97c78","table":"user","tableType":"str","action":"get","filter":"","filterType":"msg","record":"payload.id","recordType":"msg","records":"","recordsType":"msg","output":"payload.user","x":660,"y":340,"wires":[["6b3ba034.d99e8"],[]]},{"id":"ec3a1291.804c2","type":"chatbot-telegram-send","z":"210c8349.faea1c","bot":"4c02f411.5d93bc","botProduction":"","track":false,"passThrough":false,"outputs":0,"x":1810,"y":500,"wires":[]},{"id":"3fe020e4.e592b","type":"chatbot-conversation","z":"210c8349.faea1c","name":"","botDevelopment":"4c02f411.5d93bc","botProduction":"","chatId":"1111","userId":"","transport":"telegram","store":"","x":1590,"y":420,"wires":[["e0ee9798.807a58"]]},{"id":"e0ee9798.807a58","type":"function","z":"210c8349.faea1c","name":"Deposit Success","func":"msg.payload.chatId = msg.payload.user.fields.dm_id;\nmsg.payload.content.type = 'message'\nmsg.payload.content = `\nGreat!!! deposit completed. Updated balance is ${msg.payload.balance} ETH and token balance is ${msg.payload.tokenBalance}\n`\nreturn msg;","outputs":1,"noerr":0,"x":1710,"y":460,"wires":[["ec3a1291.804c2","7b61a580.a04c9c"]]},{"id":"5f184849.b31f28","type":"link in","z":"51a355d0.06a06c","name":"In: Ask for token swap","links":["7b61a580.a04c9c","659c2691.6286e8","2b99a09d.b17de"],"x":255,"y":2660,"wires":[["661a0540.9ab1fc"]]},{"id":"27761519.6458aa","type":"comment","z":"51a355d0.06a06c","name":"Ask for token swap","info":"","x":350,"y":2540,"wires":[]},{"id":"7b61a580.a04c9c","type":"link out","z":"210c8349.faea1c","name":"","links":["5f184849.b31f28"],"x":1855,"y":460,"wires":[]},{"id":"ba9b1168.d5a3a","type":"change","z":"da2025ff.761318","name":"","rules":[{"t":"set","p":"payload.user","pt":"msg","to":"payload.record[0]","tot":"msg"},{"t":"delete","p":"payload.record","pt":"msg"},{"t":"delete","p":"payload.payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1160,"y":720,"wires":[["b08534fe.238b18"]]},{"id":"9d50e915.933708","type":"subflow:d017622.56f92a","z":"da2025ff.761318","name":"","env":[],"x":290,"y":1280,"wires":[["42d3404a.5f0b8"]]},{"id":"661a0540.9ab1fc","type":"subflow:d017622.56f92a","z":"51a355d0.06a06c","name":"","env":[],"x":430,"y":2600,"wires":[["49384867.17d8d8","27e17890.61f008"]]},{"id":"7de4d524.d12adc","type":"switch","z":"51a355d0.06a06c","name":"","property":"payload.tokenBalance","propertyType":"msg","rules":[{"t":"lt","v":"payload.group.fields.min_token","vt":"msg"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":810,"y":2600,"wires":[["28a001b8.a5286e"],["b557fa02.8fc618"]]},{"id":"659c2691.6286e8","type":"link out","z":"da2025ff.761318","name":"","links":["5f184849.b31f28"],"x":1135,"y":1160,"wires":[]},{"id":"8c8c4fb2.9adc9","type":"chatbot-conversation","z":"da2025ff.761318","name":"","botDevelopment":"4c02f411.5d93bc","botProduction":"","chatId":"1111","userId":"","transport":"telegram","store":"","x":870,"y":1100,"wires":[["16eab75c.a5b809"]]},{"id":"385fb371.357a5c","type":"chatbot-telegram-send","z":"da2025ff.761318","bot":"4c02f411.5d93bc","botProduction":"","track":false,"passThrough":false,"outputs":0,"x":1210,"y":1100,"wires":[]},{"id":"4ffa7c31.90db94","type":"chatbot-telegram-send","z":"51a355d0.06a06c","bot":"4c02f411.5d93bc","botProduction":"","track":false,"passThrough":false,"outputs":0,"x":1350,"y":2680,"wires":[]},{"id":"b557fa02.8fc618","type":"chatbot-conversation","z":"51a355d0.06a06c","name":"","botDevelopment":"4c02f411.5d93bc","botProduction":"","chatId":"1111","userId":"","transport":"telegram","store":"","x":990,"y":2680,"wires":[["dfa5724a.316c9"]]},{"id":"dfa5724a.316c9","type":"function","z":"51a355d0.06a06c","name":"","func":"msg.payload.chatId = msg.payload.user.fields.dm_id;\nbuttons = [];\n\nbuttons.push(button = {\n\t\"type\": \"url\",\n\t\"label\": \"Join\",\n\t\"url\": msg.payload.group.fields.group_link,\n\t\"alert\": false,\n\t\"style\": \"\"\n});\n\nmsg.payload.type = \"inline-buttons\";\nmsg.payload.content = `Thanks! Welcome to the group!.`;\nmsg.payload.buttons = buttons;\n\nreturn msg;","outputs":1,"noerr":0,"x":1150,"y":2680,"wires":[["4ffa7c31.90db94","90dc57ac.1e6928"]]},{"id":"796ed03b.30d39","type":"chatbot-telegram-send","z":"51a355d0.06a06c","bot":"4c02f411.5d93bc","botProduction":"","track":false,"passThrough":false,"outputs":0,"x":1890,"y":2540,"wires":[]},{"id":"b33aa8c0.992fc8","type":"chatbot-conversation","z":"51a355d0.06a06c","name":"","botDevelopment":"4c02f411.5d93bc","botProduction":"","chatId":"1111","userId":"","transport":"telegram","store":"","x":1470,"y":2540,"wires":[["3a82a3e2.72f98c"]]},{"id":"3a82a3e2.72f98c","type":"function","z":"51a355d0.06a06c","name":"Swap Button","func":"msg.payload.chatId = msg.payload.user.fields.dm_id;\nbuttons = [];\n\nbuttons.push(button = {\n\t\"type\": \"postback\",\n\t\"label\": `Swap ETH for ${msg.payload.group.fields.min_token} Tokens`,\n\t\"value\": `{\"id\":\"${msg.payload.group.id}\", \"ac\":\"swap\"}`,\n\t\"style\": \"\"\n});\n\nmsg.payload.type = \"inline-buttons\";\nmsg.payload.content = `\nIn order to swap please make sure you have enough ETH at address ${msg.payload.user.account.fields.account_address}\n\nETH balance:              ${msg.payload.balance}\nToken balance:            ${msg.payload.tokenBalance}\nMin tokens to join group: ${msg.payload.group.fields.min_token}.\n`;\nmsg.payload.buttons = buttons;\n\nreturn msg;","outputs":1,"noerr":0,"x":1670,"y":2540,"wires":[["796ed03b.30d39"]]},{"id":"f2abb083.2c885","type":"inject","z":"727c54f5.3975dc","name":"Uniswap Factry ABI","topic":"","payload":"[{\"name\":\"NewExchange\",\"inputs\":[{\"type\":\"address\",\"name\":\"token\",\"indexed\":true},{\"type\":\"address\",\"name\":\"exchange\",\"indexed\":true}],\"anonymous\":false,\"type\":\"event\"},{\"name\":\"initializeFactory\",\"outputs\":[],\"inputs\":[{\"type\":\"address\",\"name\":\"template\"}],\"constant\":false,\"payable\":false,\"type\":\"function\",\"gas\":35725},{\"name\":\"createExchange\",\"outputs\":[{\"type\":\"address\",\"name\":\"out\"}],\"inputs\":[{\"type\":\"address\",\"name\":\"token\"}],\"constant\":false,\"payable\":false,\"type\":\"function\",\"gas\":187911},{\"name\":\"getExchange\",\"outputs\":[{\"type\":\"address\",\"name\":\"out\"}],\"inputs\":[{\"type\":\"address\",\"name\":\"token\"}],\"constant\":true,\"payable\":false,\"type\":\"function\",\"gas\":715},{\"name\":\"getToken\",\"outputs\":[{\"type\":\"address\",\"name\":\"out\"}],\"inputs\":[{\"type\":\"address\",\"name\":\"exchange\"}],\"constant\":true,\"payable\":false,\"type\":\"function\",\"gas\":745},{\"name\":\"getTokenWithId\",\"outputs\":[{\"type\":\"address\",\"name\":\"out\"}],\"inputs\":[{\"type\":\"uint256\",\"name\":\"token_id\"}],\"constant\":true,\"payable\":false,\"type\":\"function\",\"gas\":736},{\"name\":\"exchangeTemplate\",\"outputs\":[{\"type\":\"address\",\"name\":\"out\"}],\"inputs\":[],\"constant\":true,\"payable\":false,\"type\":\"function\",\"gas\":633},{\"name\":\"tokenCount\",\"outputs\":[{\"type\":\"uint256\",\"name\":\"out\"}],\"inputs\":[],\"constant\":true,\"payable\":false,\"type\":\"function\",\"gas\":663}]","payloadType":"json","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":280,"y":540,"wires":[["e53ec44b.ba20d8"]]},{"id":"e53ec44b.ba20d8","type":"json","z":"727c54f5.3975dc","name":"","property":"payload","action":"obj","pretty":false,"x":510,"y":540,"wires":[["22f43337.e4a9cc"]]},{"id":"22f43337.e4a9cc","type":"change","z":"727c54f5.3975dc","name":"Abi Uniswap: Factory","rules":[{"t":"set","p":"abi_uniswap_exchange_factory","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":740,"y":540,"wires":[[]]},{"id":"519693.567e996c","type":"link in","z":"fa0de9cf.c93278","name":"In: Uniswap","links":["814dbd31.3bdcd","975cbecd.ca0a2","aceb4f5c.08c55","43f45740.934618"],"x":175,"y":360,"wires":[["a6332e32.a9aaf","7eae6d57.915864"]]},{"id":"6a0e6717.c61758","type":"function","z":"bc5c5eb0.964c7","name":"Encode Data","func":"ethers = global.get('ethers');\nlet iface = new ethers.utils.Interface(msg.payload.config.abi);\nlet encodedData = iface.functions[msg.payload.config.apiCall].encode(msg.payload.config.args);\nmsg.payload.config.encodedData = encodedData;\nreturn msg;\n","outputs":1,"noerr":0,"x":570,"y":240,"wires":[[]]},{"id":"a6332e32.a9aaf","type":"subflow:d017622.56f92a","z":"fa0de9cf.c93278","name":"","env":[],"x":370,"y":360,"wires":[["e2dec250.ec616","9e053ce.4073ec"]]},{"id":"e2dec250.ec616","type":"debug","z":"fa0de9cf.c93278","name":"SWAP","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":350,"y":300,"wires":[]},{"id":"7ce0fbb1.99e3f4","type":"debug","z":"f394d95a.d75788","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1470,"y":980,"wires":[]},{"id":"2dfc1026.6c1b","type":"switch","z":"f394d95a.d75788","name":"","property":"payload.user.account.fields.wallet_type","propertyType":"msg","rules":[{"t":"eq","v":"metamask","vt":"str"},{"t":"eq","v":"abridged","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":330,"y":1080,"wires":[["1490b0c5.5a69cf"],["84436e2f.bb808"],["f695a0e8.48596"]]},{"id":"b5d9ee70.882b6","type":"change","z":"f394d95a.d75788","name":"","rules":[{"t":"set","p":"payload.network","pt":"msg","to":"network","tot":"global"},{"t":"set","p":"payload.address_contract","pt":"msg","to":"payload.group.fields.token_address","tot":"msg"},{"t":"set","p":"payload.abi","pt":"msg","to":"abi_erc20","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":700,"y":1040,"wires":[["c904c5e.816d738","2b624b56.3c7e04"]]},{"id":"84436e2f.bb808","type":"change","z":"f394d95a.d75788","name":"Abridgedd","rules":[{"t":"set","p":"payload.address","pt":"msg","to":"payload.user.account.fields.account_address","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":510,"y":1060,"wires":[["b5d9ee70.882b6"]]},{"id":"e9a2680d.f0fa68","type":"debug","z":"f394d95a.d75788","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":410,"y":900,"wires":[]},{"id":"de1409e2.777f58","type":"function","z":"f394d95a.d75788","name":"","func":"\nmsg.payload.record = [\n    {\n        \"id\": msg.payload.user.id,\n        \"fields\": {\n            \"status\":\"banned\"\n        }\n    }\n]\n\nreturn msg;","outputs":1,"noerr":0,"x":1670,"y":1020,"wires":[["a4230bfe.e3f718"]]},{"id":"a4230bfe.e3f718","type":"node-airtable","z":"f394d95a.d75788","name":"Upate user table","auth":"8988a490.b97c78","table":"user","tableType":"str","action":"put","filter":"","filterType":"msg","record":"payload.record","recordType":"msg","records":"payload.record","recordsType":"msg","output":"payload.result","x":1820,"y":1060,"wires":[["ee87751.acded88"],[]]},{"id":"c92ed166.6aadc","type":"chatbot-telegram-send","z":"f394d95a.d75788","bot":"4c02f411.5d93bc","botProduction":"","track":false,"passThrough":false,"outputs":0,"x":2170,"y":1120,"wires":[]},{"id":"3ac2072f.ab6148","type":"function","z":"f394d95a.d75788","name":"","func":"msg.payload.type = 'message';\nmsg.payload.chatId = msg.payload.user.fields.dm_id;\nmsg.payload.content = `Hey, Due to insufficiency token balance you have been removed from ${msg.payload.group.fields.group_name}.\nWould you like to join again? send /join`\nreturn msg;","outputs":1,"noerr":0,"x":2170,"y":1060,"wires":[["c92ed166.6aadc"]]},{"id":"ee87751.acded88","type":"chatbot-conversation","z":"f394d95a.d75788","name":"","botDevelopment":"4c02f411.5d93bc","botProduction":"","chatId":"111","userId":"","transport":"telegram","store":"","x":2010,"y":1060,"wires":[["3ac2072f.ab6148"]]},{"id":"b4370350.46e49","type":"inject","z":"727c54f5.3975dc","name":"Abi Uniswap Exchange","topic":"","payload":"[{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"min_liquidity\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"max_tokens\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"}],\"name\":\"addLiquidity\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"internalType\":\"address\",\"name\":\"_owner\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"_spender\",\"type\":\"address\"}],\"name\":\"allowance\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"_spender\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"_value\",\"type\":\"uint256\"}],\"name\":\"approve\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"internalType\":\"address\",\"name\":\"_owner\",\"type\":\"address\"}],\"name\":\"balanceOf\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"decimals\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"min_tokens\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"}],\"name\":\"ethToTokenSwapInput\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_bought\",\"type\":\"uint256\"}],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_bought\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"}],\"name\":\"ethToTokenSwapOutput\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"eth_sold\",\"type\":\"uint256\"}],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"min_tokens\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"recipient\",\"type\":\"address\"}],\"name\":\"ethToTokenTransferInput\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_bought\",\"type\":\"uint256\"}],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_bought\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"recipient\",\"type\":\"address\"}],\"name\":\"ethToTokenTransferOutput\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"eth_sold\",\"type\":\"uint256\"}],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"factoryAddress\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"factory\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"eth_sold\",\"type\":\"uint256\"}],\"name\":\"getEthToTokenInputPrice\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_bought\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_bought\",\"type\":\"uint256\"}],\"name\":\"getEthToTokenOutputPrice\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"eth_sold\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_sold\",\"type\":\"uint256\"}],\"name\":\"getTokenToEthInputPrice\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"eth_bought\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"eth_bought\",\"type\":\"uint256\"}],\"name\":\"getTokenToEthOutputPrice\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_sold\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"name\",\"outputs\":[{\"internalType\":\"bytes32\",\"name\":\"\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"min_eth\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"min_tokens\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"}],\"name\":\"removeLiquidity\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"token_addr\",\"type\":\"address\"}],\"name\":\"setup\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"symbol\",\"outputs\":[{\"internalType\":\"bytes32\",\"name\":\"\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"tokenAddress\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"token\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_sold\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"min_eth\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"}],\"name\":\"tokenToEthSwapInput\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"eth_bought\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"eth_bought\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"max_tokens\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"}],\"name\":\"tokenToEthSwapOutput\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_sold\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_sold\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"min_eth\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"recipient\",\"type\":\"address\"}],\"name\":\"tokenToEthTransferInput\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"eth_bought\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"eth_bought\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"max_tokens\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"recipient\",\"type\":\"address\"}],\"name\":\"tokenToEthTransferOutput\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_sold\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_sold\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"min_tokens_bought\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"min_eth_bought\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"exchange_addr\",\"type\":\"address\"}],\"name\":\"tokenToExchangeSwapInput\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_bought\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_bought\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"max_tokens_sold\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"max_eth_sold\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"exchange_addr\",\"type\":\"address\"}],\"name\":\"tokenToExchangeSwapOutput\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_sold\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_sold\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"min_tokens_bought\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"min_eth_bought\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"recipient\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"exchange_addr\",\"type\":\"address\"}],\"name\":\"tokenToExchangeTransferInput\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_bought\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_bought\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"max_tokens_sold\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"max_eth_sold\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"recipient\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"exchange_addr\",\"type\":\"address\"}],\"name\":\"tokenToExchangeTransferOutput\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_sold\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_sold\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"min_tokens_bought\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"min_eth_bought\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"token_addr\",\"type\":\"address\"}],\"name\":\"tokenToTokenSwapInput\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_bought\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_bought\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"max_tokens_sold\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"max_eth_sold\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"token_addr\",\"type\":\"address\"}],\"name\":\"tokenToTokenSwapOutput\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_sold\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_sold\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"min_tokens_bought\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"min_eth_bought\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"recipient\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"token_addr\",\"type\":\"address\"}],\"name\":\"tokenToTokenTransferInput\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_bought\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_bought\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"max_tokens_sold\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"max_eth_sold\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"recipient\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"token_addr\",\"type\":\"address\"}],\"name\":\"tokenToTokenTransferOutput\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"tokens_sold\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"totalSupply\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"_to\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"_value\",\"type\":\"uint256\"}],\"name\":\"transfer\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"_from\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"_to\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"value\",\"type\":\"uint256\"}],\"name\":\"transferFrom\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}]","payloadType":"json","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":290,"y":620,"wires":[["4385b8c4.181368"]]},{"id":"4385b8c4.181368","type":"json","z":"727c54f5.3975dc","name":"","property":"payload","action":"obj","pretty":false,"x":510,"y":620,"wires":[["50e2a74f.4feb68"]]},{"id":"50e2a74f.4feb68","type":"change","z":"727c54f5.3975dc","name":"Abi Uniswap: Exchange","rules":[{"t":"set","p":"abi_exchange_uniswap","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":750,"y":620,"wires":[[]]},{"id":"3c7ffd2c.f800f2","type":"inject","z":"727c54f5.3975dc","name":"Maintenance Mode","topic":"","payload":"{}","payloadType":"json","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":270,"y":700,"wires":[["ee33a749.8f9c58"]]},{"id":"ee33a749.8f9c58","type":"change","z":"727c54f5.3975dc","name":"","rules":[{"t":"set","p":"maintenance","pt":"flow","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":700,"wires":[[]]},{"id":"55b709b4.21ea38","type":"comment","z":"51a355d0.06a06c","name":"Swap ETH to Token flow","info":"","x":1510,"y":2500,"wires":[]},{"id":"44ff9433.d2d97c","type":"debug","z":"51a355d0.06a06c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1890,"y":2580,"wires":[]},{"id":"6ee7895a.85f638","type":"chatbot-telegram-send","z":"7f6ad50d.a4b3fc","bot":"4c02f411.5d93bc","botProduction":"","track":true,"passThrough":false,"outputs":1,"x":650,"y":520,"wires":[[]]},{"id":"fe59df56.f630c","type":"function","z":"7f6ad50d.a4b3fc","name":"","func":"msg.payload.content = `\nThe command has been cancelled. Anything else I can do for you?\nSend /help for a list of commands.\n`\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":520,"wires":[["6ee7895a.85f638"]]},{"id":"784f95d2.6ac7dc","type":"link in","z":"7f6ad50d.a4b3fc","name":"In: Cancel Command","links":["f8968bb.2cab578","48c6fe28.a392","9db06d62.bff9b","e6dc70c6.aa813","a2662550.d57cd8","72dfa227.baf4ec","8afc831e.a9fec","d7389b47.f49778","e30152f6.1521e","3601e67f.ec055a","4ef67e9d.60bd5","5093e94d.88d668"],"x":295,"y":520,"wires":[["fe59df56.f630c"]]},{"id":"f8968bb.2cab578","type":"link out","z":"845fee24.1a24a","name":"","links":["784f95d2.6ac7dc"],"x":955,"y":800,"wires":[]},{"id":"48c6fe28.a392","type":"link out","z":"845fee24.1a24a","name":"","links":["784f95d2.6ac7dc"],"x":955,"y":880,"wires":[]},{"id":"9db06d62.bff9b","type":"link out","z":"845fee24.1a24a","name":"","links":["784f95d2.6ac7dc"],"x":955,"y":1040,"wires":[]},{"id":"37552de2.c7d9e2","type":"function","z":"845fee24.1a24a","name":"Token contract","func":"msg.payload.content = `Great, please provide the token contract you want me to search for in members.`;\n\nreturn msg;","outputs":1,"noerr":0,"x":380,"y":980,"wires":[["daa63244.d4538"]]},{"id":"cfa41f33.c3f9d","type":"function","z":"845fee24.1a24a","name":"Token contract ","func":"cache = global.get(msg.payload.userId.toString());\ncache.tokenContractAddress = msg.payload.content;\nglobal.set(msg.payload.userId.toString(), cache); \nreturn msg;","outputs":1,"noerr":0,"x":1000,"y":1000,"wires":[["cc48c09c.9df91","23e7946f.08a70c"]]},{"id":"daa63244.d4538","type":"chatbot-telegram-send","z":"845fee24.1a24a","bot":"4c02f411.5d93bc","botProduction":"","track":true,"passThrough":false,"outputs":1,"x":610,"y":980,"wires":[["d0fbe38c.228cb"]]},{"id":"d0fbe38c.228cb","type":"switch","z":"845fee24.1a24a","name":"","property":"payload.content","propertyType":"msg","rules":[{"t":"cont","v":"/cancel","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":810,"y":980,"wires":[["a2662550.d57cd8"],["cfa41f33.c3f9d"]]},{"id":"a2662550.d57cd8","type":"link out","z":"845fee24.1a24a","name":"","links":["784f95d2.6ac7dc"],"x":955,"y":960,"wires":[]},{"id":"72dfa227.baf4ec","type":"link out","z":"51a355d0.06a06c","name":"","links":["784f95d2.6ac7dc"],"x":1395,"y":920,"wires":[]},{"id":"671a7fe0.0e187","type":"chatbot-image","z":"51a355d0.06a06c","name":"You shall not pass image","filename":"","image":"https://abridged-bot-images.s3.us-east-2.amazonaws.com/node-red-cache/You+Shall+Not+Pass!+1.png","caption":"YOU SHALL NOT PASS!!!","x":570,"y":900,"wires":[["fe93df45.cd77e"]]},{"id":"fe93df45.cd77e","type":"chatbot-telegram-send","z":"51a355d0.06a06c","bot":"4c02f411.5d93bc","botProduction":"","track":false,"passThrough":true,"outputs":1,"x":830,"y":900,"wires":[["90b9626c.2e93d"]]},{"id":"14184612.3dd67a","type":"chatbot-image","z":"845fee24.1a24a","name":"","filename":"","image":"https://abridged-bot-images.s3.us-east-2.amazonaws.com/node-red-cache/Gandolf+the+Grey+1.png","caption":"","x":310,"y":840,"wires":[["1323390d.827b17"]]},{"id":"1323390d.827b17","type":"function","z":"845fee24.1a24a","name":"","func":"\nmsg.payload.caption = `I am ${global.get('bot_handle')}, at your service to permission access for your group. First, what is the link to invite people to your group?`;  \nreturn msg;","outputs":1,"noerr":0,"x":470,"y":840,"wires":[["d4cfcce6.3a55c"]]},{"id":"bf4be6b8.80bac8","type":"switch","z":"f394d95a.d75788","name":"","property":"payload.result","propertyType":"msg","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1610,"y":1100,"wires":[["5441580d.6c57e8","de1409e2.777f58"],["5441580d.6c57e8"]]},{"id":"5441580d.6c57e8","type":"debug","z":"f394d95a.d75788","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1790,"y":1140,"wires":[]},{"id":"f695a0e8.48596","type":"change","z":"f394d95a.d75788","name":"","rules":[{"t":"set","p":"payload.chatId","pt":"msg","to":"payload.group.fields.chat_id","tot":"msg"},{"t":"set","p":"payload.token","pt":"msg","to":"token_access_bot","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":1120,"wires":[["72360d31.b19164"]]},{"id":"fb123030.1bd93","type":"inject","z":"f394d95a.d75788","name":"","topic":"","payload":"{}","payloadType":"json","repeat":"","crontab":"","once":true,"onceDelay":"2","x":270,"y":360,"wires":[[]]},{"id":"b449ab29.864418","type":"function","z":"9d822e4e.1a2a4","name":"deleteMessage","func":"const Telegram = global.get('telegram');\nconst token = msg.payload.token;\n\nconst telegram = new Telegram(token, {\n  agent: null,        // https.Agent instance, allows custom proxy, certificate, keep alive, etc.\n  webhookReply: true  // Reply via webhook\n})\n\nasync function deleteMessage() {\n    try{\n    const result = await telegram.deleteMessage(msg.payload.chatId, msg.payload.messageId);\n        msg.payload.result = result;\n        node.send(msg);\n        node.done();\n    }catch(error){\n        msg.payload.error = error;\n        node.send(msg);\n        node.done();\n    }\n    \n}\n\ndeleteMessage();\n\n\nreturn","outputs":1,"noerr":0,"x":520,"y":300,"wires":[[]]},{"id":"a9531f01.87ca3","type":"debug","z":"9d822e4e.1a2a4","name":"Kick Chat Member","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":490,"y":360,"wires":[]},{"id":"4b2563e9.00492c","type":"subflow:9d822e4e.1a2a4","z":"51a355d0.06a06c","name":"","x":1480,"y":880,"wires":[[]]},{"id":"e305904f.16b89","type":"change","z":"51a355d0.06a06c","name":"","rules":[{"t":"set","p":"payload.token","pt":"msg","to":"token_access_bot","tot":"global"},{"t":"set","p":"payload.messageId","pt":"msg","to":"originalMessage.message_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1280,"y":880,"wires":[["4b2563e9.00492c"]]},{"id":"7e8ca2b9.044a3c","type":"subflow:9d822e4e.1a2a4","z":"51a355d0.06a06c","name":"","x":2600,"y":940,"wires":[[]]},{"id":"f72351bc.5df84","type":"change","z":"51a355d0.06a06c","name":"","rules":[{"t":"set","p":"payload.token","pt":"msg","to":"token_access_bot","tot":"global"},{"t":"set","p":"payload.messageId","pt":"msg","to":"originalMessage.message_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2400,"y":940,"wires":[["7e8ca2b9.044a3c"]]},{"id":"20634e06.3ea032","type":"debug","z":"845fee24.1a24a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1210,"y":820,"wires":[]},{"id":"3492974f.e2a498","type":"debug","z":"845fee24.1a24a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1190,"y":900,"wires":[]},{"id":"23e7946f.08a70c","type":"debug","z":"845fee24.1a24a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1190,"y":1000,"wires":[]},{"id":"16af4204.9de5de","type":"debug","z":"845fee24.1a24a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1190,"y":1080,"wires":[]},{"id":"80a83691.158ef8","type":"comment","z":"845fee24.1a24a","name":"Update chat id changes","info":"","x":200,"y":660,"wires":[]},{"id":"7d7f75ed.a95dfc","type":"function","z":"727c54f5.3975dc","name":"Debug Logs","func":"groupDetail = flow.get('group_info');\nif(groupDetail === undefined){\n    groupDetail = {};\n}\ngroupDetail[msg.payload.ts] = msg;\nflow.set('group_info', groupDetail);\nreturn msg;","outputs":1,"noerr":0,"x":750,"y":980,"wires":[["908448a1.f7cd18","d6d655ec.47aa68"]]},{"id":"acd96802.b74328","type":"file","z":"727c54f5.3975dc","name":"","filename":"logs","appendNewline":true,"createDir":false,"overwriteFile":"false","encoding":"none","x":730,"y":1060,"wires":[["d0f91bdf.c67a58"]]},{"id":"d0f91bdf.c67a58","type":"debug","z":"727c54f5.3975dc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":770,"y":1100,"wires":[]},{"id":"908448a1.f7cd18","type":"debug","z":"727c54f5.3975dc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":770,"y":1020,"wires":[]},{"id":"f88e6d50.65528","type":"inject","z":"727c54f5.3975dc","name":"","topic":"","payload":"{}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":270,"y":1320,"wires":[["15dd2075.a5fad"]]},{"id":"15dd2075.a5fad","type":"file in","z":"727c54f5.3975dc","name":"","filename":"logs","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":430,"y":1320,"wires":[["a839f669.53bf78"]]},{"id":"a839f669.53bf78","type":"debug","z":"727c54f5.3975dc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":610,"y":1340,"wires":[]},{"id":"d6d655ec.47aa68","type":"function","z":"727c54f5.3975dc","name":"","func":"msg.payload.chatId = \"897802142\";\nmsg.payload.type = \"message\";\nmsg.payload.content = JSON.stringify(msg);\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":980,"wires":[["dc5f0cef.08e12"]]},{"id":"dc5f0cef.08e12","type":"chatbot-telegram-send","z":"727c54f5.3975dc","bot":"4c02f411.5d93bc","botProduction":"","track":false,"passThrough":false,"outputs":0,"x":1010,"y":1040,"wires":[]},{"id":"fc0a9be1.9328c8","type":"chatbot-command","z":"727c54f5.3975dc","name":"","command":"/gandolfawaken","x":1200,"y":780,"wires":[["3924b322.a28c5c"]]},{"id":"3924b322.a28c5c","type":"link out","z":"727c54f5.3975dc","name":"Out: DM Group Admin","links":["fd67af51.f8ec9","45e2a194.96ac3"],"x":1355,"y":780,"wires":[]},{"id":"1a7a6373.4cc93d","type":"chatbot-command","z":"845fee24.1a24a","name":"","command":"/verify","x":390,"y":520,"wires":[["54709813.073e98"]]},{"id":"54709813.073e98","type":"change","z":"845fee24.1a24a","name":"","rules":[{"t":"set","p":"payload.token","pt":"msg","to":"token_access_bot","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":520,"wires":[["398e5f1d.183be"]]},{"id":"398e5f1d.183be","type":"subflow:33ebc494.dc22bc","z":"845fee24.1a24a","name":"getChatMember","env":[],"x":880,"y":520,"wires":[["dc1df763.e9ef38"]]},{"id":"dc1df763.e9ef38","type":"switch","z":"845fee24.1a24a","name":"","property":"payload.chatMember.status","propertyType":"msg","rules":[{"t":"eq","v":"creator","vt":"str"},{"t":"eq","v":"admin","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":1090,"y":520,"wires":[["2d7ea643.b4ee8a"],["2d7ea643.b4ee8a"],["d87c5da7.37834"]]},{"id":"45e0423e.aafcfc","type":"node-airtable","z":"845fee24.1a24a","name":"Get groups","auth":"8988a490.b97c78","table":"group","tableType":"str","action":"list","filter":"payload.filter","filterType":"msg","record":"payload","recordType":"msg","records":"","recordsType":"msg","output":"payload.groups","x":1510,"y":520,"wires":[["ab477b0a.9f94f8"],[]]},{"id":"2d7ea643.b4ee8a","type":"function","z":"845fee24.1a24a","name":"","func":"msg.payload.filter = `AND({user_id} = '${msg.payload.userId.toString()}', {status} = 'pending')`;\nreturn msg;","outputs":1,"noerr":0,"x":1310,"y":520,"wires":[["45e0423e.aafcfc"]]},{"id":"ab477b0a.9f94f8","type":"switch","z":"845fee24.1a24a","name":"","property":"payload.groups.length","propertyType":"msg","rules":[{"t":"gt","v":"0","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1700,"y":520,"wires":[["ebfe57cc.637578"],["3f98fb85.8750c4"]]},{"id":"3f98fb85.8750c4","type":"function","z":"845fee24.1a24a","name":"","func":"msg.payload.content = `There are no pending groups for verification.`;\nreturn msg;","outputs":1,"noerr":0,"x":1750,"y":580,"wires":[["2d1562ed.bd70de"]]},{"id":"2d1562ed.bd70de","type":"link out","z":"845fee24.1a24a","name":"Out: Sender","links":["befd67ba.d5cc88"],"x":1875,"y":580,"wires":[]},{"id":"5af81c4e.08f1c4","type":"node-airtable","z":"845fee24.1a24a","name":"Update group status","auth":"8988a490.b97c78","table":"group","tableType":"str","action":"put","filter":"({status} = 'active')","filterType":"str","record":"payload","recordType":"msg","records":"payload.record","recordsType":"msg","output":"payload.group","x":2080,"y":500,"wires":[["65c5108c.51df6","685232dd.d40b9c"],[]]},{"id":"ebfe57cc.637578","type":"function","z":"845fee24.1a24a","name":"","func":"// temp = msg.payload.groups[0];\n\n// temp.fields.chat_id = msg.payload.chatId.toString();\n// temp.fields.group_name = msg.originalMessage.chat.title;\n// temp.fields.status = \"active\";\n\ntemp = {\n    \"id\" : msg.payload.groups[0].id,\n    \"fields\" : {\n        \"chat_id\" : msg.payload.chatId.toString(),\n        \"group_name\" : msg.originalMessage.chat.title,\n        \"status\" : \"active\"\n    }\n}\n\nmsg.payload.record = [ temp ];\n\nreturn msg;","outputs":1,"noerr":0,"x":1870,"y":500,"wires":[["5af81c4e.08f1c4"]]},{"id":"65c5108c.51df6","type":"function","z":"845fee24.1a24a","name":"","func":"msg.payload.content = `Congrats!!! Your group ${msg.originalMessage.chat.title} is verified.`;\nmsg.payload.chatId = msg.payload.userId;\nreturn msg;","outputs":1,"noerr":0,"x":2290,"y":500,"wires":[["ec723a5d.e4bd68"]]},{"id":"ec723a5d.e4bd68","type":"link out","z":"845fee24.1a24a","name":"Out: Sender","links":["befd67ba.d5cc88"],"x":2415,"y":500,"wires":[]},{"id":"685232dd.d40b9c","type":"change","z":"845fee24.1a24a","name":"","rules":[{"t":"set","p":"payload.token","pt":"msg","to":"token_access_bot","tot":"global"},{"t":"set","p":"payload.messageId","pt":"msg","to":"originalMessage.message_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2300,"y":560,"wires":[["7364a17b.fd2fa"]]},{"id":"7364a17b.fd2fa","type":"subflow:9d822e4e.1a2a4","z":"845fee24.1a24a","name":"","env":[],"x":2500,"y":560,"wires":[[]]},{"id":"45e2a194.96ac3","type":"link in","z":"845fee24.1a24a","name":"In: Gandolf Admin Setup","links":["3924b322.a28c5c"],"x":155,"y":740,"wires":[["8c45e8af.ad4578"]]},{"id":"8c45e8af.ad4578","type":"function","z":"845fee24.1a24a","name":"User Cache","func":"cache = global.get(msg.payload.userId.toString());\nif(cache === undefined){\n    cache = {};\n}\ncache.status = 'pending';\nglobal.set(msg.payload.userId.toString(), cache);\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":740,"wires":[["e2afbb34.b61518"]]},{"id":"e2afbb34.b61518","type":"chatbot-image","z":"845fee24.1a24a","name":"","filename":"","image":"https://abridged-bot-images.s3.us-east-2.amazonaws.com/node-red-cache/Gandolf+the+Grey+1.png","caption":"","x":470,"y":740,"wires":[["80c90ef3.66ca8"]]},{"id":"80c90ef3.66ca8","type":"function","z":"845fee24.1a24a","name":"","func":"\nmsg.payload.caption = `I am ${global.get('bot_handle')}, at your service to permission access for your group.`;  \nreturn msg;","outputs":1,"noerr":0,"x":630,"y":740,"wires":[["81b8b919.eb43b8"]]},{"id":"81b8b919.eb43b8","type":"chatbot-telegram-send","z":"845fee24.1a24a","bot":"4c02f411.5d93bc","botProduction":"","track":false,"passThrough":true,"outputs":1,"x":810,"y":740,"wires":[["4af9472.2755ab8"]]},{"id":"4af9472.2755ab8","type":"chatbot-inline-buttons","z":"845fee24.1a24a","name":"","buttons":[{"type":"postback","label":"Modify Existing Group","value":"modify","answer":"","alert":false,"style":""},{"type":"postback","label":"Setup New Group","value":"newgroup","answer":"","alert":false,"style":""}],"message":"First, Would you like to modify existing group or set up a new group?","x":1020,"y":740,"wires":[["8abb6327.9c853"]]},{"id":"8abb6327.9c853","type":"chatbot-telegram-send","z":"845fee24.1a24a","bot":"4c02f411.5d93bc","botProduction":"","track":true,"passThrough":false,"outputs":1,"x":1230,"y":740,"wires":[["f3fb415e.dbed4"]]},{"id":"f3fb415e.dbed4","type":"switch","z":"845fee24.1a24a","name":"","property":"payload.content","propertyType":"msg","rules":[{"t":"eq","v":"/cancel","vt":"str"},{"t":"eq","v":"newgroup","vt":"str"},{"t":"eq","v":"modify","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":1440,"y":740,"wires":[["d7389b47.f49778"],["cd454900.69f808"],["e8a15835.e3f828"]]},{"id":"d7389b47.f49778","type":"link out","z":"845fee24.1a24a","name":"","links":["784f95d2.6ac7dc"],"x":1555,"y":680,"wires":[]},{"id":"cd454900.69f808","type":"function","z":"845fee24.1a24a","name":"","func":"\nmsg.payload.type = 'message';\nmsg.payload.content = `Great!!! What is the link to invite people to your group?`;  \nreturn msg;","outputs":1,"noerr":0,"x":1670,"y":740,"wires":[["d4cfcce6.3a55c"]]},{"id":"e8a15835.e3f828","type":"link out","z":"845fee24.1a24a","name":"Out: Modify Existing Group","links":["a0176c8.8423d9"],"x":1540,"y":800,"wires":[]},{"id":"a0176c8.8423d9","type":"link in","z":"845fee24.1a24a","name":"In: Modify Existing Group","links":["e8a15835.e3f828"],"x":195,"y":1600,"wires":[["fdd0304d.71db3"]]},{"id":"923e1b7e.8e5108","type":"node-airtable","z":"845fee24.1a24a","name":"Get groups","auth":"8988a490.b97c78","table":"group","tableType":"str","action":"list","filter":"payload.filter","filterType":"msg","record":"payload","recordType":"msg","records":"","recordsType":"msg","output":"payload.groups","x":510,"y":1600,"wires":[["6fb39c89.74db14"],[]]},{"id":"6fb39c89.74db14","type":"function","z":"845fee24.1a24a","name":"Goup Buttons","func":"\nbuttons = [];\nlet index = 1;\nmsg.payload.groups.forEach(function(group){\n  button = {\n\t\t\"type\": \"postback\",\n    \t\"label\": group.fields.group_name,\n    \t\"value\": `{\"id\":\"${group.id}\"}`,\n    \t\"alert\": false,\n    \t\"style\": \"\"\n\t}\n\tbuttons.push(button);\n\tif(index % 2 === 0){\n\t    buttons.push({\n\t        \"type\": \"newline\"\n\t    });\n\t}\n\tindex++;\n});\n\n// buttons.push(button = {\n// \t\"type\": \"postback\",\n// \t\"label\": \"Done\",\n// \t\"value\": `{\"en\":\"done\", \"d\":\"ar\", \"ac\":\"ad\"}`,\n// \t\"alert\": false,\n// \t\"style\": \"\"\n// });\n\nmsg.payload.type = \"inline-buttons\";\nmsg.payload.content = \"Which group would you like admittance to?\";\nmsg.payload.buttons = buttons;\n\nreturn msg;","outputs":1,"noerr":0,"x":700,"y":1600,"wires":[["bc018083.5cf1d"]]},{"id":"bc018083.5cf1d","type":"chatbot-telegram-send","z":"845fee24.1a24a","bot":"4c02f411.5d93bc","botProduction":"","track":true,"passThrough":false,"outputs":1,"x":930,"y":1600,"wires":[["7af868fd.631ab8","e7920468.595118"]]},{"id":"e7920468.595118","type":"change","z":"845fee24.1a24a","name":"","rules":[{"t":"set","p":"payload.token","pt":"msg","to":"token_access_bot","tot":"global"},{"t":"set","p":"payload.messageId","pt":"msg","to":"originalMessage.message_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":940,"y":1560,"wires":[["e3056771.4a9768"]]},{"id":"e3056771.4a9768","type":"subflow:9d822e4e.1a2a4","z":"845fee24.1a24a","name":"","x":960,"y":1520,"wires":[[]]},{"id":"7af868fd.631ab8","type":"switch","z":"845fee24.1a24a","name":"","property":"payload.content","propertyType":"msg","rules":[{"t":"eq","v":"/cancel","vt":"str"},{"t":"istype","v":"json","vt":"json"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":1150,"y":1600,"wires":[["e30152f6.1521e"],["776bae62.d9715"],[]]},{"id":"e30152f6.1521e","type":"link out","z":"845fee24.1a24a","name":"","links":["784f95d2.6ac7dc"],"x":1295,"y":1560,"wires":[]},{"id":"fdd0304d.71db3","type":"function","z":"845fee24.1a24a","name":"","func":"\nmsg.payload.filter = `{user_id} = '${msg.payload.userId.toString()}'`;\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":1600,"wires":[["923e1b7e.8e5108","2ea6d190.db52ce"]]},{"id":"f2a376ec.bc9088","type":"debug","z":"845fee24.1a24a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1730,"y":1600,"wires":[]},{"id":"6d2b3e04.9cdb8","type":"comment","z":"845fee24.1a24a","name":"","info":"tet records ids \nJames: recI9DwLarbgp6yxV \nAlok: recdDAfbv18ZSk6Bq","x":180,"y":1700,"wires":[]},{"id":"2ea6d190.db52ce","type":"debug","z":"845fee24.1a24a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":530,"y":1660,"wires":[]},{"id":"776bae62.d9715","type":"json","z":"845fee24.1a24a","name":"","property":"payload.content","action":"obj","pretty":false,"x":1310,"y":1600,"wires":[["926d95f2.865868"]]},{"id":"926d95f2.865868","type":"function","z":"845fee24.1a24a","name":"User Cache","func":"cache = global.get(msg.payload.userId.toString());\nif(cache === undefined){\n    cache = {};\n}\ncache.status = 'pending';\ncache.groupRecordId = msg.payload.content.id;\nglobal.set(msg.payload.userId.toString(), cache);\nreturn msg;","outputs":1,"noerr":0,"x":1510,"y":1600,"wires":[["f2a376ec.bc9088","cd454900.69f808"]]},{"id":"dd1ba488.4247b8","type":"subflow:bc40755d.eab8d8","z":"845fee24.1a24a","name":"","env":[],"x":610,"y":1140,"wires":[["48199e16.41872"],[]]},{"id":"d18beb71.64aeb8","type":"function","z":"845fee24.1a24a","name":"","func":"msg.payload.tableName = 'group';\ncache = global.get(msg.payload.userId.toString());\nif(cache.groupRecordId === undefined){\n    return [msg, null];\n}else {\n    msg.payload.groupRecordId = cache.groupRecordId\n    return [null, msg];\n}\n","outputs":2,"noerr":0,"x":410,"y":1140,"wires":[["dd1ba488.4247b8"],["3d82c742.86e778"]]},{"id":"48199e16.41872","type":"change","z":"845fee24.1a24a","name":"","rules":[{"t":"set","p":"payload.groupRecordId","pt":"msg","to":"payload.user.id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":850,"y":1140,"wires":[["3d82c742.86e778"]]},{"id":"58d1436a.1e1e0c","type":"function","z":"845fee24.1a24a","name":"Reset User Cache","func":"cache = global.get(msg.payload.userId.toString());\ncache = {};\nglobal.set(msg.payload.userId.toString(), cache);\nreturn msg;","outputs":1,"noerr":0,"x":1490,"y":1240,"wires":[[]]},{"id":"67c9e9a5.ebd988","type":"change","z":"f394d95a.d75788","name":"","rules":[{"t":"set","p":"payload.token","pt":"msg","to":"token_access_bot","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":1200,"wires":[["72360d31.b19164","3c757ded.3b0812"]]},{"id":"7b8db337.7d9f3c","type":"link in","z":"f394d95a.d75788","name":"In: Kick Without Checking","links":["ea59bd28.6834f","31773d1a.59b552","53f57b9a.9365b4","1037c612.83731a"],"x":240,"y":1200,"wires":[["67c9e9a5.ebd988"]]},{"id":"3c757ded.3b0812","type":"debug","z":"f394d95a.d75788","name":"Kick Without Checking","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":740,"y":1240,"wires":[]},{"id":"e87103ba.5b21a","type":"inject","z":"767fa731.3692c8","name":"","topic":"","payload":"{\"privateKey\":\"0xc5699a1c5bdee6a1094de458fa3a536e2a947f354d27af68f92e4a838d60f27c\",\"account_address\":\"0xaF036eAE6D66A46583aFeb768da59E2Fe62235e4\"}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":340,"wires":[["5b95d92e.8d6238"]]},{"id":"5b95d92e.8d6238","type":"function","z":"767fa731.3692c8","name":"SDK v2 Helper","func":"\n// create sdk\nfetch = global.get('fetch');\nWebSocket = global.get('ws');\nabridged = global.get(\"abridged\");\n\nNotificationTypes = abridged.NotificationTypes;\n\nprivateKey = msg.payload.privateKey;\naddress = msg.payload.address;\nsdkAction = msg.payload.action;\n\nlet sdk;\nlet account;\n\nsdk = abridged.createKovanSdk({\n    authKeyModule: {\n      privateKey\n    },\n    queryProviderEndpoint: 'https://mainnet.infura.io/v3/7acf175321ac4b3cba908ec2111dc297',\n    fetch,\n    WebSocket\n})\nmsg.payload.gaurdianKey = sdk.state$.authKey$.address$._value;\nflow.set('sdk', sdk);\n\n// connect sdk\nasync function createOrConnectAccount (){\n    account = await sdk.createAccount(msg.payload.address);\n    msg.payload.account = account;\n    flow.set('account', account);\n    // node.send(msg);\n}\n\nasync function batchExecute() {\n    const options = {\n      recipient: msg.payload.recipient,\n      value: msg.payload.value,\n      data: msg.payload.data,\n    };\n\n   let batch = await sdk.batchExecuteAccountTransaction(options);\n   msg.payload.batchExecuteBatch = batch;\n//   node.send(msg);\n}\n\nasync function setAuthKey () {\n  output = await sdk.batchSetAccountAuthKey({\n      authKey: msg.payload.authKey,\n      type: \"Owner\"\n  })\n  msg.payload.authKeyOutput = output;\n  // node.send(msg);\n}\n\nasync function estimateBatch() {\n    const refundToken = null; // optional\n    let batch = await sdk.estimateBatch(refundToken)\n    msg.payload.estimateBatchBatch = batch;\n    // node.send(batch);\n}\n\nasync function submitBatch() {\n    const gasPrice = null; // optional\n    let key = await sdk.submitBatch(gasPrice)\n    msg.payload.submitBatchKey = key;\n    const subscribtion = sdk\n    .state$\n    .notification$\n    .subscribe(notification => {\n        console.log(\"subscribe\")\n        if (notification === null) {\n            return;\n        }\n        if (notification.type === NotificationTypes.RelayedTransactionUpdated && notification.payload.state === 'Sending') {\n            msg.payload.hash = notification.payload.hash;\n            node.send(msg);\n            node.done()\n            // resolve(notification.payload.hash);\n            subscribtion.unsubscribe();\n            return;\n        }\n    });\n}\n\nasync function resetSdk() {\n    await sdk.resetAccount();\n}\n\n\nasync function flashLoan() {\n    \n}\n\nasync function process() {\n    await createOrConnectAccount();\n    \n    if(sdkAction === \"SDK_ACTION_SET_AUTH_KEY\"){\n        await setAuthKey(); \n        await estimateBatch();\n        await submitBatch();\n    } else if(sdkAction === \"SDK_ACTION_EXECUTE_TRX\"){\n        await batchExecute();\n        await estimateBatch();\n        await submitBatch();\n    }else {\n        // await resetSdk();\n        msg.payload.done = true;\n        node.send(msg,false);\n        node.done();\n    } \n}\n\nprocess();","outputs":1,"noerr":0,"x":400,"y":340,"wires":[["21d492bf.81952e","d1c4b95b.1b0618"]]},{"id":"21d492bf.81952e","type":"debug","z":"767fa731.3692c8","name":"SDK Response","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":400,"y":280,"wires":[]},{"id":"85482e5.23942d","type":"debug","z":"767fa731.3692c8","name":"Eth Balance","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":630,"y":280,"wires":[]},{"id":"683725f.006a0dc","type":"function","z":"767fa731.3692c8","name":"Approve Dai To Chai","func":"ethers = global.get(\"ethers\");\n\nlet abi = flow.get(\"abi_dai\");\napprovarAddress = flow.get(\"address_contract_chai\");\namount = ethers.utils.parseEther('1000000000000000000')\n\nmsg.payload.config = {\n  \"recipient\" : flow.get(\"address_contract_dai\"),\n  abi,\n  \"apiCall\" : \"approve\",\n  \"args\" : [approvarAddress, amount]\n};\nreturn msg;\n\n","outputs":1,"noerr":0,"x":380,"y":520,"wires":[["81512f1f.8c606"]]},{"id":"81512f1f.8c606","type":"subflow:bc5c5eb0.964c7","z":"767fa731.3692c8","name":"","env":[],"x":610,"y":520,"wires":[["3cf1f777.0ae1f8"]]},{"id":"3cf1f777.0ae1f8","type":"change","z":"767fa731.3692c8","name":"","rules":[{"t":"set","p":"payload.recipient","pt":"msg","to":"payload.config.recipient","tot":"msg"},{"t":"set","p":"payload.data","pt":"msg","to":"payload.calldata","tot":"msg"},{"t":"set","p":"payload.value","pt":"msg","to":"payload.config.value","tot":"msg"},{"t":"set","p":"payload.action","pt":"msg","to":"SDK_ACTION_EXECUTE_TRX","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":800,"y":520,"wires":[["51132a82.266b14"]]},{"id":"cfc0e4e4.f103b8","type":"debug","z":"767fa731.3692c8","name":"SDK V2 Response","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1110,"y":460,"wires":[]},{"id":"4fab3379.e5074c","type":"inject","z":"767fa731.3692c8","name":"","topic":"","payload":"{}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":190,"y":520,"wires":[["683725f.006a0dc"]]},{"id":"99bf2434.0fa7e8","type":"inject","z":"767fa731.3692c8","name":"Consts","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":180,"y":140,"wires":[["1b886b9c.1ca784"]]},{"id":"1b886b9c.1ca784","type":"change","z":"767fa731.3692c8","name":"Do Not Change This","rules":[{"t":"set","p":"network","pt":"flow","to":"kovan","tot":"str"},{"t":"set","p":"wyre_link","pt":"flow","to":"https://pay.testwyre.com/purchase","tot":"str"},{"t":"set","p":"ether_scan_url","pt":"flow","to":"https://kovan.etherscan.io","tot":"str"},{"t":"set","p":"address_contract_erc20_token_factory","pt":"flow","to":"0xa9552d5d190816a4b275022837dbb39563ab5bf1","tot":"str"},{"t":"set","p":"abi_erc20_token_factory","pt":"flow","to":"[{\"constant\":false,\"inputs\":[{\"internalType\":\"string\",\"name\":\"_name\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"_symbol\",\"type\":\"string\"},{\"internalType\":\"uint256\",\"name\":\"_supply\",\"type\":\"uint256\"},{\"internalType\":\"uint8\",\"name\":\"_decimals\",\"type\":\"uint8\"},{\"internalType\":\"address\",\"name\":\"_issuer\",\"type\":\"address\"}],\"name\":\"mint\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"internalType\":\"address\",\"name\":\"tokenAddress\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"string\",\"name\":\"name\",\"type\":\"string\"},{\"indexed\":false,\"internalType\":\"string\",\"name\":\"symbol\",\"type\":\"string\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"supply\",\"type\":\"uint256\"},{\"indexed\":false,\"internalType\":\"uint8\",\"name\":\"decimals\",\"type\":\"uint8\"},{\"indexed\":false,\"internalType\":\"address\",\"name\":\"issuer\",\"type\":\"address\"}],\"name\":\"Mint\",\"type\":\"event\"}]","tot":"json"},{"t":"set","p":"address_contract_dai","pt":"flow","to":"0x4f96fe3b7a6cf9725f59d353f723c1bdb64ca6aa","tot":"str"},{"t":"set","p":"abi_dai","pt":"flow","to":"[{\"constant\":true,\"inputs\":[],\"name\":\"name\",\"outputs\":[{\"name\":\"\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"stop\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"guy\",\"type\":\"address\"},{\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"approve\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"owner_\",\"type\":\"address\"}],\"name\":\"setOwner\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"totalSupply\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"src\",\"type\":\"address\"},{\"name\":\"dst\",\"type\":\"address\"},{\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"transferFrom\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"decimals\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"guy\",\"type\":\"address\"},{\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"mint\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"burn\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"name_\",\"type\":\"bytes32\"}],\"name\":\"setName\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"src\",\"type\":\"address\"}],\"name\":\"balanceOf\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"stopped\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"authority_\",\"type\":\"address\"}],\"name\":\"setAuthority\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"owner\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"symbol\",\"outputs\":[{\"name\":\"\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"guy\",\"type\":\"address\"},{\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"burn\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"mint\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"dst\",\"type\":\"address\"},{\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"transfer\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"dst\",\"type\":\"address\"},{\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"push\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"src\",\"type\":\"address\"},{\"name\":\"dst\",\"type\":\"address\"},{\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"move\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"start\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"authority\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"guy\",\"type\":\"address\"}],\"name\":\"approve\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"src\",\"type\":\"address\"},{\"name\":\"guy\",\"type\":\"address\"}],\"name\":\"allowance\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"src\",\"type\":\"address\"},{\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"pull\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"name\":\"symbol_\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"guy\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"Mint\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"guy\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"Burn\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"authority\",\"type\":\"address\"}],\"name\":\"LogSetAuthority\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"owner\",\"type\":\"address\"}],\"name\":\"LogSetOwner\",\"type\":\"event\"},{\"anonymous\":true,\"inputs\":[{\"indexed\":true,\"name\":\"sig\",\"type\":\"bytes4\"},{\"indexed\":true,\"name\":\"guy\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"foo\",\"type\":\"bytes32\"},{\"indexed\":true,\"name\":\"bar\",\"type\":\"bytes32\"},{\"indexed\":false,\"name\":\"wad\",\"type\":\"uint256\"},{\"indexed\":false,\"name\":\"fax\",\"type\":\"bytes\"}],\"name\":\"LogNote\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"src\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"guy\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"Approval\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"src\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"dst\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"Transfer\",\"type\":\"event\"}]","tot":"json"},{"t":"set","p":"address_contract_dai_exchange","pt":"flow","to":"0x47D4Af3BBaEC0dE4dba5F44ae8Ed2761977D32d6","tot":"str"},{"t":"set","p":"address_contract_uniswap_exchange","pt":"flow","to":"0xD3E51Ef092B2845f10401a0159B2B96e8B6c3D30","tot":"str"},{"t":"set","p":"abi_uniswap_exchange","pt":"flow","to":"[{\"name\":\"NewExchange\",\"inputs\":[{\"type\":\"address\",\"name\":\"token\",\"indexed\":true},{\"type\":\"address\",\"name\":\"exchange\",\"indexed\":true}],\"anonymous\":false,\"type\":\"event\"},{\"name\":\"initializeFactory\",\"outputs\":[],\"inputs\":[{\"type\":\"address\",\"name\":\"template\"}],\"constant\":false,\"payable\":false,\"type\":\"function\",\"gas\":35725},{\"name\":\"createExchange\",\"outputs\":[{\"type\":\"address\",\"name\":\"out\"}],\"inputs\":[{\"type\":\"address\",\"name\":\"token\"}],\"constant\":false,\"payable\":false,\"type\":\"function\",\"gas\":187911},{\"name\":\"getExchange\",\"outputs\":[{\"type\":\"address\",\"name\":\"out\"}],\"inputs\":[{\"type\":\"address\",\"name\":\"token\"}],\"constant\":true,\"payable\":false,\"type\":\"function\",\"gas\":715},{\"name\":\"getToken\",\"outputs\":[{\"type\":\"address\",\"name\":\"out\"}],\"inputs\":[{\"type\":\"address\",\"name\":\"exchange\"}],\"constant\":true,\"payable\":false,\"type\":\"function\",\"gas\":745},{\"name\":\"getTokenWithId\",\"outputs\":[{\"type\":\"address\",\"name\":\"out\"}],\"inputs\":[{\"type\":\"uint256\",\"name\":\"token_id\"}],\"constant\":true,\"payable\":false,\"type\":\"function\",\"gas\":736},{\"name\":\"exchangeTemplate\",\"outputs\":[{\"type\":\"address\",\"name\":\"out\"}],\"inputs\":[],\"constant\":true,\"payable\":false,\"type\":\"function\",\"gas\":633},{\"name\":\"tokenCount\",\"outputs\":[{\"type\":\"uint256\",\"name\":\"out\"}],\"inputs\":[],\"constant\":true,\"payable\":false,\"type\":\"function\",\"gas\":663}]","tot":"json"},{"t":"set","p":"address_contract_chai","pt":"flow","to":"0xb641957b6c29310926110848db2d464c8c3c3f38","tot":"str"},{"t":"set","p":"abi_chai","pt":"flow","to":"[{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"chainId_\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"vat_\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"pot_\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"join_\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"dai_\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"src\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"address\",\"name\":\"guy\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"Approval\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"src\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"address\",\"name\":\"dst\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"Transfer\",\"type\":\"event\"},{\"constant\":true,\"inputs\":[],\"name\":\"DOMAIN_SEPARATOR\",\"outputs\":[{\"internalType\":\"bytes32\",\"name\":\"\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"PERMIT_TYPEHASH\",\"outputs\":[{\"internalType\":\"bytes32\",\"name\":\"\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"name\":\"allowance\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"usr\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"approve\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"name\":\"balanceOf\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"usr\",\"type\":\"address\"}],\"name\":\"dai\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"wad\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"daiJoin\",\"outputs\":[{\"internalType\":\"contract JoinLike\",\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"daiToken\",\"outputs\":[{\"internalType\":\"contract GemLike\",\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"decimals\",\"outputs\":[{\"internalType\":\"uint8\",\"name\":\"\",\"type\":\"uint8\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"src\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"draw\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"src\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"exit\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"dst\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"join\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"src\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"dst\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"move\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"name\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"name\":\"nonces\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"holder\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"spender\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"nonce\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"expiry\",\"type\":\"uint256\"},{\"internalType\":\"bool\",\"name\":\"allowed\",\"type\":\"bool\"},{\"internalType\":\"uint8\",\"name\":\"v\",\"type\":\"uint8\"},{\"internalType\":\"bytes32\",\"name\":\"r\",\"type\":\"bytes32\"},{\"internalType\":\"bytes32\",\"name\":\"s\",\"type\":\"bytes32\"}],\"name\":\"permit\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"pot\",\"outputs\":[{\"internalType\":\"contract PotLike\",\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"symbol\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"totalSupply\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"dst\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"transfer\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"src\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"dst\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"transferFrom\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"vat\",\"outputs\":[{\"internalType\":\"contract VatLike\",\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"version\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"}]","tot":"json"},{"t":"set","p":"wyre_account_id","pt":"flow","to":"AC_3N8VHCTUZYC","tot":"str"},{"t":"set","p":"SDK_ACTION_SET_AUTH_KEY","pt":"flow","to":"SDK_ACTION_SET_AUTH_KEY","tot":"str"},{"t":"set","p":"SDK_ACTION_EXECUTE_TRX","pt":"flow","to":"SDK_ACTION_EXECUTE_TRX","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":440,"y":140,"wires":[[]]},{"id":"e53b8ace.33cd68","type":"change","z":"767fa731.3692c8","name":"Config: Server Url","rules":[{"t":"set","p":"node_red_server_url","pt":"flow","to":"http://b4261449.ngrok.io","tot":"str"},{"t":"set","p":"react_server_url","pt":"flow","to":"http://ec2-13-59-130-222.us-east-2.compute.amazonaws.com:3000","tot":"str"},{"t":"set","p":"token_address","pt":"flow","to":"","tot":"str"},{"t":"set","p":"wyre_default_amount","pt":"flow","to":"200","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":430,"y":80,"wires":[[]]},{"id":"3f953183.0dca2e","type":"inject","z":"767fa731.3692c8","name":"Consts","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":180,"y":80,"wires":[["e53b8ace.33cd68"]]},{"id":"b5a55ede.616c3","type":"comment","z":"767fa731.3692c8","name":"Does not need to be on same block","info":"","x":260,"y":480,"wires":[]},{"id":"c917bc86.86161","type":"function","z":"767fa731.3692c8","name":"SDK v2 Helper","func":"\n// create sdk\nfetch = global.get('fetch');\nWebSocket = global.get('ws');\nabridged = global.get(\"abridged\");\n\nNotificationTypes = abridged.NotificationTypes;\n\nprivateKey = msg.payload.privateKey;\naddress = msg.payload.address;\nsdkAction = msg.payload.action;\n\nlet sdk;\nlet account;\n\nsdk = abridged.createKovanSdk({\n    authKeyModule: {\n      privateKey\n    },\n    queryProviderEndpoint: 'https://kovan.infura.io/v3/7acf175321ac4b3cba908ec2111dc297',\n    fetch,\n    WebSocket\n})\nmsg.payload.gaurdianKey = sdk.state$.authKey$.address$._value;\n\n// connect sdk\nasync function createOrConnectAccount (){\n    account = await sdk.createAccount(msg.payload.address);\n    msg.payload.account = account;\n    // node.send(msg);\n}\n\nasync function batchExecute() {\n    const options = {\n      recipient: msg.payload.recipient,\n      value: msg.payload.value,\n      data: msg.payload.data,\n    };\n\n   let batch = await sdk.batchExecuteAccountTransaction(options);\n   msg.payload.batchExecuteBatch = batch;\n//   node.send(msg);\n}\n\nasync function setAuthKey () {\n  output = await sdk.batchSetAccountAuthKey({\n      authKey: msg.payload.authKey,\n      type: \"Owner\"\n  })\n  msg.payload.authKeyOutput = output;\n  // node.send(msg);\n}\n\nasync function estimateBatch() {\n    const refundToken = null; // optional\n    let batch = await sdk.estimateBatch(refundToken)\n    msg.payload.estimateBatchBatch = batch;\n    // node.send(batch);\n}\n\nasync function submitBatch() {\n    const gasPrice = null; // optional\n    let key = await sdk.submitBatch(gasPrice)\n    msg.payload.submitBatchKey = key;\n    const subscribtion = sdk\n    .state$\n    .notification$\n    .subscribe(notification => {\n        console.log(\"subscribe\")\n        if (notification === null) {\n            return;\n        }\n        if (notification.type === NotificationTypes.RelayedTransactionUpdated && notification.payload.state === 'Sending') {\n            msg.payload.hash = notification.payload.hash;\n            node.send(msg);\n            node.done()\n            // resolve(notification.payload.hash);\n            subscribtion.unsubscribe();\n            return;\n        }\n    });\n}\n\nasync function resetSdk() {\n    await sdk.resetAccount();\n}\n\n\nasync function flashLoan() {\n    \n}\n\nasync function process() {\n    await createOrConnectAccount();\n    \n    if(sdkAction === \"SDK_ACTION_SET_AUTH_KEY\"){\n        await setAuthKey(); \n        await estimateBatch();\n        await submitBatch();\n    } else if(sdkAction === \"SDK_ACTION_EXECUTE_TRX\"){\n        await batchExecute();\n        await estimateBatch();\n        await submitBatch();\n    }else {\n        await resetSdk();\n        msg.payload.done = true;\n        node.send(msg,false);\n        node.done();\n    } \n}\n\nprocess();","outputs":1,"noerr":0,"x":140,"y":260,"wires":[[]]},{"id":"d1c4b95b.1b0618","type":"change","z":"767fa731.3692c8","name":"","rules":[{"t":"set","p":"payload.address","pt":"msg","to":"account.address","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":340,"wires":[[]]},{"id":"a46ccd79.db1d2","type":"function","z":"767fa731.3692c8","name":"SDK v2 Helper","func":"\n// create sdk\nfetch = global.get('fetch');\nWebSocket = global.get('ws');\nabridged = global.get(\"abridged\");\n\nlet sdk = flow.get('sdk');\nlet account = flow.get('account'); \n\nasync function batchExecute() {\n    const options = {\n      recipient: msg.payload.recipient,\n      value: msg.payload.value,\n      data: msg.payload.data,\n    };\n\n   let batch = await sdk.batchExecuteAccountTransaction(options);\n   msg.payload.batchExecuteBatch = batch;\n   node.send(msg);\n}\n\nasync function process() {\n    await batchExecute(); \n    await estimateBatch();\n    await submitBatch();\n}\n\nprocess();","outputs":1,"noerr":0,"x":1020,"y":520,"wires":[[]]},{"id":"d050814c.214ea","type":"change","z":"767fa731.3692c8","name":"","rules":[{"t":"set","p":"payload.config.account_address","pt":"msg","to":"account.address","tot":"flow"},{"t":"set","p":"payload.config.network","pt":"msg","to":"network","tot":"flow"},{"t":"set","p":"payload.config.address_contract","pt":"msg","to":"address_contract_dai","tot":"flow"},{"t":"set","p":"payload.config.abi","pt":"msg","to":"abi_dai","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":640,"wires":[[]]},{"id":"3ebb9242.09b2ee","type":"function","z":"767fa731.3692c8","name":"Call Chai Join","func":"ethers = global.get(\"ethers\");\n\nlet abi = flow.get(\"abi_chai\");\namount = msg.payload.config.balance;\n\nmsg.payload.config = {\n  \"recipient\" : flow.get(\"address_contract_chai\"),\n  abi,\n  \"apiCall\" : \"join\", \n  \"args\" : [ flow.get('account').address, ethers.utils.parseEther(amount)]\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"x":780,"y":640,"wires":[["6feec93e.c42228"]]},{"id":"6feec93e.c42228","type":"subflow:bc5c5eb0.964c7","z":"767fa731.3692c8","name":"","env":[],"x":570,"y":700,"wires":[["7c49265a.bc61f8"]]},{"id":"7c49265a.bc61f8","type":"change","z":"767fa731.3692c8","name":"","rules":[{"t":"set","p":"payload.recipient","pt":"msg","to":"payload.config.recipient","tot":"msg"},{"t":"set","p":"payload.data","pt":"msg","to":"payload.calldata","tot":"msg"},{"t":"set","p":"payload.value","pt":"msg","to":"payload.config.value","tot":"msg"},{"t":"set","p":"payload.action","pt":"msg","to":"SDK_ACTION_EXECUTE_TRX","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":780,"y":700,"wires":[["ccfb82f4.ee197"]]},{"id":"caef75b2.c636b8","type":"debug","z":"767fa731.3692c8","name":"SDK V2 Response","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1030,"y":640,"wires":[]},{"id":"ccfb82f4.ee197","type":"function","z":"767fa731.3692c8","name":"SDK v2 Helper","func":"\n// create sdk\nfetch = global.get('fetch');\nWebSocket = global.get('ws');\nabridged = global.get(\"abridged\");\n\nlet sdk = flow.get('sdk');\nlet account = flow.get('account'); \n\nasync function batchExecute() {\n    const options = {\n      recipient: msg.payload.recipient,\n      value: msg.payload.value,\n      data: msg.payload.data,\n    };\n\n   let batch = await sdk.batchExecuteAccountTransaction(options);\n   msg.payload.batchExecuteBatch = batch;\n   node.send(msg);\n}\n\nasync function process() {\n    await batchExecute(); \n}\n\nprocess();","outputs":1,"noerr":0,"x":1000,"y":700,"wires":[["caef75b2.c636b8","8aa6b60.3f2d548"]]},{"id":"48dd429e.4a907c","type":"inject","z":"767fa731.3692c8","name":"","topic":"","payload":"{}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":170,"y":640,"wires":[["d050814c.214ea"]]},{"id":"ddbb4cb3.5de26","type":"debug","z":"767fa731.3692c8","name":"Dai Balance","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":550,"y":600,"wires":[]},{"id":"4b653fbc.bb90e","type":"function","z":"767fa731.3692c8","name":"SDK v2 Helper","func":"\n// create sdk\nfetch = global.get('fetch');\nWebSocket = global.get('ws');\nabridged = global.get(\"abridged\");\n\nNotificationTypes = abridged.NotificationTypes;\n\n\n\nlet sdk = flow.get('sdk');\nlet account = flow.get('account');\n\n\n\nasync function estimateBatch() {\n    try{\n    const refundToken = null; // optional\n    let batch = await sdk.estimateBatch(refundToken)\n    msg.payload.estimateBatchBatch = batch;\n    }catch(error){\n        msg.payload.error = error;\n    }\n    node.send(msg);\n}\n\nasync function submitBatch() {\n    const gasPrice = null; // optional\n    let key = await sdk.submitBatch(gasPrice)\n    msg.payload.submitBatchKey = key;\n    const subscribtion = sdk\n    .state$\n    .notification$\n    .subscribe(notification => {\n        console.log(\"subscribe\")\n        if (notification === null) {\n            return;\n        }\n        if (notification.type === NotificationTypes.RelayedTransactionUpdated && notification.payload.state === 'Sending') {\n            msg.payload.hash = notification.payload.hash;\n            node.send(msg);\n            node.done()\n            // resolve(notification.payload.hash);\n            subscribtion.unsubscribe();\n            return;\n        }\n    });\n}\n\n\nasync function process() {\n    await estimateBatch();\n    await submitBatch();\n}\n\nprocess();","outputs":1,"noerr":0,"x":400,"y":1000,"wires":[["4aaba5d9.8ed3ec"]]},{"id":"eda276f7.0afa88","type":"inject","z":"767fa731.3692c8","name":"","topic":"","payload":"{}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":170,"y":1000,"wires":[["4b653fbc.bb90e"]]},{"id":"4aaba5d9.8ed3ec","type":"debug","z":"767fa731.3692c8","name":"Submit Batch Rrespoonse","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":690,"y":1000,"wires":[]},{"id":"8aa6b60.3f2d548","type":"change","z":"767fa731.3692c8","name":"","rules":[{"t":"set","p":"payload.config.account_address","pt":"msg","to":"account.address","tot":"flow"},{"t":"set","p":"payload.config.network","pt":"msg","to":"network","tot":"flow"},{"t":"set","p":"payload.config.address_contract","pt":"msg","to":"address_contract_chai","tot":"flow"},{"t":"set","p":"payload.config.abi","pt":"msg","to":"abi_chai","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":360,"y":800,"wires":[[]]},{"id":"1e17d33b.c344ed","type":"function","z":"767fa731.3692c8","name":"Call Chai Exit","func":"ethers = global.get(\"ethers\");\n\nlet abi = flow.get(\"abi_chai\");\namount = msg.payload.config.balance;\n\nmsg.payload.config = {\n  \"recipient\" : flow.get(\"address_contract_chai\"),\n  abi,\n  \"apiCall\" : \"exit\", \n  \"args\" : [ flow.get('account').address, ethers.utils.parseEther(amount)]\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"x":750,"y":800,"wires":[["cc32f2b4.0446f"]]},{"id":"cc32f2b4.0446f","type":"subflow:bc5c5eb0.964c7","z":"767fa731.3692c8","name":"","env":[],"x":590,"y":860,"wires":[["f5f16e4f.b25c5","ef81b06.fab305"]]},{"id":"f5f16e4f.b25c5","type":"change","z":"767fa731.3692c8","name":"","rules":[{"t":"set","p":"payload.recipient","pt":"msg","to":"payload.config.recipient","tot":"msg"},{"t":"set","p":"payload.data","pt":"msg","to":"payload.calldata","tot":"msg"},{"t":"set","p":"payload.value","pt":"msg","to":"payload.config.value","tot":"msg"},{"t":"set","p":"payload.action","pt":"msg","to":"SDK_ACTION_EXECUTE_TRX","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":800,"y":860,"wires":[["7873b348.e5aa3c"]]},{"id":"de697fcf.77965","type":"debug","z":"767fa731.3692c8","name":"SDK V2 Response","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1010,"y":800,"wires":[]},{"id":"235ac54.591aa3a","type":"inject","z":"767fa731.3692c8","name":"","topic":"","payload":"{}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":170,"y":800,"wires":[["8aa6b60.3f2d548"]]},{"id":"7873b348.e5aa3c","type":"function","z":"767fa731.3692c8","name":"SDK v2 Helper","func":"\n// create sdk\nfetch = global.get('fetch');\nWebSocket = global.get('ws');\nabridged = global.get(\"abridged\");\n\nlet sdk = flow.get('sdk');\nlet account = flow.get('account'); \n\nasync function batchExecute() {\n    const options = {\n      recipient: msg.payload.recipient,\n      value: msg.payload.value,\n      data: msg.payload.data,\n    };\n\n   let batch = await sdk.batchExecuteAccountTransaction(options);\n   msg.payload.batchExecuteBatch = batch;\n   node.send(msg);\n}\n\nasync function process() {\n    await batchExecute(); \n}\n\nprocess();","outputs":1,"noerr":0,"x":1000,"y":860,"wires":[["de697fcf.77965","4b653fbc.bb90e"]]},{"id":"f58f3b1f.9ca338","type":"debug","z":"767fa731.3692c8","name":"Chai Balance","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":570,"y":760,"wires":[]},{"id":"ef81b06.fab305","type":"debug","z":"767fa731.3692c8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":770,"y":920,"wires":[]},{"id":"51132a82.266b14","type":"function","z":"767fa731.3692c8","name":"SDK v2 Helper","func":"\n// create sdk\nfetch = global.get('fetch');\nWebSocket = global.get('ws');\nabridged = global.get(\"abridged\");\n\nNotificationTypes = abridged.NotificationTypes;\n\nprivateKey = msg.payload.privateKey;\naddress = msg.payload.address;\nsdkAction = msg.payload.action;\n\nlet sdk;\nlet account;\n\nsdk = abridged.createKovanSdk({\n    authKeyModule: {\n      privateKey\n    },\n    queryProviderEndpoint: 'https://mainnet.infura.io/v3/8b43b467bc3f46ef8e059a020f3736bc',\n    fetch,\n    WebSocket\n})\nmsg.payload.gaurdianKey = sdk.state$.authKey$.address$._value;\n\n// connect sdk\nasync function createOrConnectAccount (){\n    account = await sdk.createAccount(msg.payload.address);\n    msg.payload.account = account;\n     node.send(msg);\n}\n\nasync function batchExecute() {\n    const options = {\n      recipient: msg.payload.recipient,\n      value: msg.payload.value,\n      data: msg.payload.data,\n    };\n\n   let batch = await sdk.batchExecuteAccountTransaction(options);\n   msg.payload.batchExecuteBatch = batch;\n   node.send(msg);\n}\n\nasync function setAuthKey () {\n  output = await sdk.batchSetAccountAuthKey({\n      authKey: msg.payload.authKey,\n      type: \"Owner\"\n  })\n  msg.payload.authKeyOutput = output;\n   node.send(msg);\n}\n\nasync function estimateBatch() {\n    try{\n    const refundToken = null; // optional\n    let batch = await sdk.estimateBatch(refundToken)\n    msg.payload.estimateBatchBatch = batch;\n    }catch(error ){\n        msg.payload.estimateBatchError = error;\n    }\n     node.send(msg);\n}\n\nasync function submitBatch() {\n    const gasPrice = null; // optional\n    let key = await sdk.submitBatch(gasPrice)\n    msg.payload.submitBatchKey = key;\n    const subscribtion = sdk\n    .state$\n    .notification$\n    .subscribe(notification => {\n        console.log(\"subscribe\")\n        if (notification === null) {\n            return;\n        }\n        if (notification.type === NotificationTypes.RelayedTransactionUpdated && notification.payload.state === 'Sending') {\n            msg.payload.hash = notification.payload.hash;\n            node.send(msg);\n            node.done()\n            // resolve(notification.payload.hash);\n            subscribtion.unsubscribe();\n            return;\n        }\n    });\n}\n\nasync function resetSdk() {\n    await sdk.resetAccount();\n}\n\n\nasync function flashLoan() {\n    \n}\n\nasync function process() {\n    await createOrConnectAccount();\n    \n    if(sdkAction === \"SDK_ACTION_SET_AUTH_KEY\"){\n        await setAuthKey(); \n        await estimateBatch();\n        await submitBatch();\n    } else if(sdkAction === \"SDK_ACTION_EXECUTE_TRX\"){\n        await batchExecute();\n        await estimateBatch();\n        await submitBatch();\n    }else {\n        await resetSdk();\n        msg.payload.done = true;\n        node.send(msg,false);\n        node.done();\n    } \n}\n\nprocess();","outputs":1,"noerr":0,"x":900,"y":440,"wires":[["cfc0e4e4.f103b8"]]},{"id":"7e72ceb6.5bf58","type":"function","z":"767fa731.3692c8","name":"SDK v2 Helper","func":"\n// create sdk\nfetch = global.get('fetch');\nWebSocket = global.get('ws');\nabridged = global.get(\"abridged\");\n\nNotificationTypes = abridged.NotificationTypes;\n\nprivateKey = msg.payload.privateKey;\naddress = msg.payload.address;\nsdkAction = msg.payload.action;\n\nlet sdk;\nlet account;\n\nsdk = abridged.createKovanSdk({\n    authKeyModule: {\n      privateKey\n    },\n    queryProviderEndpoint: 'https://mainnet.infura.io/v3/7acf175321ac4b3cba908ec2111dc297',\n    fetch,\n    WebSocket\n})\nmsg.payload.gaurdianKey = sdk.state$.authKey$.address$._value;\nflow.set('sdk', sdk);\n\n// connect sdk\nasync function createOrConnectAccount (){\n    account = await sdk.createAccount(msg.payload.address);\n    msg.payload.account = account;\n    flow.set('account', account);\n    // node.send(msg);\n}\n\nasync function batchExecute() {\n    const options = {\n      recipient: msg.payload.recipient,\n      value: msg.payload.value,\n      data: msg.payload.data,\n    };\n\n   let batch = await sdk.batchExecuteAccountTransaction(options);\n   msg.payload.batchExecuteBatch = batch;\n//   node.send(msg);\n}\n\nasync function setAuthKey () {\n  output = await sdk.batchSetAccountAuthKey({\n      authKey: msg.payload.authKey,\n      type: \"Owner\"\n  })\n  msg.payload.authKeyOutput = output;\n  // node.send(msg);\n}\n\nasync function estimateBatch() {\n    const refundToken = null; // optional\n    let batch = await sdk.estimateBatch(refundToken)\n    msg.payload.estimateBatchBatch = batch;\n    // node.send(batch);\n}\n\nasync function submitBatch() {\n    const gasPrice = null; // optional\n    let key = await sdk.submitBatch(gasPrice)\n    msg.payload.submitBatchKey = key;\n    const subscribtion = sdk\n    .state$\n    .notification$\n    .subscribe(notification => {\n        console.log(\"subscribe\")\n        if (notification === null) {\n            return;\n        }\n        if (notification.type === NotificationTypes.RelayedTransactionUpdated && notification.payload.state === 'Sending') {\n            msg.payload.hash = notification.payload.hash;\n            node.send(msg);\n            node.done()\n            // resolve(notification.payload.hash);\n            subscribtion.unsubscribe();\n            return;\n        }\n    });\n}\n\nasync function resetSdk() {\n    await sdk.resetAccount();\n}\n\n\nasync function flashLoan() {\n    \n}\n\nasync function process() {\n    await createOrConnectAccount();\n    \n    if(sdkAction === \"SDK_ACTION_SET_AUTH_KEY\"){\n        await setAuthKey(); \n        await estimateBatch();\n        await submitBatch();\n    } else if(sdkAction === \"SDK_ACTION_EXECUTE_TRX\"){\n        await batchExecute();\n        await estimateBatch();\n        await submitBatch();\n    }else {\n        // await resetSdk();\n        msg.payload.done = true;\n        node.send(msg,false);\n        node.done();\n    } \n}\n\nprocess();","outputs":1,"noerr":0,"x":900,"y":400,"wires":[[]]},{"id":"b0a4e879.188908","type":"inject","z":"96df2934.085a08","name":"","topic":"","payload":"{}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":190,"y":480,"wires":[["5408c241.d62f7c"]]},{"id":"5408c241.d62f7c","type":"change","z":"96df2934.085a08","name":"","rules":[{"t":"set","p":"payload.tableName","pt":"msg","to":"user","tot":"str"},{"t":"set","p":"payload.id","pt":"msg","to":"rec64wDIcbxsd2f3c","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":280,"y":420,"wires":[["c934d45b.67e368"]]},{"id":"c934d45b.67e368","type":"node-airtable","z":"96df2934.085a08","name":"Get User","auth":"8988a490.b97c78","table":"user","tableType":"str","action":"get","filter":"","filterType":"msg","record":"payload.id","recordType":"msg","records":"","recordsType":"msg","output":"payload.user","x":480,"y":420,"wires":[["4c04ffa3.25492","126c012f.a664af"],[]]},{"id":"4c04ffa3.25492","type":"debug","z":"96df2934.085a08","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":470,"y":360,"wires":[]},{"id":"126c012f.a664af","type":"subflow:d017622.56f92a","z":"96df2934.085a08","name":"","env":[],"x":730,"y":420,"wires":[["b1b571e0.098b5","cdb20ff6.0aae8"]]},{"id":"b1b571e0.098b5","type":"debug","z":"96df2934.085a08","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":770,"y":360,"wires":[]},{"id":"6b10b4b.c9a3e4c","type":"function","z":"96df2934.085a08","name":"SDK v2 Helper","func":"\n// create sdk\nfetch = global.get('fetch');\nWebSocket = global.get('ws');\nabridged = global.get(\"abridged\");\n\nNotificationTypes = abridged.NotificationTypes;\nconst {privateKey, address, action, debug, recipient, value, data, authKey } = msg.payload.sdkPayload;\n\nlet sdk;\nlet account;\n\nsdk = abridged.createKovanSdk({\n    authKeyModule: {\n      privateKey\n    },\n    queryProviderEndpoint: msg.payload.sdkPayload.queryProviderEndPoint,\n    fetch,\n    WebSocket\n})\nmsg.payload.sdkPayload.gaurdianKey = sdk.state$.authKey$.address$._value;\n\n// connect sdk\nasync function createOrConnectAccount (){\n    account = await sdk.createAccount(msg.payload.address);\n    msg.payload.sdkPayload.account = account;\n    if(debug)\n     node.send(msg);\n}\n\nasync function batchExecute() {\n    const options = {\n      recipient: recipient,\n      value: value,\n      data: data,\n    };\n\n    try{\n       let batch = await sdk.batchExecuteAccountTransaction(options);\n       msg.payload.sdkPayload.batchExecute = batch;\n       if(debug)\n        node.send(msg);\n    }catch(error){\n        msg.payload.sdkPayload.batchExecuteError = error;\n        throw error;\n    }\n}\n\nasync function setAuthKey () {\n  output = await sdk.batchSetAccountAuthKey({\n      authKey: authKey,\n      type: \"Owner\"\n  })\n  msg.payload.sdkPayload.authKeyOutput = output;\n  if(debug)\n    node.send(msg);\n}\n\nasync function estimateBatch() {\n    const refundToken = {}; // optional\n    try{\n        let batch = await sdk.estimateBatch(refundToken);\n        msg.payload.sdkPayload.estimateBatch = batch;\n        if(debug)\n            node.send(msg);\n    }catch(error){\n        msg.payload.sdkPayload.estimateBatchError = error;\n        throw error;\n    }\n}\n\nasync function submitBatch() {\n    const gasPrice = null; // optional\n    let key;\n    try{\n        key = await sdk.submitBatch(gasPrice)\n        msg.payload.sdkPayload.submitBatchKey = key;\n        if(debug)\n            node.send(msg);\n    }catch(error){\n       msg.payload.sdkPayload.submitBatchError = error;\n       throw error;\n    }\n    \n    const subscribtion = sdk\n    .state$\n    .notification$\n    .subscribe(notification => {\n        if (notification === null) {\n            return;\n        }\n        // if (notification.type === NotificationTypes.RelayedTransactionUpdated && notification.payload.state === 'Sending') {\n        if (notification.type === NotificationTypes.RelayedTransactionUpdated && notification.payload.state === 'Sent') {\n            msg.payload.sdkPayload.notification = notification.payload;\n            msg.payload.sdkPayload.done = true;\n            node.send(msg);\n            node.done();\n            // resolve(notification.payload.hash);\n            subscribtion.unsubscribe();\n            return;\n        }\n    });\n}\n\nasync function resetSdk() {\n    await sdk.resetAccount();\n}\n\nasync function process() {\n    await createOrConnectAccount();\n    if(action === \"SDK_ACTION_SET_AUTH_KEY\"){\n        try{\n            await setAuthKey(); \n            await estimateBatch();\n            await submitBatch();\n        }catch(error){\n            msg.payload.sdkPayload.done = true;\n            node.send(msg,false);\n            node.done();\n            await sdk.resetBatch();\n        }\n    } else if(action === \"SDK_ACTION_EXECUTE_TRX\"){\n        try{\n            await batchExecute();\n            await estimateBatch();\n            await submitBatch();\n        }catch(error){\n            msg.payload.sdkPayload.done = true;\n            node.send(msg,false);\n            node.done();\n            await sdk.resetBatch();\n        }\n    }else {\n        await resetSdk();\n        msg.payload.sdkPayload.done = true;\n        node.send(msg,false);\n        node.done();\n    } \n}\n\nprocess();","outputs":1,"noerr":0,"x":1760,"y":480,"wires":[["b63ea031.6053a"]]},{"id":"8fd9184f.bcbdc8","type":"function","z":"96df2934.085a08","name":"Approve Dai To Chai","func":"ethers = global.get(\"ethers\");\n\nlet abi = flow.get(\"abi_dai\");\napprovarAddress = flow.get(\"address_contract_chai\");\namount = ethers.utils.parseEther('1000000000000000000')\nmsg.payload.config = {\n  \"recipient\" : flow.get(\"address_contract_dai\"),\n  abi,\n  \"apiCall\" : \"approve\",\n  \"args\" : [approvarAddress, amount]\n};\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1100,"y":440,"wires":[["f8ea0a67.9bb298"]]},{"id":"d424f2ff.1f83","type":"change","z":"96df2934.085a08","name":"Do Not Change This","rules":[{"t":"set","p":"network","pt":"flow","to":"kovan","tot":"str"},{"t":"set","p":"wyre_link","pt":"flow","to":"https://pay.testwyre.com/purchase","tot":"str"},{"t":"set","p":"ether_scan_url","pt":"flow","to":"https://kovan.etherscan.io","tot":"str"},{"t":"set","p":"address_contract_erc20_token_factory","pt":"flow","to":"0xa9552d5d190816a4b275022837dbb39563ab5bf1","tot":"str"},{"t":"set","p":"abi_erc20_token_factory","pt":"flow","to":"[{\"constant\":false,\"inputs\":[{\"internalType\":\"string\",\"name\":\"_name\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"_symbol\",\"type\":\"string\"},{\"internalType\":\"uint256\",\"name\":\"_supply\",\"type\":\"uint256\"},{\"internalType\":\"uint8\",\"name\":\"_decimals\",\"type\":\"uint8\"},{\"internalType\":\"address\",\"name\":\"_issuer\",\"type\":\"address\"}],\"name\":\"mint\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"internalType\":\"address\",\"name\":\"tokenAddress\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"string\",\"name\":\"name\",\"type\":\"string\"},{\"indexed\":false,\"internalType\":\"string\",\"name\":\"symbol\",\"type\":\"string\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"supply\",\"type\":\"uint256\"},{\"indexed\":false,\"internalType\":\"uint8\",\"name\":\"decimals\",\"type\":\"uint8\"},{\"indexed\":false,\"internalType\":\"address\",\"name\":\"issuer\",\"type\":\"address\"}],\"name\":\"Mint\",\"type\":\"event\"}]","tot":"json"},{"t":"set","p":"address_contract_dai","pt":"flow","to":"0x4f96fe3b7a6cf9725f59d353f723c1bdb64ca6aa","tot":"str"},{"t":"set","p":"abi_dai","pt":"flow","to":"[{\"constant\":true,\"inputs\":[],\"name\":\"name\",\"outputs\":[{\"name\":\"\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"stop\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"guy\",\"type\":\"address\"},{\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"approve\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"owner_\",\"type\":\"address\"}],\"name\":\"setOwner\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"totalSupply\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"src\",\"type\":\"address\"},{\"name\":\"dst\",\"type\":\"address\"},{\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"transferFrom\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"decimals\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"guy\",\"type\":\"address\"},{\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"mint\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"burn\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"name_\",\"type\":\"bytes32\"}],\"name\":\"setName\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"src\",\"type\":\"address\"}],\"name\":\"balanceOf\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"stopped\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"authority_\",\"type\":\"address\"}],\"name\":\"setAuthority\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"owner\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"symbol\",\"outputs\":[{\"name\":\"\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"guy\",\"type\":\"address\"},{\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"burn\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"mint\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"dst\",\"type\":\"address\"},{\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"transfer\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"dst\",\"type\":\"address\"},{\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"push\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"src\",\"type\":\"address\"},{\"name\":\"dst\",\"type\":\"address\"},{\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"move\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"start\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"authority\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"guy\",\"type\":\"address\"}],\"name\":\"approve\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"src\",\"type\":\"address\"},{\"name\":\"guy\",\"type\":\"address\"}],\"name\":\"allowance\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"src\",\"type\":\"address\"},{\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"pull\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"name\":\"symbol_\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"guy\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"Mint\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"guy\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"Burn\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"authority\",\"type\":\"address\"}],\"name\":\"LogSetAuthority\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"owner\",\"type\":\"address\"}],\"name\":\"LogSetOwner\",\"type\":\"event\"},{\"anonymous\":true,\"inputs\":[{\"indexed\":true,\"name\":\"sig\",\"type\":\"bytes4\"},{\"indexed\":true,\"name\":\"guy\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"foo\",\"type\":\"bytes32\"},{\"indexed\":true,\"name\":\"bar\",\"type\":\"bytes32\"},{\"indexed\":false,\"name\":\"wad\",\"type\":\"uint256\"},{\"indexed\":false,\"name\":\"fax\",\"type\":\"bytes\"}],\"name\":\"LogNote\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"src\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"guy\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"Approval\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"src\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"dst\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"Transfer\",\"type\":\"event\"}]","tot":"json"},{"t":"set","p":"address_contract_dai_exchange","pt":"flow","to":"0x47D4Af3BBaEC0dE4dba5F44ae8Ed2761977D32d6","tot":"str"},{"t":"set","p":"address_contract_uniswap_exchange","pt":"flow","to":"0xD3E51Ef092B2845f10401a0159B2B96e8B6c3D30","tot":"str"},{"t":"set","p":"abi_uniswap_exchange","pt":"flow","to":"[{\"name\":\"NewExchange\",\"inputs\":[{\"type\":\"address\",\"name\":\"token\",\"indexed\":true},{\"type\":\"address\",\"name\":\"exchange\",\"indexed\":true}],\"anonymous\":false,\"type\":\"event\"},{\"name\":\"initializeFactory\",\"outputs\":[],\"inputs\":[{\"type\":\"address\",\"name\":\"template\"}],\"constant\":false,\"payable\":false,\"type\":\"function\",\"gas\":35725},{\"name\":\"createExchange\",\"outputs\":[{\"type\":\"address\",\"name\":\"out\"}],\"inputs\":[{\"type\":\"address\",\"name\":\"token\"}],\"constant\":false,\"payable\":false,\"type\":\"function\",\"gas\":187911},{\"name\":\"getExchange\",\"outputs\":[{\"type\":\"address\",\"name\":\"out\"}],\"inputs\":[{\"type\":\"address\",\"name\":\"token\"}],\"constant\":true,\"payable\":false,\"type\":\"function\",\"gas\":715},{\"name\":\"getToken\",\"outputs\":[{\"type\":\"address\",\"name\":\"out\"}],\"inputs\":[{\"type\":\"address\",\"name\":\"exchange\"}],\"constant\":true,\"payable\":false,\"type\":\"function\",\"gas\":745},{\"name\":\"getTokenWithId\",\"outputs\":[{\"type\":\"address\",\"name\":\"out\"}],\"inputs\":[{\"type\":\"uint256\",\"name\":\"token_id\"}],\"constant\":true,\"payable\":false,\"type\":\"function\",\"gas\":736},{\"name\":\"exchangeTemplate\",\"outputs\":[{\"type\":\"address\",\"name\":\"out\"}],\"inputs\":[],\"constant\":true,\"payable\":false,\"type\":\"function\",\"gas\":633},{\"name\":\"tokenCount\",\"outputs\":[{\"type\":\"uint256\",\"name\":\"out\"}],\"inputs\":[],\"constant\":true,\"payable\":false,\"type\":\"function\",\"gas\":663}]","tot":"json"},{"t":"set","p":"address_contract_chai","pt":"flow","to":"0xb641957b6c29310926110848db2d464c8c3c3f38","tot":"str"},{"t":"set","p":"abi_chai","pt":"flow","to":"[{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"chainId_\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"vat_\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"pot_\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"join_\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"dai_\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"src\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"address\",\"name\":\"guy\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"Approval\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"src\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"address\",\"name\":\"dst\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"Transfer\",\"type\":\"event\"},{\"constant\":true,\"inputs\":[],\"name\":\"DOMAIN_SEPARATOR\",\"outputs\":[{\"internalType\":\"bytes32\",\"name\":\"\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"PERMIT_TYPEHASH\",\"outputs\":[{\"internalType\":\"bytes32\",\"name\":\"\",\"type\":\"bytes32\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"name\":\"allowance\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"usr\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"approve\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"name\":\"balanceOf\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"usr\",\"type\":\"address\"}],\"name\":\"dai\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"wad\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"daiJoin\",\"outputs\":[{\"internalType\":\"contract JoinLike\",\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"daiToken\",\"outputs\":[{\"internalType\":\"contract GemLike\",\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"decimals\",\"outputs\":[{\"internalType\":\"uint8\",\"name\":\"\",\"type\":\"uint8\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"src\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"draw\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"src\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"exit\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"dst\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"join\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"src\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"dst\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"move\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"name\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"name\":\"nonces\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"holder\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"spender\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"nonce\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"expiry\",\"type\":\"uint256\"},{\"internalType\":\"bool\",\"name\":\"allowed\",\"type\":\"bool\"},{\"internalType\":\"uint8\",\"name\":\"v\",\"type\":\"uint8\"},{\"internalType\":\"bytes32\",\"name\":\"r\",\"type\":\"bytes32\"},{\"internalType\":\"bytes32\",\"name\":\"s\",\"type\":\"bytes32\"}],\"name\":\"permit\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"pot\",\"outputs\":[{\"internalType\":\"contract PotLike\",\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"symbol\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"totalSupply\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"dst\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"transfer\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"src\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"dst\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"transferFrom\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"vat\",\"outputs\":[{\"internalType\":\"contract VatLike\",\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"version\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"}]","tot":"json"},{"t":"set","p":"wyre_account_id","pt":"flow","to":"AC_3N8VHCTUZYC","tot":"str"},{"t":"set","p":"SDK_ACTION_SET_AUTH_KEY","pt":"flow","to":"SDK_ACTION_SET_AUTH_KEY","tot":"str"},{"t":"set","p":"SDK_ACTION_EXECUTE_TRX","pt":"flow","to":"SDK_ACTION_EXECUTE_TRX","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":180,"wires":[["bf9fb61e.fb4678"]]},{"id":"8102a1c4.a9566","type":"inject","z":"96df2934.085a08","name":"Consts","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":340,"y":180,"wires":[["d424f2ff.1f83"]]},{"id":"bf9fb61e.fb4678","type":"debug","z":"96df2934.085a08","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":840,"y":200,"wires":[]},{"id":"f8ea0a67.9bb298","type":"subflow:bc5c5eb0.964c7","z":"96df2934.085a08","name":"","env":[],"x":1290,"y":480,"wires":[["612ebd93.9a4264","da359cc0.3b314"]]},{"id":"612ebd93.9a4264","type":"debug","z":"96df2934.085a08","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1290,"y":520,"wires":[]},{"id":"da359cc0.3b314","type":"change","z":"96df2934.085a08","name":"","rules":[{"t":"set","p":"payload.sdkPayload.queryProviderEndPoint","pt":"msg","to":"queryProviderEndPoint","tot":"global"},{"t":"set","p":"payload.sdkPayload.address","pt":"msg","to":"payload.user.fields.account_address","tot":"msg"},{"t":"set","p":"payload.sdkPayload.privateKey","pt":"msg","to":"payload.user.fields.pk","tot":"msg"},{"t":"set","p":"payload.sdkPayload.action","pt":"msg","to":"SDK_ACTION_EXECUTE_TRX","tot":"global"},{"t":"set","p":"payload.sdkPayload.value","pt":"msg","to":"payload.config.value","tot":"msg"},{"t":"set","p":"msg.payload.sdkPayload.recipient","pt":"msg","to":"address_contract_dai","tot":"flow"},{"t":"set","p":"payload.sdkPayload.data","pt":"msg","to":"payload.config.encodedData","tot":"msg"},{"t":"set","p":"payload.sdkPayload.debug","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1500,"y":480,"wires":[["6b10b4b.c9a3e4c","8b2281e0.edb1e"]]},{"id":"8b2281e0.edb1e","type":"debug","z":"96df2934.085a08","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1550,"y":520,"wires":[]},{"id":"b63ea031.6053a","type":"debug","z":"96df2934.085a08","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1790,"y":520,"wires":[]},{"id":"13432e8b.125871","type":"comment","z":"96df2934.085a08","name":"DAI APPROVE","info":"","x":100,"y":320,"wires":[]},{"id":"cdb20ff6.0aae8","type":"function","z":"96df2934.085a08","name":"UNISWAP: ETH TO DAI","func":"ethers = global.get(\"ethers\");\n\nlet abi = global.get(\"abi_exchange_uniswap\");\netherAmount = ethers.utils.parseEther('0.3').toHexString();\nmimToken = ethers.utils.parseEther('1');\n\nmsg.payload.config = {\n//   \"recipient\" : \"0x8779C708e2C3b1067de9Cd63698E4334866c691C\", // dai uniswap exchange address\n  \"recipient\" : \"0x613639E23E91fd54d50eAfd6925AF2Ed6701A46b\",\n  abi,\n  \"apiCall\" : \"ethToTokenSwapInput\",\n  \"value\" : etherAmount,\n  \"args\" : [mimToken, ethers.utils.parseEther('100')]\n};\n\n\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1090,"y":700,"wires":[["aa538e4d.7a4b4"]]},{"id":"aa538e4d.7a4b4","type":"subflow:bc5c5eb0.964c7","z":"96df2934.085a08","name":"","env":[],"x":1330,"y":700,"wires":[["29a67bb.1ba9984","75c6a424.d865dc"]]},{"id":"75c6a424.d865dc","type":"change","z":"96df2934.085a08","name":"","rules":[{"t":"set","p":"payload.sdkPayload.queryProviderEndPoint","pt":"msg","to":"queryProviderEndPoint","tot":"global"},{"t":"set","p":"payload.sdkPayload.address","pt":"msg","to":"payload.user.fields.account_address","tot":"msg"},{"t":"set","p":"payload.sdkPayload.privateKey","pt":"msg","to":"payload.user.fields.pk","tot":"msg"},{"t":"set","p":"payload.sdkPayload.action","pt":"msg","to":"SDK_ACTION_EXECUTE_TRX","tot":"global"},{"t":"set","p":"payload.sdkPayload.value","pt":"msg","to":"payload.config.value","tot":"msg"},{"t":"set","p":"msg.payload.sdkPayload.recipient","pt":"msg","to":"payload.config.recipient","tot":"msg"},{"t":"set","p":"payload.sdkPayload.data","pt":"msg","to":"payload.config.encodedData","tot":"msg"},{"t":"set","p":"payload.sdkPayload.debug","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1540,"y":700,"wires":[["24c90ca8.072014","b30a3fe8.be84a"]]},{"id":"29a67bb.1ba9984","type":"debug","z":"96df2934.085a08","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1330,"y":740,"wires":[]},{"id":"24c90ca8.072014","type":"debug","z":"96df2934.085a08","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1590,"y":740,"wires":[]},{"id":"c014055.986f8f8","type":"function","z":"96df2934.085a08","name":"SDK v2 Helper","func":"\n// create sdk\nfetch = global.get('fetch');\nWebSocket = global.get('ws');\nabridged = global.get(\"abridged\");\n\nNotificationTypes = abridged.NotificationTypes;\nconst {privateKey, address, action, debug, recipient, value, data, authKey } = msg.payload.sdkPayload;\n\nlet sdk;\nlet account;\n\nsdk = abridged.createKovanSdk({\n    authKeyModule: {\n      privateKey\n    },\n    queryProviderEndpoint: msg.payload.sdkPayload.queryProviderEndPoint,\n    fetch,\n    WebSocket\n})\nmsg.payload.sdkPayload.gaurdianKey = sdk.state$.authKey$.address$._value;\n\n// connect sdk\nasync function createOrConnectAccount (){\n    account = await sdk.createAccount(msg.payload.address);\n    msg.payload.sdkPayload.account = account;\n    if(debug)\n     node.send(msg);\n}\n\nasync function batchExecute() {\n    const options = {\n      recipient: recipient,\n      value: value,\n      data: data,\n    };\n\n    try{\n       let batch = await sdk.batchExecuteAccountTransaction(options);\n       msg.payload.sdkPayload.batchExecute = batch;\n       if(debug)\n        node.send(msg);\n    }catch(error){\n        msg.payload.sdkPayload.batchExecuteError = error;\n        throw error;\n    }\n}\n\nasync function setAuthKey () {\n  output = await sdk.batchSetAccountAuthKey({\n      authKey: authKey,\n      type: \"Owner\"\n  })\n  msg.payload.sdkPayload.authKeyOutput = output;\n  if(debug)\n    node.send(msg);\n}\n\nasync function estimateBatch() {\n    const refundToken = {}; // optional\n    try{\n        let batch = await sdk.estimateBatch(refundToken);\n        msg.payload.sdkPayload.estimateBatch = batch;\n        if(debug)\n            node.send(msg);\n    }catch(error){\n        msg.payload.sdkPayload.estimateBatchError = error;\n        throw error;\n    }\n}\n\nasync function submitBatch() {\n    const gasPrice = null; // optional\n    let key;\n    try{\n        key = await sdk.submitBatch(gasPrice)\n        msg.payload.sdkPayload.submitBatchKey = key;\n        if(debug)\n            node.send(msg);\n    }catch(error){\n       msg.payload.sdkPayload.submitBatchError = error;\n       throw error;\n    }\n    \n    const subscribtion = sdk\n    .state$\n    .notification$\n    .subscribe(notification => {\n        if (notification === null) {\n            return;\n        }\n        // if (notification.type === NotificationTypes.RelayedTransactionUpdated && notification.payload.state === 'Sending') {\n        if (notification.type === NotificationTypes.RelayedTransactionUpdated && notification.payload.state === 'Sent') {\n            msg.payload.sdkPayload.notification = notification.payload;\n            msg.payload.sdkPayload.done = true;\n            node.send(msg);\n            node.done();\n            // resolve(notification.payload.hash);\n            subscribtion.unsubscribe();\n            return;\n        }\n    });\n}\n\nasync function resetSdk() {\n    await sdk.resetAccount();\n}\n\nasync function process() {\n    await createOrConnectAccount();\n    if(action === \"SDK_ACTION_SET_AUTH_KEY\"){\n        try{\n            await setAuthKey(); \n            await estimateBatch();\n            await submitBatch();\n        }catch(error){\n            msg.payload.sdkPayload.done = true;\n            node.send(msg,false);\n            node.done();\n            await sdk.resetBatch();\n        }\n    } else if(action === \"SDK_ACTION_EXECUTE_TRX\"){\n        try{\n            await batchExecute();\n            await estimateBatch();\n            await submitBatch();\n        }catch(error){\n            msg.payload.sdkPayload.done = true;\n            node.send(msg,false);\n            node.done();\n            await sdk.resetBatch();\n        }\n    }else {\n        await resetSdk();\n        msg.payload.sdkPayload.done = true;\n        node.send(msg,false);\n        node.done();\n    } \n}\n\nprocess();","outputs":1,"noerr":0,"x":1980,"y":680,"wires":[["8cfcd948.dc06d8"]]},{"id":"8cfcd948.dc06d8","type":"debug","z":"96df2934.085a08","name":"SDK OUTPUT","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1820,"y":740,"wires":[]},{"id":"b31e24c9.6767a8","type":"change","z":"96df2934.085a08","name":"","rules":[{"t":"set","p":"payload.sdkPayload.queryProviderEndPoint","pt":"msg","to":"queryProviderEndPoint","tot":"global"},{"t":"set","p":"payload.sdkPayload.action","pt":"msg","to":"SDK_ACTION_SET_AUTH_KEY","tot":"global"},{"t":"set","p":"payload.sdkPayload.address","pt":"msg","to":"payload.user.fields.account_address","tot":"msg"},{"t":"set","p":"payload.sdkPayload.privateKey","pt":"msg","to":"payload.user.fields.pk","tot":"msg"},{"t":"set","p":"msg.payload.sdkPayload.authKey","pt":"msg","to":"0x369CfbBA4a81Bf33108B0CCB08880d2f0CA0Af19","tot":"str"},{"t":"set","p":"payload.sdkPayload.debug","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1100,"y":280,"wires":[["2d2981a8.cf9dee","5353e69c.4019a8"]]},{"id":"5353e69c.4019a8","type":"debug","z":"96df2934.085a08","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1270,"y":320,"wires":[]},{"id":"2d2981a8.cf9dee","type":"function","z":"96df2934.085a08","name":"SDK v2 Helper","func":"\n// create sdk\nfetch = global.get('fetch');\nWebSocket = global.get('ws');\nabridged = global.get(\"abridged\");\n\nNotificationTypes = abridged.NotificationTypes;\nconst {privateKey, address, action, debug, recipient, value, data, authKey } = msg.payload.sdkPayload;\n\nlet sdk;\nlet account;\n\nsdk = abridged.createKovanSdk({\n    authKeyModule: {\n      privateKey\n    },\n    queryProviderEndpoint: msg.payload.sdkPayload.queryProviderEndPoint,\n    fetch,\n    WebSocket\n})\nmsg.payload.sdkPayload.gaurdianKey = sdk.state$.authKey$.address$._value;\n\n// connect sdk\nasync function createOrConnectAccount (){\n    account = await sdk.createAccount(msg.payload.address);\n    msg.payload.sdkPayload.account = account;\n    if(debug)\n     node.send(msg);\n}\n\nasync function batchExecute() {\n    const options = {\n      recipient: recipient,\n      value: value,\n      data: data,\n    };\n\n    try{\n       let batch = await sdk.batchExecuteAccountTransaction(options);\n       msg.payload.sdkPayload.batchExecute = batch;\n       if(debug)\n        node.send(msg);\n    }catch(error){\n        msg.payload.sdkPayload.batchExecuteError = error;\n        throw error;\n    }\n}\n\nasync function setAuthKey () {\n  output = await sdk.batchSetAccountAuthKey({\n      authKey: authKey,\n      type: \"Owner\"\n  })\n  msg.payload.sdkPayload.authKeyOutput = output;\n  if(debug)\n    node.send(msg);\n}\n\nasync function estimateBatch() {\n    const refundToken = {}; // optional\n    try{\n        let batch = await sdk.estimateBatch(refundToken);\n        msg.payload.sdkPayload.estimateBatch = batch;\n        if(debug)\n            node.send(msg);\n    }catch(error){\n        msg.payload.sdkPayload.estimateBatchError = error;\n        throw error;\n    }\n}\n\nasync function submitBatch() {\n    const gasPrice = null; // optional\n    let key;\n    try{\n        key = await sdk.submitBatch(gasPrice)\n        msg.payload.sdkPayload.submitBatchKey = key;\n        if(debug)\n            node.send(msg);\n    }catch(error){\n       msg.payload.sdkPayload.submitBatchError = error;\n       throw error;\n    }\n    \n    const subscribtion = sdk\n    .state$\n    .notification$\n    .subscribe(notification => {\n        if (notification === null) {\n            return;\n        }\n        // if (notification.type === NotificationTypes.RelayedTransactionUpdated && notification.payload.state === 'Sending') {\n        if (notification.type === NotificationTypes.RelayedTransactionUpdated && notification.payload.state === 'Sent') {\n            msg.payload.sdkPayload.notification = notification.payload;\n            msg.payload.sdkPayload.done = true;\n            node.send(msg);\n            node.done();\n            // resolve(notification.payload.hash);\n            subscribtion.unsubscribe();\n            return;\n        }\n    });\n}\n\nasync function resetSdk() {\n    await sdk.resetAccount();\n}\n\nasync function process() {\n    await createOrConnectAccount();\n    if(action === \"SDK_ACTION_SET_AUTH_KEY\"){\n        try{\n            await setAuthKey(); \n            await estimateBatch();\n            await submitBatch();\n        }catch(error){\n            msg.payload.sdkPayload.done = true;\n            node.send(msg,false);\n            node.done();\n            await sdk.resetBatch();\n        }\n    } else if(action === \"SDK_ACTION_EXECUTE_TRX\"){\n        try{\n            await batchExecute();\n            await estimateBatch();\n            await submitBatch();\n        }catch(error){\n            msg.payload.sdkPayload.done = true;\n            node.send(msg,false);\n            node.done();\n            await sdk.resetBatch();\n        }\n    }else {\n        await resetSdk();\n        msg.payload.sdkPayload.done = true;\n        node.send(msg,false);\n        node.done();\n    } \n}\n\nprocess();","outputs":1,"noerr":0,"x":1480,"y":280,"wires":[["9bfdffcb.73518"]]},{"id":"9bfdffcb.73518","type":"debug","z":"96df2934.085a08","name":"SDK OUTPUT","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1500,"y":320,"wires":[]},{"id":"9fd689d3.6c1ff8","type":"comment","z":"96df2934.085a08","name":"ADD ACCOUNT AUTH KEY","info":"","x":1140,"y":220,"wires":[]},{"id":"9b094c8d.49ca1","type":"inject","z":"96df2934.085a08","name":"","topic":"","payload":"{}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":790,"y":980,"wires":[["939750e.2a825b"]]},{"id":"939750e.2a825b","type":"function","z":"96df2934.085a08","name":"Call ethToTokenSwapInput on Uniswap","func":"ethers = global.get(\"ethers\");\n\nlet abi = global.get(\"abi_exchange_uniswap\");\n\netherAmount = ethers.utils.parseEther('0.5');\nmimToken = ethers.utils.parseEther('1');\n\nmsg.payload.config = {\n  \"contractAddress\" : \"0x8779C708e2C3b1067de9Cd63698E4334866c691C\",\n  abi,\n  \"pk\" : \"0x35610BD7B3918CE7BF0962AC2AB5C65616139BB6055C7194552A312C31860BAC\",\n  \"apiCall\" : \"ethToTokenSwapInput\",\n  \"value\" : etherAmount,\n  \"args\" : [mimToken, ethers.utils.parseEther('100')]\n};\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1100,"y":980,"wires":[["b9cbc86.a5a6438"]]},{"id":"407d4cbc.9aac34","type":"debug","z":"96df2934.085a08","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1710,"y":980,"wires":[]},{"id":"b9cbc86.a5a6438","type":"function","z":"96df2934.085a08","name":"Contract Executor ","func":"ethers = global.get('ethers');\nlet network  = flow.get(\"network\");\n\nlet { pk, contractAddress, apiCall, args, abi, byteCode, value } = msg.payload.config;\nconst provider = ethers.getDefaultProvider(network);\n\nlet wallet;\nlet contract;\n\nif(pk){\n    wallet = new ethers.Wallet(pk, provider);\n    contract = new ethers.Contract(contractAddress, abi, wallet);\n}else{\n    // read onlyda\n    contract = new ethers.Contract(contractAddress, abi, provider);\n}\n\n// All overrides are optional\nlet overrides = {\n    // The maximum units of gas for the transaction to use\n    gasLimit: 1000000,\n\n    // The price (in wei) per unit of gas\n   // gasPrice: ethers.utils.parseUnits('9.0', 'gwei'),\n    // value: ethers.utils.parseEther('1')\n};\n\nif(value){\n    overrides.value = value;\n}\nargs.push(overrides);\n\n\nlet func = contract[apiCall];\nif(func === undefined){\n    msg.payload.error = 'func undefined';\n    return msg;\n}\nasync function process () {\n    try{\n        let resp = await func.apply(node, args);\n        // msg.payload.trxHash = resp.hash;\n        msg.payload.response = resp;\n    }catch(error){\n        msg.payload.error = error;\n    }\n    node.send(msg, false);\n    node.done();\n    return;\n}\n\nprocess();\n\nreturn;","outputs":1,"noerr":0,"x":1450,"y":980,"wires":[["407d4cbc.9aac34"]]},{"id":"db247636.2e94c8","type":"change","z":"da2025ff.761318","name":"","rules":[{"t":"set","p":"payload.sdkPayload.queryProviderEndPoint","pt":"msg","to":"queryProviderEndPoint","tot":"global"},{"t":"set","p":"payload.sdkPayload.action","pt":"msg","to":"SDK_ACTION_SET_AUTH_KEY","tot":"global"},{"t":"set","p":"payload.sdkPayload.address","pt":"msg","to":"payload.user.fields.account_address","tot":"msg"},{"t":"set","p":"payload.sdkPayload.privateKey","pt":"msg","to":"payload.user.fields.pk","tot":"msg"},{"t":"set","p":"msg.payload.sdkPayload.authKey","pt":"msg","to":"payload.user.fields.client_auth_key","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":1100,"wires":[["3e4d9279.6ef06e"]]},{"id":"1f35fa8e.cbd425","type":"node-airtable","z":"96df2934.085a08","name":"Get User","auth":"8988a490.b97c78","table":"user","tableType":"str","action":"list","filter":"","filterType":"msg","record":"payload.id","recordType":"msg","records":"","recordsType":"msg","output":"payload.user","x":200,"y":680,"wires":[["bdecdbcb.c95a48"],[]]},{"id":"11e0aee0.349b31","type":"inject","z":"96df2934.085a08","name":"","topic":"","payload":"{}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":190,"y":640,"wires":[["1f35fa8e.cbd425"]]},{"id":"bdecdbcb.c95a48","type":"debug","z":"96df2934.085a08","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":230,"y":720,"wires":[]},{"id":"3f8a94af.319b5c","type":"inject","z":"96df2934.085a08","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1560,"y":840,"wires":[["8214cdcf.abeaf"]]},{"id":"8214cdcf.abeaf","type":"function","z":"96df2934.085a08","name":"","func":"fetch = global.get('fetch');\nWebSocket = global.get('ws');\nabridged = global.get(\"abridged\");\n\nNotificationTypes = abridged.NotificationTypes;\ncreateKovanSdk = abridged.createKovanSdk;\n\nlet sdk;\nlet account;\n// let address = '0xaF036eAE6D66A46583aFeb768da59E2Fe62235e4'\n// let privateKey = '0xc5699a1c5bdee6a1094de458fa3a536e2a947f354d27af68f92e4a838d60f27c'\n\n// let recipient = '0x8779C708e2C3b1067de9Cd63698E4334866c691C';\n//  let value = '0x06f05b59d3b20000';\n// let data = '0xf39b5b9b0000000000000000000000000000000000000000000000000de0b6b3a76400000000000000000000000000000000000000000000000000056bc75e2d63100000'\n\nconst {privateKey, address, action, debug, recipient, data, value } = msg.payload.sdkPayload;\n\nsdk = createKovanSdk({\n    authKeyModule: {\n        privateKey\n    },\n    queryProviderEndpoint: 'https://mainnet.infura.io/v3/7acf175321ac4b3cba908ec2111dc297',\n    fetch,\n    WebSocket\n})\nlet gaurdianKey = sdk.state$.authKey$.address$._value;\nconsole.log('gaurdianKey', gaurdianKey);\n// console.log(sdk);\n\n// connect sdk\nasync function createOrConnectAccount() {\n    try {\n        account = await sdk.createAccount(address);\n        console.log(account);\n    } catch (error) {\n        console.log(error);\n    }\n}\n\nasync function batchExecute() {\n    const options = {\n        recipient: recipient,\n        value: value,\n        data: data,\n    };\n\n    try {\n        let batch = await sdk.batchExecuteAccountTransaction(options);\n        console.log('batch: ', batch);\n    } catch (error) {\n        throw error;\n    }\n}\n\nasync function estimateBatch() {\n    const refundToken = {}; // optional\n    try {\n        let batch = await sdk.estimateBatch(refundToken);\n        console.log('estimateBatch: ', batch);\n    } catch (error) {\n        throw error;\n    }\n}\n\nasync function submitBatch() {\n    const gasPrice = null; // optional\n    let key;\n    try {\n        key = await sdk.submitBatch(gasPrice);\n        console.log('key: ', key);\n    } catch (error) {\n        throw error;\n    }\n\n    const subscribtion = sdk\n        .state$\n        .notification$\n        .subscribe(notification => {\n            if (notification === null) {\n                return;\n            }\n            // if (notification.type === NotificationTypes.RelayedTransactionUpdated && notification.payload.state === 'Sending') {\n            if (notification.type === NotificationTypes.RelayedTransactionUpdated && notification.payload.state === 'Sent') {\n                console.log('notification.payload: ', notification.payload);\n                subscribtion.unsubscribe();\n                msg.payload.notification = notification.payload;\n                node.send(msg);\n                node.done();\n                return;\n            }\n        });\n}\n\nasync function test() {\n    await createOrConnectAccount();\n    try {\n        await batchExecute();\n        await estimateBatch();\n        await submitBatch();\n    } catch (error) {\n        console.log(error);\n    }\n}\n\ntest();\nreturn;","outputs":1,"noerr":0,"x":1730,"y":840,"wires":[["979e5100.18e12"]]},{"id":"979e5100.18e12","type":"debug","z":"96df2934.085a08","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1910,"y":840,"wires":[]},{"id":"b30a3fe8.be84a","type":"subflow:c5f445fd.379ed8","z":"96df2934.085a08","name":"","env":[],"x":1720,"y":640,"wires":[["8cfcd948.dc06d8"]]},{"id":"615ab531.d9809c","type":"comment","z":"fa0de9cf.c93278","name":"Queries?","info":"We are asking for token Symobol and Token contract address. \n- Need to call uniswap exchange contract to get\n    - token exchange address if exists.\n    - if exists then check token price?\n    - swap ETH for token","x":620,"y":260,"wires":[]},{"id":"c42c3f30.41c83","type":"debug","z":"845fee24.1a24a","name":"Uniswap Token Exchange Address","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1160,"y":1900,"wires":[]},{"id":"82f76ba9.19d128","type":"inject","z":"845fee24.1a24a","name":"","topic":"","payload":"{}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":210,"y":1880,"wires":[["bf584b45.bb66c8"]]},{"id":"9f1271b3.f2fa5","type":"link in","z":"845fee24.1a24a","name":"In: Uniswap Token Address","links":[],"x":195,"y":1960,"wires":[["bf584b45.bb66c8"]]},{"id":"bf584b45.bb66c8","type":"change","z":"845fee24.1a24a","name":"","rules":[{"t":"set","p":"payload.config.tokenAddress","pt":"msg","to":"0x4F96Fe3b7A6Cf9725f59d353F723c1bDb64CA6Aa","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":1960,"wires":[["99e84573.aaf6c8"]]},{"id":"99e84573.aaf6c8","type":"function","z":"845fee24.1a24a","name":"Contract Executor ","func":"ethers = global.get('ethers');\n\n// The Contract interface\nlet abi = global.get(\"abi_uniswap_exchange_factory\");\n\n// Connect to the network\nlet provider = ethers.getDefaultProvider(global.get('network'));\n\n// The address from the above deployment example\nlet contractAddress = global.get(\"address_contract_uniswap_exchange\")\n\n// We connect to the Contract using a Provider, so we will only\n// have read-only access to the Contract\nlet contract = new ethers.Contract(contractAddress, abi, provider);\n\nlet tokenAddress = msg.payload.config.tokenAddress;\n\nasync function process() {\n    try{\n       tokenExchangeAddress = await contract.getExchange(tokenAddress);\n       msg.payload.tokenExchangeAddress = tokenExchangeAddress;\n    }catch(error){\n        msg.payload.error = error;\n    }\n    node.send(msg)\n    node.done();\n}\n\nprocess();\nreturn;","outputs":1,"noerr":0,"x":690,"y":1960,"wires":[["400cf3c8.7a704c"]]},{"id":"400cf3c8.7a704c","type":"switch","z":"845fee24.1a24a","name":"","property":"payload.error","propertyType":"msg","rules":[{"t":"istype","v":"undefined","vt":"undefined"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":910,"y":1960,"wires":[["c42c3f30.41c83"],["5e395508.fece8c"]]},{"id":"5e395508.fece8c","type":"debug","z":"845fee24.1a24a","name":"Token Exchange Address Not Found","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1170,"y":1980,"wires":[]},{"id":"acf5ab3f.56ea68","type":"function","z":"845fee24.1a24a","name":"Contract Executor ","func":"ethers = global.get('ethers');\n\n// The Contract interface\nlet abi = global.get(\"abi_uniswap_exchange_factory\");\n\n// Connect to the network\nlet provider = ethers.getDefaultProvider(global.get('network'));\n\n// The address from the above deployment example\nlet contractAddress = global.get(\"address_contract_uniswap_exchange\")\n\n// We connect to the Contract using a Provider, so we will only\n// have read-only access to the Contract\nlet contract = new ethers.Contract(contractAddress, abi, provider);\n\nlet tokenAddress = msg.payload.config.tokenAddress;\n\nasync function process() {\n    try{\n       tokenExchangeAddress = await contract.getExchange(tokenAddress);\n       msg.payload.tokenExchangeAddress = tokenExchangeAddress;\n    }catch(error){\n        msg.payload.error = error;\n    }\n    node.send(msg)\n    node.done();\n}\n\nprocess();\nreturn;","outputs":1,"noerr":0,"x":530,"y":1240,"wires":[["5d9993cf.b7d82c"]]},{"id":"5d9993cf.b7d82c","type":"switch","z":"845fee24.1a24a","name":"","property":"payload.error","propertyType":"msg","rules":[{"t":"istype","v":"undefined","vt":"undefined"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":710,"y":1240,"wires":[["7b71ae63.51eb7","6884f724.21a6c8"],["1757d27a.15183e"]]},{"id":"7b71ae63.51eb7","type":"function","z":"845fee24.1a24a","name":"","func":"msg.payload.record[0].fields.uniswap_token_exchange_address = msg.payload.tokenExchangeAddress;\nreturn msg;","outputs":1,"noerr":0,"x":870,"y":1220,"wires":[["1757d27a.15183e"]]},{"id":"6884f724.21a6c8","type":"debug","z":"845fee24.1a24a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":830,"y":1320,"wires":[]},{"id":"9e053ce.4073ec","type":"function","z":"fa0de9cf.c93278","name":"UNISWAP: ETH TO Token","func":"ethers = global.get(\"ethers\");\n\nlet abi = global.get(\"abi_exchange_uniswap\");\netherAmount = ethers.utils.parseEther('0.06').toHexString();\nmimToken = ethers.utils.parseEther('1');\n\nmsg.payload.config = {\n//   \"recipient\" : \"0x8779C708e2C3b1067de9Cd63698E4334866c691C\", // dai uniswap exchange address\n  \"recipient\" : msg.payload.group.fields.uniswap_token_exchange_address,\n  abi,\n  \"apiCall\" : \"ethToTokenSwapInput\",\n  \"value\" : etherAmount,\n  \"args\" : [mimToken, ethers.utils.parseEther('100')]\n};\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":410,"y":420,"wires":[["cf20e900.42e658"]]},{"id":"cf20e900.42e658","type":"subflow:bc5c5eb0.964c7","z":"fa0de9cf.c93278","name":"","env":[],"x":650,"y":420,"wires":[["b6f689fc.e7a578","87990a83.2c0d28"]]},{"id":"87990a83.2c0d28","type":"change","z":"fa0de9cf.c93278","name":"","rules":[{"t":"set","p":"payload.sdkPayload.debug","pt":"msg","to":"true","tot":"bool"},{"t":"set","p":"payload.sdkPayload.address","pt":"msg","to":"payload.user.account.fields.account_address","tot":"msg"},{"t":"set","p":"payload.sdkPayload.privateKey","pt":"msg","to":"payload.user.account.fields.pk","tot":"msg"},{"t":"set","p":"payload.sdkPayload.action","pt":"msg","to":"SDK_ACTION_EXECUTE_TRX","tot":"global"},{"t":"set","p":"payload.sdkPayload.queryProviderEndPoint","pt":"msg","to":"queryProviderEndPoint","tot":"global"},{"t":"set","p":"payload.sdkPayload.value","pt":"msg","to":"payload.config.value","tot":"msg"},{"t":"set","p":"msg.payload.sdkPayload.recipient","pt":"msg","to":"payload.config.recipient","tot":"msg"},{"t":"set","p":"payload.sdkPayload.data","pt":"msg","to":"payload.config.encodedData","tot":"msg"},{"t":"set","p":"payload.network","pt":"msg","to":"network","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":860,"y":420,"wires":[["589f6ed4.894af","1ea23cd8.cb3803"]]},{"id":"b6f689fc.e7a578","type":"debug","z":"fa0de9cf.c93278","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":650,"y":460,"wires":[]},{"id":"589f6ed4.894af","type":"debug","z":"fa0de9cf.c93278","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":910,"y":460,"wires":[]},{"id":"2dc98588.12618a","type":"debug","z":"fa0de9cf.c93278","name":"SDK OUTPUT","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1140,"y":460,"wires":[]},{"id":"1ea23cd8.cb3803","type":"subflow:c5f445fd.379ed8","z":"fa0de9cf.c93278","name":"","env":[],"x":1080,"y":420,"wires":[["2dc98588.12618a","bdfd9807.85d478"]]},{"id":"56762a9f.363d74","type":"chatbot-conversation","z":"fa0de9cf.c93278","name":"","botDevelopment":"4c02f411.5d93bc","botProduction":"","chatId":"1111","userId":"","transport":"telegram","store":"","x":890,"y":580,"wires":[["3653998f.5557f6"]]},{"id":"3653998f.5557f6","type":"function","z":"fa0de9cf.c93278","name":"","func":"msg.payload.chatId = msg.payload.user.fields.dm_id;\nbuttons = [];\n\nbuttons.push(button = {\n\t\"type\": \"url\",\n\t\"label\": \"Join Group\",\n\t\"url\": msg.payload.group.fields.group_link,\n\t\"alert\": false,\n\t\"style\": \"\"\n});\n\nmsg.payload.type = \"inline-buttons\";\nmsg.payload.content = `Congrats!!! SWAP trx is initiate, Please verify here ${global.get('ether_scan_url')}/tx/${msg.payload.sdkPayload.notification.hash}\\n Once Confirmed, Please click join group button`;\nmsg.payload.buttons = buttons;\n\nreturn msg;","outputs":1,"noerr":0,"x":1050,"y":580,"wires":[["98cefff2.3e2af"]]},{"id":"98cefff2.3e2af","type":"chatbot-telegram-send","z":"fa0de9cf.c93278","bot":"4c02f411.5d93bc","botProduction":"","track":false,"passThrough":false,"outputs":0,"x":1250,"y":580,"wires":[]},{"id":"bdfd9807.85d478","type":"switch","z":"fa0de9cf.c93278","name":"","property":"payload.sdkPayload.done","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":870,"y":520,"wires":[["56762a9f.363d74","5f3f3e58.b3349"]]},{"id":"3e3dac7e.00a834","type":"switch","z":"f394d95a.d75788","name":"","property":"payload.user.fields.status","propertyType":"msg","rules":[{"t":"neq","v":"acttive","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1070,"y":940,"wires":[["9fdddb24.d3b5d8"]]},{"id":"9fdddb24.d3b5d8","type":"function","z":"f394d95a.d75788","name":"","func":"\nmsg.payload.record = [\n    {\n        \"id\": msg.payload.user.id,\n        \"fields\": {\n            \"status\":\"active\"\n        }\n    }\n]\n\nreturn msg;","outputs":1,"noerr":0,"x":1190,"y":900,"wires":[["a109bf54.b3956"]]},{"id":"a109bf54.b3956","type":"node-airtable","z":"f394d95a.d75788","name":"Upate user table","auth":"8988a490.b97c78","table":"user","tableType":"str","action":"put","filter":"","filterType":"msg","record":"payload.record","recordType":"msg","records":"payload.record","recordsType":"msg","output":"payload.result","x":1360,"y":860,"wires":[[],[]]},{"id":"73a59cd2.f96294","type":"node-airtable","z":"51a355d0.06a06c","name":"Get Group Detail","auth":"8988a490.b97c78","table":"group","tableType":"str","action":"get","filter":"","filterType":"msg","record":"payload.user.fields.chat_id","recordType":"msg","records":"","recordsType":"msg","output":"payload.group","x":870,"y":1140,"wires":[["3b291f85.37613","6a16e46b.50ef7c"],[]]},{"id":"3b291f85.37613","type":"debug","z":"51a355d0.06a06c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":930,"y":1080,"wires":[]},{"id":"28a001b8.a5286e","type":"switch","z":"51a355d0.06a06c","name":"Uniswap available?","property":"payload.group.fields.uniswap_token_exchange_address","propertyType":"msg","rules":[{"t":"istype","v":"undefined","vt":"undefined"},{"t":"eq","v":"0x0000000000000000000000000000000000000000","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":1010,"y":2560,"wires":[["f3103bff.d7acb8"],["f3103bff.d7acb8"],["be2e1bfa.db26f8"]]},{"id":"f3103bff.d7acb8","type":"chatbot-conversation","z":"51a355d0.06a06c","name":"","botDevelopment":"4c02f411.5d93bc","botProduction":"","chatId":"1111","userId":"","transport":"telegram","store":"","x":1230,"y":2500,"wires":[["6f96a14d.df909"]]},{"id":"6f96a14d.df909","type":"function","z":"51a355d0.06a06c","name":"","func":"msg.payload.chatId = msg.payload.user.fields.dm_id;\nbuttons = [];\n\nbuttons.push(button = {\n\t\"type\": \"url\",\n\t\"label\": \"Join\",\n\t\"url\": msg.payload.group.fields.group_link,\n\t\"alert\": false,\n\t\"style\": \"\"\n});\n\nmsg.payload.content = `\nPlease make sure to have enough tokens at ${msg.payload.user.account.fields.account_address}\n\nETH balance:              ${msg.payload.balance}\nToken balance:            ${msg.payload.tokenBalance}\nMin tokens to join group: ${msg.payload.group.fields.min_token}\nGroup admin can be reached at http://t.me/${msg.payload.group.fields.user_name}    \n`;\n\nmsg.payload.type = \"inline-buttons\";\n//msg.payload.content = `Thanks! Welcome to the group!.`;\nmsg.payload.buttons = buttons;\n\nreturn msg;","outputs":1,"noerr":0,"x":1310,"y":2460,"wires":[["4c9bb7a0.ee2ad8"]]},{"id":"4c9bb7a0.ee2ad8","type":"chatbot-telegram-send","z":"51a355d0.06a06c","bot":"4c02f411.5d93bc","botProduction":"","track":false,"passThrough":false,"outputs":0,"x":1410,"y":2420,"wires":[]},{"id":"8274e38f.6527c","type":"comment","z":"da2025ff.761318","name":"Check if can not swap then take directly to join link","info":"","x":830,"y":1180,"wires":[]},{"id":"cce2a440.1b35c8","type":"switch","z":"da2025ff.761318","name":"","property":"payload.group.fields.uniswap_token_exchange_address","propertyType":"msg","rules":[{"t":"istype","v":"undefined","vt":"undefined"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":690,"y":1240,"wires":[["7f395375.9c068c"],["8ef5ba2a.576648"]]},{"id":"7f395375.9c068c","type":"chatbot-conversation","z":"da2025ff.761318","name":"","botDevelopment":"4c02f411.5d93bc","botProduction":"","chatId":"1111","userId":"","transport":"telegram","store":"","x":850,"y":1220,"wires":[["4695db25.9216d4"]]},{"id":"4695db25.9216d4","type":"function","z":"da2025ff.761318","name":"","func":"msg.payload.chatId = msg.payload.user.fields.dm_id;\nbuttons = [];\n\nbuttons.push(button = {\n\t\"type\": \"url\",\n\t\"label\": \"Join\",\n\t\"url\": msg.payload.group.fields.group_link,\n\t\"alert\": false,\n\t\"style\": \"\"\n});\n\ntokenConfirmationMessage = `Token balance is ${msg.payload.tokenBalance}, in order to join group you need min ${msg.payload.group.fields.min_token} tokens.\\nPlease make sure you have access to token ${msg.payload.group.fields.token_symbol}, address of requred token is ${msg.payload.group.fields.token_address}\nGroup admin can be reached here http://t.me/${msg.payload.group.fields.user_name}\\n\\n Your account addrress is ${msg.payload.user.fields.account_address}\n    `\nmsg.payload.content = `${tokenConfirmationMessage}\\n`;\n\nmsg.payload.type = \"inline-buttons\";\n//msg.payload.content = `Thanks! Welcome to the group!.`;\nmsg.payload.buttons = buttons;\n\nreturn msg;","outputs":1,"noerr":0,"x":1010,"y":1220,"wires":[["d2f683d6.e138"]]},{"id":"d2f683d6.e138","type":"chatbot-telegram-send","z":"da2025ff.761318","bot":"4c02f411.5d93bc","botProduction":"","track":false,"passThrough":false,"outputs":0,"x":1190,"y":1220,"wires":[]},{"id":"4ca4133e.ce51ec","type":"switch","z":"51a355d0.06a06c","name":"","property":"payload.content","propertyType":"msg","rules":[{"t":"eq","v":"/cancel","vt":"str"},{"t":"istype","v":"json","vt":"json"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":250,"y":740,"wires":[["4ef67e9d.60bd5"],["d698e7a9.be7d78"],["3e3e1ccb.ebd694","e768b260.346ee"]]},{"id":"4ef67e9d.60bd5","type":"link out","z":"51a355d0.06a06c","name":"","links":["784f95d2.6ac7dc"],"x":415,"y":640,"wires":[]},{"id":"d698e7a9.be7d78","type":"json","z":"51a355d0.06a06c","name":"","property":"payload.content","action":"obj","pretty":false,"x":450,"y":680,"wires":[["b4d5dc7.ac06a2"]]},{"id":"3e3e1ccb.ebd694","type":"chatbot-command","z":"51a355d0.06a06c","name":"","command":"/start","x":410,"y":740,"wires":[["fbe4cd1b.e2d5c"]]},{"id":"e768b260.346ee","type":"chatbot-command","z":"51a355d0.06a06c","name":"","command":"/join","x":410,"y":780,"wires":[["fbe4cd1b.e2d5c"]]},{"id":"b4d5dc7.ac06a2","type":"switch","z":"51a355d0.06a06c","name":"","property":"payload.content.ac","propertyType":"msg","rules":[{"t":"eq","v":"abridged_wallet","vt":"str"},{"t":"eq","v":"swap","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":610,"y":680,"wires":[["5c561073.4524e"],["7d1400bc.37944"]]},{"id":"5c561073.4524e","type":"link out","z":"51a355d0.06a06c","name":"Out: Abridged Wallet Flow","links":["2079c522.362aaa"],"x":755,"y":640,"wires":[]},{"id":"2079c522.362aaa","type":"link in","z":"51a355d0.06a06c","name":"In: Abridged Wallet Flow","links":["5c561073.4524e"],"x":240,"y":1300,"wires":[["95837c2.9032a8"]]},{"id":"805713e0.9eab1","type":"http in","z":"51a355d0.06a06c","name":"","url":"/webhook/access_bot","method":"post","upload":false,"swaggerDoc":"","x":380,"y":3300,"wires":[["d6b53be9.7dcdd8","e7544927.6b0bf8","1a9828c9.ff02f7"]]},{"id":"a24878a7.53e778","type":"http response","z":"51a355d0.06a06c","name":"","statusCode":"200","headers":{},"x":860,"y":3280,"wires":[]},{"id":"d6b53be9.7dcdd8","type":"debug","z":"51a355d0.06a06c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":530,"y":3240,"wires":[]},{"id":"e7544927.6b0bf8","type":"function","z":"51a355d0.06a06c","name":"","func":"msg.statusCode = 200;\nmsg.payload = {};\nmsg.payload = \"Ok\"\nreturn msg;","outputs":1,"noerr":0,"x":710,"y":3280,"wires":[["a24878a7.53e778"]]},{"id":"99409351.aab21","type":"node-airtable","z":"51a355d0.06a06c","name":"Get User","auth":"8988a490.b97c78","table":"payload.tableName","tableType":"msg","action":"get","filter":"payload.filter","filterType":"msg","record":"payload.id","recordType":"msg","records":"","recordsType":"msg","output":"payload.user","x":900,"y":3380,"wires":[["4a5570f.f6b599","2cd54416.86c4bc"],[]]},{"id":"1a9828c9.ff02f7","type":"function","z":"51a355d0.06a06c","name":"Verification","func":"//check if success\nmsg.payload.tableName = 'user'\nreturn msg;","outputs":1,"noerr":0,"x":710,"y":3380,"wires":[["99409351.aab21"]]},{"id":"4a5570f.f6b599","type":"function","z":"51a355d0.06a06c","name":"Re-Verifiy Token?","func":"return msg;\n","outputs":1,"noerr":0,"x":1110,"y":3380,"wires":[["1a1c9858.c94148"]]},{"id":"7b3c4cca.873bd4","type":"function","z":"51a355d0.06a06c","name":"","func":"msg.payload.record = [\n    {\n        \"id\": msg.payload.user.id,\n        \"fields\": {\n            \"status\" : \"active\",\n            \"wallet_address\" : msg.payload.wallet_address,\n            \"wallet_type\" : \"metamask\"\n        }\n    }\n]\n\nreturn msg;","outputs":1,"noerr":0,"x":1410,"y":3300,"wires":[["dbe9b949.0550f8"]]},{"id":"dbe9b949.0550f8","type":"node-airtable","z":"51a355d0.06a06c","name":"Upate user table","auth":"8988a490.b97c78","table":"user","tableType":"str","action":"put","filter":"","filterType":"msg","record":"payload.record","recordType":"msg","records":"payload.record","recordsType":"msg","output":"payload.result","x":1600,"y":3300,"wires":[["3fa6340f.03947c"],[]]},{"id":"a45c4409.6f6758","type":"comment","z":"51a355d0.06a06c","name":"Get Group Info","info":"","x":1240,"y":3560,"wires":[]},{"id":"627e1a3c.3532f4","type":"node-airtable","z":"51a355d0.06a06c","name":"Get Group Info","auth":"8988a490.b97c78","table":"group","tableType":"str","action":"get","filter":"payload.filter","filterType":"msg","record":"payload.recordId","recordType":"msg","records":"","recordsType":"msg","output":"payload.group","x":2420,"y":3660,"wires":[["e48ecbe8.ce6e48"],[]]},{"id":"379149e4.2f5866","type":"change","z":"51a355d0.06a06c","name":"","rules":[{"t":"set","p":"payload.recordId","pt":"msg","to":"payload.user.fields.group_id[0]","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2350,"y":3620,"wires":[["627e1a3c.3532f4"]]},{"id":"2746f4e6.2bd48c","type":"chatbot-telegram-send","z":"51a355d0.06a06c","bot":"4c02f411.5d93bc","botProduction":"","track":false,"passThrough":false,"outputs":0,"x":2830,"y":3720,"wires":[]},{"id":"e48ecbe8.ce6e48","type":"chatbot-conversation","z":"51a355d0.06a06c","name":"","botDevelopment":"4c02f411.5d93bc","botProduction":"","chatId":"1111","userId":"","transport":"telegram","store":"","x":2470,"y":3720,"wires":[["ad2900de.15931"]]},{"id":"ad2900de.15931","type":"function","z":"51a355d0.06a06c","name":"","func":"msg.payload.chatId = msg.payload.user.fields.dm_id;\nmsg.payload.content = `Thanks! Welcome to the group! ${msg.payload.group.fields.group_link}`;\nmsg.payload.type = 'message';\nreturn msg;","outputs":1,"noerr":0,"x":2630,"y":3720,"wires":[["5bf01c25.53f7b4","2746f4e6.2bd48c"]]},{"id":"5bf01c25.53f7b4","type":"debug","z":"51a355d0.06a06c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":2670,"y":3660,"wires":[]},{"id":"6377a92b.fa25a8","type":"comment","z":"51a355d0.06a06c","name":"Ask for Deposit?","info":"- SDK is initilised should we start wyre flow?","x":1260,"y":3180,"wires":[]},{"id":"3fa6340f.03947c","type":"debug","z":"51a355d0.06a06c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1830,"y":3300,"wires":[]},{"id":"19036bb.817bb94","type":"comment","z":"51a355d0.06a06c","name":"Link Out: For SDK v2","info":"","x":2060,"y":3260,"wires":[]},{"id":"261ce831.2fce48","type":"comment","z":"51a355d0.06a06c","name":"Metamask callback","info":"","x":430,"y":3200,"wires":[]},{"id":"95837c2.9032a8","type":"function","z":"51a355d0.06a06c","name":"Create or connect abridged wallet Flow","func":"cache = flow.get(msg.payload.userId.toString());\nmsg.payload.groupId = cache.groupChatRecordId;\nmsg.payload.filterBy = \"groupId\";\nreturn msg;","outputs":1,"noerr":0,"x":480,"y":1300,"wires":[["6938df7a.52ccd"]]},{"id":"6938df7a.52ccd","type":"subflow:bc40755d.eab8d8","z":"51a355d0.06a06c","name":"","env":[],"x":770,"y":1300,"wires":[["5d08af7e.e388f","f2368157.9d227"],[]]},{"id":"5d08af7e.e388f","type":"debug","z":"51a355d0.06a06c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":790,"y":1260,"wires":[]},{"id":"f2368157.9d227","type":"switch","z":"51a355d0.06a06c","name":"","property":"payload.user.fields.account","propertyType":"msg","rules":[{"t":"istype","v":"undefined","vt":"undefined"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":960,"y":1300,"wires":[["ee8d7a4a.fd0d18"],["a42dc8d5.d556e8"]]},{"id":"ee8d7a4a.fd0d18","type":"function","z":"51a355d0.06a06c","name":"Create and attach abridged wallet","func":"ethers = global.get('ethers');\n\nlet wallet = ethers.Wallet.createRandom();\nmsg.payload.privateKey = wallet.privateKey;\nreturn msg;","outputs":1,"noerr":0,"x":1220,"y":1260,"wires":[["632dc8a0.ca8228"]]},{"id":"632dc8a0.ca8228","type":"change","z":"51a355d0.06a06c","name":"","rules":[{"t":"set","p":"payload.sdkPayload.queryProviderEndPoint","pt":"msg","to":"queryProviderEndPoint","tot":"global"},{"t":"set","p":"payload.sdkPayload.privateKey","pt":"msg","to":"payload.privateKey","tot":"msg"},{"t":"set","p":"msg.payload.sdkPayload.debug","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1500,"y":1260,"wires":[["1485f1a.d00e10e"]]},{"id":"1485f1a.d00e10e","type":"subflow:c5f445fd.379ed8","z":"51a355d0.06a06c","name":"","env":[],"x":1740,"y":1260,"wires":[["e2c10d14.00549"]]},{"id":"e2c10d14.00549","type":"function","z":"51a355d0.06a06c","name":"Create new acccount entry","func":"\nmsg.payload.payload = \n{\n    \"user_id\" : msg.payload.user.fields.user_id,\n    \"guardian_key\": msg.payload.sdkPayload.gaurdianKey,\n    \"account_address\": msg.payload.sdkPayload.account.address,\n    \"pk\": msg.payload.sdkPayload.privateKey,\n    \"external_deposit_address\": msg.payload.sdkPayload.account.externalDepositAddress,\n    \"wallet_type\" : \"abridged\"\n\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":2000,"y":1260,"wires":[["bd3dc0d0.7d861"]]},{"id":"bd3dc0d0.7d861","type":"node-airtable","z":"51a355d0.06a06c","name":"New Account","auth":"8988a490.b97c78","table":"accounts","tableType":"str","action":"post","filter":"","filterType":"msg","record":"payload.payload","recordType":"msg","records":"payload.payload","recordsType":"msg","output":"payload.account","x":2260,"y":1260,"wires":[["9bb77588.fb77b8"],[]]},{"id":"9bb77588.fb77b8","type":"change","z":"51a355d0.06a06c","name":"","rules":[{"t":"delete","p":"payload.payload","pt":"msg"},{"t":"delete","p":"payload.sdkPayload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2480,"y":1260,"wires":[["a14aae70.abbda","5f9636bc.2a53a8"]]},{"id":"a14aae70.abbda","type":"debug","z":"51a355d0.06a06c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":2510,"y":1200,"wires":[]},{"id":"5f9636bc.2a53a8","type":"function","z":"51a355d0.06a06c","name":"Update User","func":"\nmsg.payload.payload = [\n    {\n        \"id\": msg.payload.user.id,\n        \"fields\": {\n            \"account\":[msg.payload.account.id]\n        }\n    }\n]\nreturn msg;","outputs":1,"noerr":0,"x":2710,"y":1260,"wires":[["ba9d81fb.d8f0a"]]},{"id":"ba9d81fb.d8f0a","type":"node-airtable","z":"51a355d0.06a06c","name":"Update User","auth":"8988a490.b97c78","table":"user","tableType":"str","action":"put","filter":"","filterType":"msg","record":"payload.user","recordType":"msg","records":"payload.payload","recordsType":"msg","output":"payload.record","x":2890,"y":1260,"wires":[["9736fce4.e33b1"],[]]},{"id":"9736fce4.e33b1","type":"change","z":"51a355d0.06a06c","name":"","rules":[{"t":"set","p":"payload.record[0]","pt":"msg","to":"payload.user","tot":"msg"},{"t":"move","p":"payload.account","pt":"msg","to":"payload.user.account","tot":"msg"},{"t":"delete","p":"payload.record","pt":"msg"},{"t":"delete","p":"payload.payload","pt":"msg"},{"t":"delete","p":"payload.privateKey","pt":"msg"},{"t":"delete","p":"payload.filterBy","pt":"msg"},{"t":"delete","p":"payload.content","pt":"msg"},{"t":"delete","p":"payload.tableName","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":3080,"y":1260,"wires":[["eb5ae1e9.4f542","1e2ff17a.af7f5f"]]},{"id":"eb5ae1e9.4f542","type":"debug","z":"51a355d0.06a06c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":3150,"y":1200,"wires":[]},{"id":"da278753.aae1f8","type":"link in","z":"51a355d0.06a06c","name":"In: Event New User","links":["b862095c.f177b8"],"x":115,"y":320,"wires":[["5c06f670.0af538","fd4a18f6.d90b78"]]},{"id":"5c06f670.0af538","type":"debug","z":"51a355d0.06a06c","name":"New Event: New user","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":320,"y":260,"wires":[]},{"id":"fd4a18f6.d90b78","type":"function","z":"51a355d0.06a06c","name":"Get Group Info","func":"// msg.payload.filter = `({user_id} = '${msg.payload.userId.toString()}')`;\n// return msg;\nif(msg.payload.tableName === undefined){\n    msg.payload.tableName = 'user';\n}\nmsg.payload.filter = `({chat_id} = '${msg.payload.chatId.toString()}')`;\nreturn msg;","outputs":1,"noerr":0,"x":340,"y":320,"wires":[["5146e9e0.c368d8"]]},{"id":"5146e9e0.c368d8","type":"node-airtable","z":"51a355d0.06a06c","name":"Get Group Info","auth":"8988a490.b97c78","table":"group","tableType":"str","action":"list","filter":"payload.filter","filterType":"msg","record":"payload","recordType":"msg","records":"","recordsType":"msg","output":"payload.groups","x":560,"y":320,"wires":[["bef78626.374ab8"],[]]},{"id":"bef78626.374ab8","type":"change","z":"51a355d0.06a06c","name":"","rules":[{"t":"set","p":"payload.group","pt":"msg","to":"payload.groups[0]","tot":"msg"},{"t":"delete","p":"payload.groups","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":780,"y":320,"wires":[["fdd7d5da.173a98","ee2e1158.569f6"]]},{"id":"ae2ad283.896a9","type":"function","z":"51a355d0.06a06c","name":"","func":"\nmsg.payload.filter = `AND({user_id} = '${msg.payload.userId.toString()}', {chat_id} = '${msg.payload.group.id}')`;\nreturn msg;","outputs":1,"noerr":0,"x":1110,"y":320,"wires":[["9e31f19b.fb8c1"]]},{"id":"fdd7d5da.173a98","type":"debug","z":"51a355d0.06a06c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":790,"y":360,"wires":[]},{"id":"9e31f19b.fb8c1","type":"node-airtable","z":"51a355d0.06a06c","name":"Get User","auth":"8988a490.b97c78","table":"payload.tableName","tableType":"msg","action":"list","filter":"payload.filter","filterType":"msg","record":"payload.id","recordType":"msg","records":"","recordsType":"msg","output":"payload.users","x":1260,"y":320,"wires":[["712888e2.4c6a08","32d29f41.29ac5"],[]]},{"id":"ccd18df.494d77","type":"debug","z":"51a355d0.06a06c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1550,"y":260,"wires":[]},{"id":"32d29f41.29ac5","type":"change","z":"51a355d0.06a06c","name":"","rules":[{"t":"set","p":"payload.user","pt":"msg","to":"payload.users[0]","tot":"msg"},{"t":"delete","p":"payload.users","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1460,"y":320,"wires":[["ccd18df.494d77","1bc943ce.f7aa2c"]]},{"id":"3324de1b.436822","type":"link out","z":"51a355d0.06a06c","name":"","links":["5ef0f084.bf5f4"],"x":1835,"y":320,"wires":[]},{"id":"712888e2.4c6a08","type":"debug","z":"51a355d0.06a06c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1270,"y":260,"wires":[]},{"id":"ee2e1158.569f6","type":"switch","z":"51a355d0.06a06c","name":"","property":"payload.group","propertyType":"msg","rules":[{"t":"eq","v":"undefined","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":970,"y":320,"wires":[["53f57b9a.9365b4","ecb26b31.55a7b8"],["ae2ad283.896a9","24a5adba.5a2bc2"]]},{"id":"53f57b9a.9365b4","type":"link out","z":"51a355d0.06a06c","name":"","links":["7b8db337.7d9f3c"],"x":975,"y":260,"wires":[]},{"id":"b31d836e.d3966","type":"comment","z":"51a355d0.06a06c","name":"Event: New user joined group","info":"","x":240,"y":220,"wires":[]},{"id":"a42dc8d5.d556e8","type":"node-airtable","z":"51a355d0.06a06c","name":"Get Account","auth":"8988a490.b97c78","table":"accounts","tableType":"str","action":"get","filter":"","filterType":"msg","record":"payload.user.fields.account[0]","recordType":"msg","records":"payload.payload","recordsType":"msg","output":"payload.user.account","x":1150,"y":1340,"wires":[["2b05f246.db1c3e","1e2ff17a.af7f5f"],[]]},{"id":"2b05f246.db1c3e","type":"debug","z":"51a355d0.06a06c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1170,"y":1300,"wires":[]},{"id":"1e2ff17a.af7f5f","type":"link out","z":"51a355d0.06a06c","name":"Out: Check Balance Flow","links":["962239cc.50b1d8"],"x":1555,"y":1340,"wires":[]},{"id":"962239cc.50b1d8","type":"link in","z":"51a355d0.06a06c","name":"In: ETH and Token Balance","links":["1e2ff17a.af7f5f"],"x":235,"y":2600,"wires":[["661a0540.9ab1fc"]]},{"id":"9fe5b941.4bd478","type":"debug","z":"d017622.56f92a","name":"Input: ETH and Token Balance","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":230,"y":80,"wires":[]},{"id":"6204c45d.80954c","type":"debug","z":"cf595613.fa3b68","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":490,"y":300,"wires":[]},{"id":"be2e1bfa.db26f8","type":"switch","z":"51a355d0.06a06c","name":"","property":"payload.balance","propertyType":"msg","rules":[{"t":"gt","v":"min_eth","vt":"global"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1290,"y":2600,"wires":[["b33aa8c0.992fc8","97d07a7e.16c208"],["6a4c808.37f428","a5c323af.9155f"]]},{"id":"6a4c808.37f428","type":"debug","z":"51a355d0.06a06c","name":"Not Enough ETH","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1490,"y":2640,"wires":[]},{"id":"a5c323af.9155f","type":"link out","z":"51a355d0.06a06c","name":"","links":["4e8fcdb5.37e064"],"x":1435,"y":2600,"wires":[]},{"id":"49384867.17d8d8","type":"debug","z":"51a355d0.06a06c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":570,"y":2520,"wires":[]},{"id":"97d07a7e.16c208","type":"debug","z":"51a355d0.06a06c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1510,"y":2580,"wires":[]},{"id":"5658dff9.f8535","type":"debug","z":"210c8349.faea1c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":670,"y":180,"wires":[]},{"id":"3dfbea3f.8f4bb6","type":"link in","z":"51a355d0.06a06c","name":"In: Swap Flow","links":["7d1400bc.37944"],"x":275,"y":2980,"wires":[["eac3bd8b.26c93","b75702e0.5799d"]]},{"id":"43f45740.934618","type":"link out","z":"51a355d0.06a06c","name":"","links":["519693.567e996c"],"x":995,"y":2980,"wires":[]},{"id":"68298a5b.c88ac4","type":"inject","z":"51a355d0.06a06c","name":"","topic":"","payload":"{}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":310,"y":2860,"wires":[["d33abd5c.8eea3"]]},{"id":"d33abd5c.8eea3","type":"change","z":"51a355d0.06a06c","name":"","rules":[{"t":"set","p":"payload.content","pt":"msg","to":"{\"id\":\"recKOjqOxdPq3uzCi\"}","tot":"str"},{"t":"set","p":"payload.userId","pt":"msg","to":"897802142","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":2880,"wires":[[]]},{"id":"5f8e9bc9.dc5444","type":"debug","z":"51a355d0.06a06c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":750,"y":2860,"wires":[]},{"id":"c8576689.fdb538","type":"comment","z":"51a355d0.06a06c","name":"Swap ETH to Token","info":"","x":450,"y":2940,"wires":[]},{"id":"e71c0ae1.a45ce8","type":"subflow:bc40755d.eab8d8","z":"51a355d0.06a06c","name":"","env":[],"x":650,"y":2980,"wires":[["5bd363b3.45c45c"],[]]},{"id":"eac3bd8b.26c93","type":"change","z":"51a355d0.06a06c","name":"","rules":[{"t":"set","p":"payload.filterBy","pt":"msg","to":"groupId","tot":"str"},{"t":"set","p":"payload.groupId","pt":"msg","to":"payload.content.id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":440,"y":2980,"wires":[["e71c0ae1.a45ce8"]]},{"id":"7d1400bc.37944","type":"link out","z":"51a355d0.06a06c","name":"","links":["3dfbea3f.8f4bb6"],"x":755,"y":700,"wires":[]},{"id":"25e5e513.bd4a5a","type":"subflow:9d822e4e.1a2a4","z":"51a355d0.06a06c","name":"","x":640,"y":3020,"wires":[["27204cb7.ebe4c4"]]},{"id":"b75702e0.5799d","type":"change","z":"51a355d0.06a06c","name":"","rules":[{"t":"set","p":"payload.token","pt":"msg","to":"token_access_bot","tot":"global"},{"t":"set","p":"payload.messageId","pt":"msg","to":"originalMessage.message_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":440,"y":3020,"wires":[["25e5e513.bd4a5a"]]},{"id":"5bd363b3.45c45c","type":"node-airtable","z":"51a355d0.06a06c","name":"Get Account","auth":"8988a490.b97c78","table":"accounts","tableType":"str","action":"get","filter":"","filterType":"msg","record":"payload.user.fields.account[0]","recordType":"msg","records":"payload.payload","recordsType":"msg","output":"payload.user.account","x":830,"y":2980,"wires":[["43f45740.934618"],[]]},{"id":"7eae6d57.915864","type":"debug","z":"fa0de9cf.c93278","name":"Input: Swap","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":350,"y":240,"wires":[]},{"id":"5f3f3e58.b3349","type":"function","z":"fa0de9cf.c93278","name":"","func":"\nmsg.payload.record = [\n    {\n        \"id\": msg.payload.user.id,\n        \"fields\": {\n            \"status\":\"active\"\n        }\n    }\n]\n\nreturn msg;","outputs":1,"noerr":0,"x":1050,"y":520,"wires":[["33ef73f0.0277ac"]]},{"id":"33ef73f0.0277ac","type":"node-airtable","z":"fa0de9cf.c93278","name":"Upate user table","auth":"8988a490.b97c78","table":"user","tableType":"str","action":"put","filter":"","filterType":"msg","record":"payload.record","recordType":"msg","records":"payload.record","recordsType":"msg","output":"payload.result","x":1220,"y":520,"wires":[[],[]]},{"id":"90dc57ac.1e6928","type":"function","z":"51a355d0.06a06c","name":"","func":"\nmsg.payload.record = [\n    {\n        \"id\": msg.payload.user.id,\n        \"fields\": {\n            \"status\":\"active\"\n        }\n    }\n]\n\nreturn msg;","outputs":1,"noerr":0,"x":1310,"y":2740,"wires":[["e181bb0e.d59dc8"]]},{"id":"e181bb0e.d59dc8","type":"node-airtable","z":"51a355d0.06a06c","name":"Upate user table","auth":"8988a490.b97c78","table":"user","tableType":"str","action":"put","filter":"","filterType":"msg","record":"payload.record","recordType":"msg","records":"payload.record","recordsType":"msg","output":"payload.result","x":1480,"y":2740,"wires":[[],[]]},{"id":"75c0262e.b1d618","type":"debug","z":"f394d95a.d75788","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1130,"y":1140,"wires":[]},{"id":"cd9ae073.eeebb","type":"node-airtable","z":"f394d95a.d75788","name":"Get Account","auth":"8988a490.b97c78","table":"accounts","tableType":"str","action":"get","filter":"","filterType":"msg","record":"payload.user.fields.account[0]","recordType":"msg","records":"payload.payload","recordsType":"msg","output":"payload.user.account","x":290,"y":960,"wires":[["2dfc1026.6c1b"],["f95f691c.1320a8","67c9e9a5.ebd988"]]},{"id":"1a1c9858.c94148","type":"switch","z":"51a355d0.06a06c","name":"","property":"payload.user.fields.account","propertyType":"msg","rules":[{"t":"istype","v":"undefined","vt":"undefined"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1290,"y":3480,"wires":[["93f9d38.dfc983"],["481278c9.ffdf38","93f9d38.dfc983"]]},{"id":"481278c9.ffdf38","type":"node-airtable","z":"51a355d0.06a06c","name":"Get Account","auth":"8988a490.b97c78","table":"accounts","tableType":"str","action":"get","filter":"","filterType":"msg","record":"payload.user.fields.account[0]","recordType":"msg","records":"payload.payload","recordsType":"msg","output":"payload.user.account","x":1470,"y":3540,"wires":[["60c9b14d.9732f"],[]]},{"id":"93f9d38.dfc983","type":"function","z":"51a355d0.06a06c","name":"Create new acccount entry","func":"\nmsg.payload.payload = \n{\n    \"user_id\" : msg.payload.user.fields.user_id,\n    \"wallet_type\" : \"metamask\",\n    \"wallet_address\" : msg.payload.wallet_address\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1520,"y":3420,"wires":[["4e8d0c34.566f04","c23ddf0a.a3c3c"]]},{"id":"4e8d0c34.566f04","type":"node-airtable","z":"51a355d0.06a06c","name":"New Account","auth":"8988a490.b97c78","table":"accounts","tableType":"str","action":"post","filter":"","filterType":"msg","record":"payload.payload","recordType":"msg","records":"payload.payload","recordsType":"msg","output":"payload.account","x":1760,"y":3420,"wires":[["780f9a80.0241c4","43810f21.b693f"],[]]},{"id":"780f9a80.0241c4","type":"change","z":"51a355d0.06a06c","name":"","rules":[{"t":"delete","p":"payload.payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2000,"y":3420,"wires":[["37f86c03.bdc9b4"]]},{"id":"37f86c03.bdc9b4","type":"function","z":"51a355d0.06a06c","name":"Update User","func":"\nmsg.payload.payload = [\n    {\n        \"id\": msg.payload.user.id,\n        \"fields\": {\n            \"account\":[msg.payload.account.id],\n            \"status\" : \"active\"\n        }\n    }\n]\nreturn msg;","outputs":1,"noerr":0,"x":1790,"y":3480,"wires":[["e96c774d.4de108"]]},{"id":"e96c774d.4de108","type":"node-airtable","z":"51a355d0.06a06c","name":"Update User","auth":"8988a490.b97c78","table":"user","tableType":"str","action":"put","filter":"","filterType":"msg","record":"payload.user","recordType":"msg","records":"payload.payload","recordsType":"msg","output":"payload.record","x":1990,"y":3480,"wires":[["78b7c395.bcbf3c"],[]]},{"id":"ea282ede.97412","type":"debug","z":"51a355d0.06a06c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":2370,"y":3560,"wires":[]},{"id":"2cd54416.86c4bc","type":"debug","z":"51a355d0.06a06c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1110,"y":3320,"wires":[]},{"id":"43810f21.b693f","type":"debug","z":"51a355d0.06a06c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1750,"y":3380,"wires":[]},{"id":"c23ddf0a.a3c3c","type":"debug","z":"51a355d0.06a06c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1538,"y":3370,"wires":[]},{"id":"60c9b14d.9732f","type":"debug","z":"51a355d0.06a06c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1390,"y":3640,"wires":[]},{"id":"78b7c395.bcbf3c","type":"change","z":"51a355d0.06a06c","name":"","rules":[{"t":"set","p":"payload.record[0]","pt":"msg","to":"payload.user","tot":"msg"},{"t":"move","p":"payload.account","pt":"msg","to":"payload.user.account","tot":"msg"},{"t":"delete","p":"payload.record","pt":"msg"},{"t":"delete","p":"payload.tableName","pt":"msg"},{"t":"delete","p":"payload.payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2160,"y":3540,"wires":[["ea282ede.97412","379149e4.2f5866"]]},{"id":"315dc84f.45a8a8","type":"function","z":"51a355d0.06a06c","name":"Create new acccount entry","func":"\nmsg.payload.payload = \n{\n    \"user_id\" : msg.payload.user.fields.user_id,\n    \"wallet_type\" : \"metamask\",\n    \"wallet_address\" : msg.payload.wallet_address\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1600,"y":3640,"wires":[["c2ce5964.0405e8"]]},{"id":"c2ce5964.0405e8","type":"node-airtable","z":"51a355d0.06a06c","name":"New Account","auth":"8988a490.b97c78","table":"accounts","tableType":"str","action":"post","filter":"","filterType":"msg","record":"payload.payload","recordType":"msg","records":"payload.payload","recordsType":"msg","output":"payload.account","x":1840,"y":3640,"wires":[[],[]]},{"id":"1099ed69.47b893","type":"switch","z":"727c54f5.3975dc","name":"","property":"payload.network","propertyType":"msg","rules":[{"t":"eq","v":"mainnet","vt":"str"},{"t":"eq","v":"kovan","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":490,"y":300,"wires":[["739e590f.e8a648","ae527bf2.0c8238"],["267cf2d2.e28a3e","3358908f.d698d"]]},{"id":"739e590f.e8a648","type":"change","z":"727c54f5.3975dc","name":"Mainnet Conts","rules":[{"t":"set","p":"network","pt":"global","to":"mainnet","tot":"str"},{"t":"set","p":"queryProviderEndPoint","pt":"global","to":"https://mainnet.infura.io/v3/7acf175321ac4b3cba908ec2111dc297","tot":"str"},{"t":"set","p":"address_contract_uniswap_exchange","pt":"global","to":"0xc0a47dFe034B400B47bDaD5FecDa2621de6c4d95","tot":"str"},{"t":"set","p":"wyre_account_id","pt":"global","to":"","tot":"str"},{"t":"set","p":"wyre_link","pt":"global","to":"https://pay.sendwyre.com/purchase","tot":"str"},{"t":"set","p":"ether_scan_url","pt":"global","to":"https://etherscan.io","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":740,"y":260,"wires":[["4508c256.83de2c"]]},{"id":"4508c256.83de2c","type":"change","z":"727c54f5.3975dc","name":"Common Consts","rules":[{"t":"set","p":"web_wallet_url","pt":"global","to":"https://csb-g30ic.jadbox.now.sh/?callback=https://d1tyqktbo7sr3u.cloudfront.net/webhook/access_bot","tot":"str"},{"t":"set","p":"node_red_server_url","pt":"global","to":"","tot":"str"},{"t":"set","p":"react_server_url","pt":"global","to":"","tot":"str"},{"t":"set","p":"wyre_default_amount","pt":"global","to":"0","tot":"num"},{"t":"set","p":"min_eth","pt":"global","to":"0.0","tot":"num"},{"t":"set","p":"SDK_ACTION_SET_AUTH_KEY","pt":"global","to":"SDK_ACTION_SET_AUTH_KEY","tot":"str"},{"t":"set","p":"SDK_ACTION_EXECUTE_TRX","pt":"global","to":"SDK_ACTION_EXECUTE_TRX","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1010,"y":300,"wires":[[]]},{"id":"ae527bf2.0c8238","type":"debug","z":"727c54f5.3975dc","name":"FLOW: Mainnet","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","targetType":"msg","x":740,"y":220,"wires":[]},{"id":"3358908f.d698d","type":"debug","z":"727c54f5.3975dc","name":"FLOW: Kovan","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","targetType":"msg","x":740,"y":380,"wires":[]},{"id":"27e17890.61f008","type":"switch","z":"51a355d0.06a06c","name":"","property":"payload.error","propertyType":"msg","rules":[{"t":"istype","v":"undefined","vt":"undefined"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":650,"y":2600,"wires":[["7de4d524.d12adc"],["dd2c5d9b.b0bc"]]},{"id":"dd2c5d9b.b0bc","type":"chatbot-conversation","z":"51a355d0.06a06c","name":"","botDevelopment":"4c02f411.5d93bc","botProduction":"","chatId":"1111","userId":"","transport":"telegram","store":"","x":450,"y":2660,"wires":[["85f03c3b.4afa5"]]},{"id":"85f03c3b.4afa5","type":"function","z":"51a355d0.06a06c","name":"","func":"msg.payload.chatId = msg.payload.user.fields.dm_id;\nbuttons = [];\n\n\nmsg.payload.type = \"message\";\nmsg.payload.content = msg.payload.error;\n\nreturn msg;","outputs":1,"noerr":0,"x":610,"y":2660,"wires":[["13d33097.0b27bf"]]},{"id":"13d33097.0b27bf","type":"chatbot-telegram-send","z":"51a355d0.06a06c","bot":"4c02f411.5d93bc","botProduction":"","track":false,"passThrough":false,"outputs":0,"x":470,"y":2700,"wires":[]},{"id":"ddba0d7d.b39b9","type":"comment","z":"96df2934.085a08","name":"Changed to Mainnet","info":"","x":1750,"y":880,"wires":[]},{"id":"80380759.ad88c8","type":"comment","z":"767fa731.3692c8","name":"Changed to Mainnet","info":"","x":410,"y":380,"wires":[]},{"id":"2a74c877.837f28","type":"comment","z":"767fa731.3692c8","name":"Changed to Mainnet","info":"","x":910,"y":360,"wires":[]},{"id":"27204cb7.ebe4c4","type":"function","z":"51a355d0.06a06c","name":"","func":"msg.payload.type = 'message;'\nmsg.payload.content = `Please wait, I'll update once swapping is completed.`\nreturn msg;","outputs":1,"noerr":0,"x":830,"y":3020,"wires":[["278fb3cf.24b24c"]]},{"id":"278fb3cf.24b24c","type":"link out","z":"51a355d0.06a06c","name":"","links":["befd67ba.d5cc88"],"x":935,"y":3020,"wires":[]},{"id":"4f83a65c.bbe848","type":"function","z":"210c8349.faea1c","name":"","func":"var count=context.get(msg.payload.userId.toString()) ;\nif (typeof count==\"undefined\")\ncount=0;\ncount++\nif(count > 60){\n    context.set(msg.payload.userId.toString(), 0) ;\n    return [null, msg]\n}\ncontext.set(msg.payload.userId.toString(), count) ;\nmsg.payload.count = count;\nreturn [ msg, null];","outputs":2,"noerr":0,"x":1310,"y":340,"wires":[["5122a8a3.391078"],[]]},{"id":"24a5adba.5a2bc2","type":"debug","z":"51a355d0.06a06c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1040,"y":400,"wires":[]},{"id":"ecb26b31.55a7b8","type":"debug","z":"51a355d0.06a06c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1090,"y":200,"wires":[]},{"id":"f95f691c.1320a8","type":"debug","z":"f394d95a.d75788","name":"Error","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":120,"y":1040,"wires":[]},{"id":"1bc943ce.f7aa2c","type":"switch","z":"51a355d0.06a06c","name":"","property":"payload.user","propertyType":"msg","rules":[{"t":"istype","v":"undefined","vt":"undefined"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1690,"y":320,"wires":[["1037c612.83731a"],["3324de1b.436822"]]},{"id":"1037c612.83731a","type":"link out","z":"51a355d0.06a06c","name":"","links":["7b8db337.7d9f3c"],"x":1835,"y":260,"wires":[]}]